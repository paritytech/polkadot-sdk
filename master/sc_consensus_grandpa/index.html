<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Integration of the GRANDPA finality gadget into substrate."><title>sc_consensus_grandpa - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-1a91846b.css"><script id="default-settings" 
data-use_system_theme="false"
data-theme="ayu"></script><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="sc_consensus_grandpa" data-themes="" data-resource-suffix="" data-rustdoc-version="1.88.0 (6b00bc388 2025-06-23)" data-channel="1.88.0" data-search-js="search-f7877310.js" data-settings-js="settings-5514c975.js" ><script src="../static.files/storage-4e99c027.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-7ef8a74a.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="stylesheet" href="../theme.css"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"><script>
	function createToC() {
		let sidebar = document.querySelector(".sidebar");
		let headers = document.querySelectorAll("#main-content h2, #main-content h3, #main-content h4");
		console.log(`detected polkadot_sdk_docs: headers: ${headers.length}`);

		let toc = document.createElement("div");
		toc.classList.add("sidebar-table-of-contents");
		toc.appendChild(document.createElement("h2").appendChild(document.createTextNode("Table of Contents")).parentNode);

		let modules = document.querySelectorAll("main .item-table a.mod");

		// the first two headers are always junk
		headers.forEach(header => {
			let link = document.createElement("a");
			link.href = "#" + header.id;
			const headerTextContent = header.textContent.replace("§", "")
			link.textContent = headerTextContent;
			link.className = header.tagName.toLowerCase();

			toc.appendChild(link);

			if (header.id == "modules" && headerTextContent == "Modules") {
				modules.forEach(module => {
					let link = document.createElement("a");
					link.href = module.href;
					link.textContent = module.textContent;
					link.className = "h3";

					toc.appendChild(link);
				});
			}
		});

		// insert toc as the second child in sidebar
		let sidebar_children = sidebar.children;
		if (sidebar_children.length > 1) {
			sidebar.insertBefore(toc, sidebar_children[1]);
		} else {
			sidebar.appendChild(toc);
		}
	}

	function hideSidebarElements() {
		// Create the 'Expand for More' button
		var expandButton = document.createElement('button');
		expandButton.innerText = 'Expand More Items';
		expandButton.classList.add('expand-button');

		// Insert the button at the top of the sidebar or before the '.sidebar-elems'
		var sidebarElems = document.querySelector('.sidebar-elems');
		sidebarElems.parentNode.insertBefore(expandButton, sidebarElems);

		// Initially hide the '.sidebar-elems'
		sidebarElems.style.display = 'none';

		// Add click event listener to the button
		expandButton.addEventListener('click', function () {
			// Toggle the display of the '.sidebar-elems'
			if (sidebarElems.style.display === 'none') {
				sidebarElems.style.display = 'block';
				expandButton.innerText = 'Collapse';
			} else {
				sidebarElems.style.display = 'none';
				expandButton.innerText = 'Expand for More';
			}
		});
	}

	window.addEventListener("DOMContentLoaded", (event) => {
		// if the crate is one that starts with `polkadot_sdk_docs`
		let crate_name = document.querySelector("#main-content > div > h1 > a:nth-child(1)");
		if (!crate_name.textContent.startsWith("polkadot_sdk_docs")) {
			console.log("skipping -- not `polkadot_sdk_docs`");
			return;
		} else {
			// insert class 'sdk-docs' to the body, so it enables the custom css rules.
			document.body.classList.add("sdk-docs");
		}

		createToC();
		hideSidebarElements();

		console.log("updating page based on being `polkadot_sdk_docs` crate");
	});
</script>

<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

<style>
	body.sdk-docs {
		nav.side-bar {
			width: 300px;
		}

		.sidebar-table-of-contents {
			margin-bottom: 1em;
			padding: 0.5em;
		}

		.sidebar-table-of-contents a {
			display: block;
			margin: 0.2em 0;
		}

		.sidebar-table-of-contents .h2 {
			font-weight: bold;
			margin-left: 0;
		}

		.sidebar-table-of-contents .h3 {
			margin-left: 1em;
		}

		.sidebar-table-of-contents .h4 {
			margin-left: 2em;
		}

		.sidebar h2.location {
			display: none;
		}

		.sidebar-elems {
			display: none;
		}

		/* Center the 'Expand for More' button */
		.expand-button {
			display: inline-block;
			/* Use inline-block for sizing */
			margin: 10px auto;
			/* Auto margins for horizontal centering */
			padding: 5px 10px;
			background-color: #007bff;
			color: white;
			text-align: center;
			cursor: pointer;
			border: none;
			border-radius: 5px;
			width: auto;
			/* Centering the button within its parent container */
			position: relative;
			left: 50%;
			transform: translateX(-50%);
		}
	}
</style>

<script async defer src=https://apisa.parity.io/latest.js></script><noscript><img src=https://apisa.parity.io/latest.js alt= referrerpolicy=no-referrer-when-downgrade /></noscript></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../sc_consensus_grandpa/index.html">sc_<wbr>consensus_<wbr>grandpa</a><span class="version">0.19.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#usage" title="Usage">Usage</a></li><li><a href="#changing-authority-sets" title="Changing authority sets">Changing authority sets</a></li></ul><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#functions" title="Functions">Functions</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>sc_consensus_grandpa</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/sc_consensus_grandpa/lib.rs.html#19-1222">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Integration of the GRANDPA finality gadget into substrate.</p>
<p>This crate is unstable and the API and usage may change.</p>
<p>This crate provides a long-running future that produces finality notifications.</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2>
<p>First, create a block-import wrapper with the <code>block_import</code> function. The
GRANDPA worker needs to be linked together with this block import object, so
a <code>LinkHalf</code> is returned as well. All blocks imported (from network or
consensus or otherwise) must pass through this wrapper, otherwise consensus
is likely to break in unexpected ways.</p>
<p>Next, use the <code>LinkHalf</code> and a local configuration to <code>run_grandpa_voter</code>.
This requires a <code>Network</code> implementation. The returned future should be
driven to completion and will finalize blocks in the background.</p>
<h2 id="changing-authority-sets"><a class="doc-anchor" href="#changing-authority-sets">§</a>Changing authority sets</h2>
<p>The rough idea behind changing authority sets in GRANDPA is that at some point,
we obtain agreement for some maximum block height that the current set can
finalize, and once a block with that height is finalized the next set will
pick up finalization from there.</p>
<p>Technically speaking, this would be implemented as a voting rule which says,
“if there is a signal for a change in N blocks in block B, only vote on
chains with length NUM(B) + N if they contain B”. This conditional-inclusion
logic is complex to compute because it requires looking arbitrarily far
back in the chain.</p>
<p>Instead, we keep track of a list of all signals we’ve seen so far (across
all forks), sorted ascending by the block number they would be applied at.
We never vote on chains with number higher than the earliest handoff block
number (this is num(signal) + N). When finalizing a block, we either apply
or prune any signaled changes based on whether the signaling block is
included in the newly-finalized chain.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><dl class="item-table"><dt><a class="mod" href="report/index.html" title="mod sc_consensus_grandpa::report">report</a></dt><dd>Contains a number of data transfer objects for reporting data to the outside world.</dd><dt><a class="mod" href="warp_proof/index.html" title="mod sc_consensus_grandpa::warp_proof">warp_<wbr>proof</a></dt><dd>Utilities for generating and verifying GRANDPA warp sync proofs.</dd></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.AuthoritySet.html" title="struct sc_consensus_grandpa::AuthoritySet">Authority<wbr>Set</a></dt><dd>A set of authorities.</dd><dt><a class="struct" href="struct.AuthoritySetChanges.html" title="struct sc_consensus_grandpa::AuthoritySetChanges">Authority<wbr>SetChanges</a></dt><dd>Tracks historical authority set changes. We store the block numbers for the last block
of each authority set, once they have been finalized. These blocks are guaranteed to
have a justification unless they were triggered by a forced change.</dd><dt><a class="struct" href="struct.AuthoritySetHardFork.html" title="struct sc_consensus_grandpa::AuthoritySetHardFork">Authority<wbr>SetHard<wbr>Fork</a></dt><dd>A descriptor for an authority set hard fork. These are authority set changes
that are not signalled by the runtime and instead are defined off-chain
(hence the hard fork).</dd><dt><a class="struct" href="struct.BeforeBestBlockBy.html" title="struct sc_consensus_grandpa::BeforeBestBlockBy">Before<wbr>Best<wbr>Block<wbr>By</a></dt><dd>A custom voting rule that guarantees that our vote is always behind the best
block by at least N blocks, unless the base number is &lt; N blocks behind the
best, in which case it votes for the base.</dd><dt><a class="struct" href="struct.Config.html" title="struct sc_consensus_grandpa::Config">Config</a></dt><dd>Configuration for the GRANDPA service</dd><dt><a class="struct" href="struct.FinalityProof.html" title="struct sc_consensus_grandpa::FinalityProof">Finality<wbr>Proof</a></dt><dd>Finality for block B is proved by providing:</dd><dt><a class="struct" href="struct.FinalityProofProvider.html" title="struct sc_consensus_grandpa::FinalityProofProvider">Finality<wbr>Proof<wbr>Provider</a></dt><dd>Finality proof provider for serving network requests.</dd><dt><a class="struct" href="struct.GrandpaBlockImport.html" title="struct sc_consensus_grandpa::GrandpaBlockImport">Grandpa<wbr>Block<wbr>Import</a></dt><dd>A block-import handler for GRANDPA.</dd><dt><a class="struct" href="struct.GrandpaJustification.html" title="struct sc_consensus_grandpa::GrandpaJustification">Grandpa<wbr>Justification</a></dt><dd>A GRANDPA justification for block finality, it includes a commit message and
an ancestry proof including all headers routing all precommit target blocks
to the commit target block. Due to the current voting strategy the precommit
targets should be the same as the commit target, since honest voters don’t
vote past authority set change blocks.</dd><dt><a class="struct" href="struct.GrandpaParams.html" title="struct sc_consensus_grandpa::GrandpaParams">Grandpa<wbr>Params</a></dt><dd>Parameters used to run Grandpa.</dd><dt><a class="struct" href="struct.LinkHalf.html" title="struct sc_consensus_grandpa::LinkHalf">Link<wbr>Half</a></dt><dd>Link between the block importer and the background voter.</dd><dt><a class="struct" href="struct.ScheduledChange.html" title="struct sc_consensus_grandpa::ScheduledChange">Scheduled<wbr>Change</a></dt><dd>A scheduled change of authority set.</dd><dt><a class="struct" href="struct.SharedAuthoritySet.html" title="struct sc_consensus_grandpa::SharedAuthoritySet">Shared<wbr>Authority<wbr>Set</a></dt><dd>A shared authority set.</dd><dt><a class="struct" href="struct.SharedVoterState.html" title="struct sc_consensus_grandpa::SharedVoterState">Shared<wbr>Voter<wbr>State</a></dt><dd>Shared voter state for querying.</dd><dt><a class="struct" href="struct.ThreeQuartersOfTheUnfinalizedChain.html" title="struct sc_consensus_grandpa::ThreeQuartersOfTheUnfinalizedChain">Three<wbr>Quarters<wbr>OfThe<wbr>Unfinalized<wbr>Chain</a></dt><dd>A custom voting rule that limits votes towards 3/4 of the unfinalized chain,
using the given <code>base</code> and <code>best_target</code> to figure where the 3/4 target
should fall.</dd><dt><a class="struct" href="struct.VotingRulesBuilder.html" title="struct sc_consensus_grandpa::VotingRulesBuilder">Voting<wbr>Rules<wbr>Builder</a></dt><dd>A builder of a composite voting rule that applies a set of rules to
progressively restrict the vote.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.Error.html" title="enum sc_consensus_grandpa::Error">Error</a></dt><dd>Errors that can occur while voting in GRANDPA.</dd><dt><a class="enum" href="enum.FinalityProofError.html" title="enum sc_consensus_grandpa::FinalityProofError">Finality<wbr>Proof<wbr>Error</a></dt><dd>Errors occurring when trying to prove finality</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.BlockNumberOps.html" title="trait sc_consensus_grandpa::BlockNumberOps">Block<wbr>Number<wbr>Ops</a></dt><dd>Arithmetic necessary for a block number.</dd><dt><a class="trait" href="trait.ClientForGrandpa.html" title="trait sc_consensus_grandpa::ClientForGrandpa">Client<wbr>ForGrandpa</a></dt><dd>A trait that includes all the client functionalities grandpa requires.
Ideally this would be a trait alias, we’re not there yet.
tracking issue <a href="https://github.com/rust-lang/rust/issues/41517">https://github.com/rust-lang/rust/issues/41517</a></dd><dt><a class="trait" href="trait.GenesisAuthoritySetProvider.html" title="trait sc_consensus_grandpa::GenesisAuthoritySetProvider">Genesis<wbr>Authority<wbr>SetProvider</a></dt><dd>Provider for the Grandpa authority set configured on the genesis block.</dd><dt><a class="trait" href="trait.GrandpaApi.html" title="trait sc_consensus_grandpa::GrandpaApi">Grandpa<wbr>Api</a></dt><dd>APIs for integrating the GRANDPA finality gadget into runtimes.
This should be implemented on the runtime side.</dd><dt><a class="trait" href="trait.VotingRule.html" title="trait sc_consensus_grandpa::VotingRule">Voting<wbr>Rule</a></dt><dd>A trait for custom voting rules in GRANDPA.</dd></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.best_justification.html" title="fn sc_consensus_grandpa::best_justification">best_<wbr>justification</a></dt><dd>Fetch the justification for the latest block finalized by GRANDPA, if any.</dd><dt><a class="fn" href="fn.block_import.html" title="fn sc_consensus_grandpa::block_import">block_<wbr>import</a></dt><dd>Make block importer and link half necessary to tie the background voter
to it.</dd><dt><a class="fn" href="fn.block_import_with_authority_set_hard_forks.html" title="fn sc_consensus_grandpa::block_import_with_authority_set_hard_forks">block_<wbr>import_<wbr>with_<wbr>authority_<wbr>set_<wbr>hard_<wbr>forks</a></dt><dd>Make block importer and link half necessary to tie the background voter to
it. A vector of authority set hard forks can be passed, any authority set
change signaled at the given block (either already signalled or in a further
block when importing it) will be replaced by a standard change with the
given static authorities.</dd><dt><a class="fn" href="fn.find_forced_change.html" title="fn sc_consensus_grandpa::find_forced_change">find_<wbr>forced_<wbr>change</a></dt><dd>Checks the given header for a consensus digest signalling a <strong>forced</strong> scheduled change and
extracts it.</dd><dt><a class="fn" href="fn.find_scheduled_change.html" title="fn sc_consensus_grandpa::find_scheduled_change">find_<wbr>scheduled_<wbr>change</a></dt><dd>Checks the given header for a consensus digest signalling a <strong>standard</strong> scheduled change and
extracts it.</dd><dt><a class="fn" href="fn.grandpa_peers_set_config.html" title="fn sc_consensus_grandpa::grandpa_peers_set_config">grandpa_<wbr>peers_<wbr>set_<wbr>config</a></dt><dd>Returns the configuration value to put in
[<code>sc_network::config::FullNetworkConfiguration</code>].
For standard protocol name see <a href="fn.protocol_standard_name.html" title="fn sc_consensus_grandpa::protocol_standard_name"><code>crate::protocol_standard_name</code></a>.</dd><dt><a class="fn" href="fn.protocol_standard_name.html" title="fn sc_consensus_grandpa::protocol_standard_name">protocol_<wbr>standard_<wbr>name</a></dt><dd>Name of the notifications protocol used by GRANDPA.</dd><dt><a class="fn" href="fn.revert.html" title="fn sc_consensus_grandpa::revert">revert</a></dt><dd>Reverts protocol aux data to at most the last finalized block.
In particular, standard and forced authority set changes announced after the
revert point are removed.</dd><dt><a class="fn" href="fn.run_grandpa_observer.html" title="fn sc_consensus_grandpa::run_grandpa_observer">run_<wbr>grandpa_<wbr>observer</a></dt><dd>Run a GRANDPA observer as a task, the observer will finalize blocks only by
listening for and validating GRANDPA commits instead of following the full
protocol. Provide configuration and a link to a block import worker that has
already been instantiated with <code>block_import</code>.
NOTE: this is currently not part of the crate’s public API since we don’t consider
it stable enough to use on a live network.</dd><dt><a class="fn" href="fn.run_grandpa_voter.html" title="fn sc_consensus_grandpa::run_grandpa_voter">run_<wbr>grandpa_<wbr>voter</a></dt><dd>Run a GRANDPA voter as a task. Provide configuration and a link to a
block import worker that has already been instantiated with <code>block_import</code>.</dd></dl><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><dl class="item-table"><dt><a class="type" href="type.AuthorityId.html" title="type sc_consensus_grandpa::AuthorityId">Authority<wbr>Id</a></dt><dd>Identity of a Grandpa authority.</dd><dt><a class="type" href="type.AuthorityPair.html" title="type sc_consensus_grandpa::AuthorityPair">Authority<wbr>Pair</a></dt><dd>The grandpa crypto scheme defined via the keypair type.</dd><dt><a class="type" href="type.CatchUp.html" title="type sc_consensus_grandpa::CatchUp">CatchUp</a></dt><dd>A catch up message for this chain’s block type.</dd><dt><a class="type" href="type.Commit.html" title="type sc_consensus_grandpa::Commit">Commit</a></dt><dd>A commit message for this chain’s block type.</dd><dt><a class="type" href="type.CompactCommit.html" title="type sc_consensus_grandpa::CompactCommit">Compact<wbr>Commit</a></dt><dd>A compact commit message for this chain’s block type.</dd><dt><a class="type" href="type.GrandpaJustificationSender.html" title="type sc_consensus_grandpa::GrandpaJustificationSender">Grandpa<wbr>Justification<wbr>Sender</a></dt><dd>The sending half of the Grandpa justification channel(s).</dd><dt><a class="type" href="type.GrandpaJustificationStream.html" title="type sc_consensus_grandpa::GrandpaJustificationStream">Grandpa<wbr>Justification<wbr>Stream</a></dt><dd>The receiving half of the Grandpa justification channel.</dd><dt><a class="type" href="type.Message.html" title="type sc_consensus_grandpa::Message">Message</a></dt><dd>A GRANDPA message for a substrate chain.</dd><dt><a class="type" href="type.Precommit.html" title="type sc_consensus_grandpa::Precommit">Precommit</a></dt><dd>A precommit message for this chain’s block type.</dd><dt><a class="type" href="type.Prevote.html" title="type sc_consensus_grandpa::Prevote">Prevote</a></dt><dd>A prevote message for this chain’s block type.</dd><dt><a class="type" href="type.PrimaryPropose.html" title="type sc_consensus_grandpa::PrimaryPropose">Primary<wbr>Propose</a></dt><dd>A primary propose message for this chain’s block type.</dd><dt><a class="type" href="type.SignedMessage.html" title="type sc_consensus_grandpa::SignedMessage">Signed<wbr>Message</a></dt><dd>A signed message.</dd><dt><a class="type" href="type.VotingRuleResult.html" title="type sc_consensus_grandpa::VotingRuleResult">Voting<wbr>Rule<wbr>Result</a></dt><dd>A future returned by a <code>VotingRule</code> to restrict a given vote, if any restriction is necessary.</dd></dl><script type="text/json" id="notable-traits-data">{"Vec<u8>":"<h3>Notable traits for <code><a class=\"struct\" href=\"https://doc.rust-lang.org/1.88.0/alloc/vec/struct.Vec.html\" title=\"struct alloc::vec::Vec\">Vec</a>&lt;<a class=\"primitive\" href=\"https://doc.rust-lang.org/1.88.0/std/primitive.u8.html\">u8</a>, A&gt;</code></h3><pre><code><div class=\"where\">impl&lt;A&gt; <a class=\"trait\" href=\"https://doc.rust-lang.org/1.88.0/std/io/trait.Write.html\" title=\"trait std::io::Write\">Write</a> for <a class=\"struct\" href=\"https://doc.rust-lang.org/1.88.0/alloc/vec/struct.Vec.html\" title=\"struct alloc::vec::Vec\">Vec</a>&lt;<a class=\"primitive\" href=\"https://doc.rust-lang.org/1.88.0/std/primitive.u8.html\">u8</a>, A&gt;<div class=\"where\">where\n    A: <a class=\"trait\" href=\"https://doc.rust-lang.org/1.88.0/core/alloc/trait.Allocator.html\" title=\"trait core::alloc::Allocator\">Allocator</a>,</div></div>"}</script></section></div></main><script> mermaid.init({ startOnLoad: true, theme: "dark" }, "pre.language-mermaid > code");</script>


</body></html>