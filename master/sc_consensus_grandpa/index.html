<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Integration of the GRANDPA finality gadget into substrate."><title>sc_consensus_grandpa - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-c5d6553a23f1e5a6.css"><script id="default-settings" 
data-theme="ayu"
data-use_system_theme="false"></script><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="sc_consensus_grandpa" data-themes="" data-resource-suffix="" data-rustdoc-version="1.81.0 (eeb90cda1 2024-09-04)" data-channel="1.81.0" data-search-js="search-d234aafac6c221dd.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-d2fab2bf619172d3.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="stylesheet" href="../theme.css"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"><script>
	function createToC() {
		let sidebar = document.querySelector(".sidebar");
		let headers = document.querySelectorAll("#main-content h2, #main-content h3, #main-content h4");
		console.log(`detected polkadot_sdk_docs: headers: ${headers.length}`);

		let toc = document.createElement("div");
		toc.classList.add("sidebar-table-of-contents");
		toc.appendChild(document.createElement("h2").appendChild(document.createTextNode("Table of Contents")).parentNode);

		let modules = document.querySelectorAll("main .item-table a.mod");

		// the first two headers are always junk
		headers.forEach(header => {
			let link = document.createElement("a");
			link.href = "#" + header.id;
			const headerTextContent = header.textContent.replace("§", "")
			link.textContent = headerTextContent;
			link.className = header.tagName.toLowerCase();

			toc.appendChild(link);

			if (header.id == "modules" && headerTextContent == "Modules") {
				modules.forEach(module => {
					let link = document.createElement("a");
					link.href = module.href;
					link.textContent = module.textContent;
					link.className = "h3";

					toc.appendChild(link);
				});
			}
		});

		// insert toc as the second child in sidebar
		let sidebar_children = sidebar.children;
		if (sidebar_children.length > 1) {
			sidebar.insertBefore(toc, sidebar_children[1]);
		} else {
			sidebar.appendChild(toc);
		}
	}

	function hideSidebarElements() {
		// Create the 'Expand for More' button
		var expandButton = document.createElement('button');
		expandButton.innerText = 'Expand More Items';
		expandButton.classList.add('expand-button');

		// Insert the button at the top of the sidebar or before the '.sidebar-elems'
		var sidebarElems = document.querySelector('.sidebar-elems');
		sidebarElems.parentNode.insertBefore(expandButton, sidebarElems);

		// Initially hide the '.sidebar-elems'
		sidebarElems.style.display = 'none';

		// Add click event listener to the button
		expandButton.addEventListener('click', function () {
			// Toggle the display of the '.sidebar-elems'
			if (sidebarElems.style.display === 'none') {
				sidebarElems.style.display = 'block';
				expandButton.innerText = 'Collapse';
			} else {
				sidebarElems.style.display = 'none';
				expandButton.innerText = 'Expand for More';
			}
		});
	}

	window.addEventListener("DOMContentLoaded", (event) => {
		// if the crate is one that starts with `polkadot_sdk_docs`
		let crate_name = document.querySelector("#main-content > div > h1 > a:nth-child(1)");
		if (!crate_name.textContent.startsWith("polkadot_sdk_docs")) {
			console.log("skipping -- not `polkadot_sdk_docs`");
			return;
		} else {
			// insert class 'sdk-docs' to the body, so it enables the custom css rules.
			document.body.classList.add("sdk-docs");
		}

		createToC();
		hideSidebarElements();

		console.log("updating page based on being `polkadot_sdk_docs` crate");
	});
</script>

<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

<style>
	body.sdk-docs {
		nav.side-bar {
			width: 300px;
		}

		.sidebar-table-of-contents {
			margin-bottom: 1em;
			padding: 0.5em;
		}

		.sidebar-table-of-contents a {
			display: block;
			margin: 0.2em 0;
		}

		.sidebar-table-of-contents .h2 {
			font-weight: bold;
			margin-left: 0;
		}

		.sidebar-table-of-contents .h3 {
			margin-left: 1em;
		}

		.sidebar-table-of-contents .h4 {
			margin-left: 2em;
		}

		.sidebar h2.location {
			display: none;
		}

		.sidebar-elems {
			display: none;
		}

		/* Center the 'Expand for More' button */
		.expand-button {
			display: inline-block;
			/* Use inline-block for sizing */
			margin: 10px auto;
			/* Auto margins for horizontal centering */
			padding: 5px 10px;
			background-color: #007bff;
			color: white;
			text-align: center;
			cursor: pointer;
			border: none;
			border-radius: 5px;
			width: auto;
			/* Centering the button within its parent container */
			position: relative;
			left: 50%;
			transform: translateX(-50%);
		}
	}
</style>

<script async defer src=https://apisa.parity.io/latest.js></script><noscript><img src=https://apisa.parity.io/latest.js alt= referrerpolicy=no-referrer-when-downgrade /></noscript></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../sc_consensus_grandpa/index.html">sc_consensus_grandpa</a><span class="version">0.19.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Aliases</a></li></ul></section></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">sc_consensus_grandpa</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/sc_consensus_grandpa/lib.rs.html#19-1222">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Integration of the GRANDPA finality gadget into substrate.</p>
<p>This crate is unstable and the API and usage may change.</p>
<p>This crate provides a long-running future that produces finality notifications.</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2>
<p>First, create a block-import wrapper with the <code>block_import</code> function. The
GRANDPA worker needs to be linked together with this block import object, so
a <code>LinkHalf</code> is returned as well. All blocks imported (from network or
consensus or otherwise) must pass through this wrapper, otherwise consensus
is likely to break in unexpected ways.</p>
<p>Next, use the <code>LinkHalf</code> and a local configuration to <code>run_grandpa_voter</code>.
This requires a <code>Network</code> implementation. The returned future should be
driven to completion and will finalize blocks in the background.</p>
<h2 id="changing-authority-sets"><a class="doc-anchor" href="#changing-authority-sets">§</a>Changing authority sets</h2>
<p>The rough idea behind changing authority sets in GRANDPA is that at some point,
we obtain agreement for some maximum block height that the current set can
finalize, and once a block with that height is finalized the next set will
pick up finalization from there.</p>
<p>Technically speaking, this would be implemented as a voting rule which says,
“if there is a signal for a change in N blocks in block B, only vote on
chains with length NUM(B) + N if they contain B”. This conditional-inclusion
logic is complex to compute because it requires looking arbitrarily far
back in the chain.</p>
<p>Instead, we keep track of a list of all signals we’ve seen so far (across
all forks), sorted ascending by the block number they would be applied at.
We never vote on chains with number higher than the earliest handoff block
number (this is num(signal) + N). When finalizing a block, we either apply
or prune any signaled changes based on whether the signaling block is
included in the newly-finalized chain.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="report/index.html" title="mod sc_consensus_grandpa::report">report</a></div><div class="desc docblock-short">Contains a number of data transfer objects for reporting data to the outside world.</div></li><li><div class="item-name"><a class="mod" href="warp_proof/index.html" title="mod sc_consensus_grandpa::warp_proof">warp_proof</a></div><div class="desc docblock-short">Utilities for generating and verifying GRANDPA warp sync proofs.</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.AuthoritySet.html" title="struct sc_consensus_grandpa::AuthoritySet">AuthoritySet</a></div><div class="desc docblock-short">A set of authorities.</div></li><li><div class="item-name"><a class="struct" href="struct.AuthoritySetChanges.html" title="struct sc_consensus_grandpa::AuthoritySetChanges">AuthoritySetChanges</a></div><div class="desc docblock-short">Tracks historical authority set changes. We store the block numbers for the last block
of each authority set, once they have been finalized. These blocks are guaranteed to
have a justification unless they were triggered by a forced change.</div></li><li><div class="item-name"><a class="struct" href="struct.AuthoritySetHardFork.html" title="struct sc_consensus_grandpa::AuthoritySetHardFork">AuthoritySetHardFork</a></div><div class="desc docblock-short">A descriptor for an authority set hard fork. These are authority set changes
that are not signalled by the runtime and instead are defined off-chain
(hence the hard fork).</div></li><li><div class="item-name"><a class="struct" href="struct.BeforeBestBlockBy.html" title="struct sc_consensus_grandpa::BeforeBestBlockBy">BeforeBestBlockBy</a></div><div class="desc docblock-short">A custom voting rule that guarantees that our vote is always behind the best
block by at least N blocks, unless the base number is &lt; N blocks behind the
best, in which case it votes for the base.</div></li><li><div class="item-name"><a class="struct" href="struct.Config.html" title="struct sc_consensus_grandpa::Config">Config</a></div><div class="desc docblock-short">Configuration for the GRANDPA service</div></li><li><div class="item-name"><a class="struct" href="struct.FinalityProof.html" title="struct sc_consensus_grandpa::FinalityProof">FinalityProof</a></div><div class="desc docblock-short">Finality for block B is proved by providing:</div></li><li><div class="item-name"><a class="struct" href="struct.FinalityProofProvider.html" title="struct sc_consensus_grandpa::FinalityProofProvider">FinalityProofProvider</a></div><div class="desc docblock-short">Finality proof provider for serving network requests.</div></li><li><div class="item-name"><a class="struct" href="struct.GrandpaBlockImport.html" title="struct sc_consensus_grandpa::GrandpaBlockImport">GrandpaBlockImport</a></div><div class="desc docblock-short">A block-import handler for GRANDPA.</div></li><li><div class="item-name"><a class="struct" href="struct.GrandpaJustification.html" title="struct sc_consensus_grandpa::GrandpaJustification">GrandpaJustification</a></div><div class="desc docblock-short">A GRANDPA justification for block finality, it includes a commit message and
an ancestry proof including all headers routing all precommit target blocks
to the commit target block. Due to the current voting strategy the precommit
targets should be the same as the commit target, since honest voters don’t
vote past authority set change blocks.</div></li><li><div class="item-name"><a class="struct" href="struct.GrandpaParams.html" title="struct sc_consensus_grandpa::GrandpaParams">GrandpaParams</a></div><div class="desc docblock-short">Parameters used to run Grandpa.</div></li><li><div class="item-name"><a class="struct" href="struct.LinkHalf.html" title="struct sc_consensus_grandpa::LinkHalf">LinkHalf</a></div><div class="desc docblock-short">Link between the block importer and the background voter.</div></li><li><div class="item-name"><a class="struct" href="struct.ScheduledChange.html" title="struct sc_consensus_grandpa::ScheduledChange">ScheduledChange</a></div><div class="desc docblock-short">A scheduled change of authority set.</div></li><li><div class="item-name"><a class="struct" href="struct.SharedAuthoritySet.html" title="struct sc_consensus_grandpa::SharedAuthoritySet">SharedAuthoritySet</a></div><div class="desc docblock-short">A shared authority set.</div></li><li><div class="item-name"><a class="struct" href="struct.SharedVoterState.html" title="struct sc_consensus_grandpa::SharedVoterState">SharedVoterState</a></div><div class="desc docblock-short">Shared voter state for querying.</div></li><li><div class="item-name"><a class="struct" href="struct.ThreeQuartersOfTheUnfinalizedChain.html" title="struct sc_consensus_grandpa::ThreeQuartersOfTheUnfinalizedChain">ThreeQuartersOfTheUnfinalizedChain</a></div><div class="desc docblock-short">A custom voting rule that limits votes towards 3/4 of the unfinalized chain,
using the given <code>base</code> and <code>best_target</code> to figure where the 3/4 target
should fall.</div></li><li><div class="item-name"><a class="struct" href="struct.VotingRulesBuilder.html" title="struct sc_consensus_grandpa::VotingRulesBuilder">VotingRulesBuilder</a></div><div class="desc docblock-short">A builder of a composite voting rule that applies a set of rules to
progressively restrict the vote.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Error.html" title="enum sc_consensus_grandpa::Error">Error</a></div><div class="desc docblock-short">Errors that can occur while voting in GRANDPA.</div></li><li><div class="item-name"><a class="enum" href="enum.FinalityProofError.html" title="enum sc_consensus_grandpa::FinalityProofError">FinalityProofError</a></div><div class="desc docblock-short">Errors occurring when trying to prove finality</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.BlockNumberOps.html" title="trait sc_consensus_grandpa::BlockNumberOps">BlockNumberOps</a></div><div class="desc docblock-short">Arithmetic necessary for a block number.</div></li><li><div class="item-name"><a class="trait" href="trait.ClientForGrandpa.html" title="trait sc_consensus_grandpa::ClientForGrandpa">ClientForGrandpa</a></div><div class="desc docblock-short">A trait that includes all the client functionalities grandpa requires.
Ideally this would be a trait alias, we’re not there yet.
tracking issue <a href="https://github.com/rust-lang/rust/issues/41517">https://github.com/rust-lang/rust/issues/41517</a></div></li><li><div class="item-name"><a class="trait" href="trait.GenesisAuthoritySetProvider.html" title="trait sc_consensus_grandpa::GenesisAuthoritySetProvider">GenesisAuthoritySetProvider</a></div><div class="desc docblock-short">Provider for the Grandpa authority set configured on the genesis block.</div></li><li><div class="item-name"><a class="trait" href="trait.GrandpaApi.html" title="trait sc_consensus_grandpa::GrandpaApi">GrandpaApi</a></div><div class="desc docblock-short">APIs for integrating the GRANDPA finality gadget into runtimes.
This should be implemented on the runtime side.</div></li><li><div class="item-name"><a class="trait" href="trait.VotingRule.html" title="trait sc_consensus_grandpa::VotingRule">VotingRule</a></div><div class="desc docblock-short">A trait for custom voting rules in GRANDPA.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.best_justification.html" title="fn sc_consensus_grandpa::best_justification">best_justification</a></div><div class="desc docblock-short">Fetch the justification for the latest block finalized by GRANDPA, if any.</div></li><li><div class="item-name"><a class="fn" href="fn.block_import.html" title="fn sc_consensus_grandpa::block_import">block_import</a></div><div class="desc docblock-short">Make block importer and link half necessary to tie the background voter
to it.</div></li><li><div class="item-name"><a class="fn" href="fn.block_import_with_authority_set_hard_forks.html" title="fn sc_consensus_grandpa::block_import_with_authority_set_hard_forks">block_import_with_authority_set_hard_forks</a></div><div class="desc docblock-short">Make block importer and link half necessary to tie the background voter to
it. A vector of authority set hard forks can be passed, any authority set
change signaled at the given block (either already signalled or in a further
block when importing it) will be replaced by a standard change with the
given static authorities.</div></li><li><div class="item-name"><a class="fn" href="fn.find_forced_change.html" title="fn sc_consensus_grandpa::find_forced_change">find_forced_change</a></div><div class="desc docblock-short">Checks the given header for a consensus digest signalling a <strong>forced</strong> scheduled change and
extracts it.</div></li><li><div class="item-name"><a class="fn" href="fn.find_scheduled_change.html" title="fn sc_consensus_grandpa::find_scheduled_change">find_scheduled_change</a></div><div class="desc docblock-short">Checks the given header for a consensus digest signalling a <strong>standard</strong> scheduled change and
extracts it.</div></li><li><div class="item-name"><a class="fn" href="fn.grandpa_peers_set_config.html" title="fn sc_consensus_grandpa::grandpa_peers_set_config">grandpa_peers_set_config</a></div><div class="desc docblock-short">Returns the configuration value to put in
[<code>sc_network::config::FullNetworkConfiguration</code>].
For standard protocol name see <a href="fn.protocol_standard_name.html" title="fn sc_consensus_grandpa::protocol_standard_name"><code>crate::protocol_standard_name</code></a>.</div></li><li><div class="item-name"><a class="fn" href="fn.protocol_standard_name.html" title="fn sc_consensus_grandpa::protocol_standard_name">protocol_standard_name</a></div><div class="desc docblock-short">Name of the notifications protocol used by GRANDPA.</div></li><li><div class="item-name"><a class="fn" href="fn.revert.html" title="fn sc_consensus_grandpa::revert">revert</a></div><div class="desc docblock-short">Reverts protocol aux data to at most the last finalized block.
In particular, standard and forced authority set changes announced after the
revert point are removed.</div></li><li><div class="item-name"><a class="fn" href="fn.run_grandpa_observer.html" title="fn sc_consensus_grandpa::run_grandpa_observer">run_grandpa_observer</a></div><div class="desc docblock-short">Run a GRANDPA observer as a task, the observer will finalize blocks only by
listening for and validating GRANDPA commits instead of following the full
protocol. Provide configuration and a link to a block import worker that has
already been instantiated with <code>block_import</code>.
NOTE: this is currently not part of the crate’s public API since we don’t consider
it stable enough to use on a live network.</div></li><li><div class="item-name"><a class="fn" href="fn.run_grandpa_voter.html" title="fn sc_consensus_grandpa::run_grandpa_voter">run_grandpa_voter</a></div><div class="desc docblock-short">Run a GRANDPA voter as a task. Provide configuration and a link to a
block import worker that has already been instantiated with <code>block_import</code>.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.AuthorityId.html" title="type sc_consensus_grandpa::AuthorityId">AuthorityId</a></div><div class="desc docblock-short">Identity of a Grandpa authority.</div></li><li><div class="item-name"><a class="type" href="type.AuthorityPair.html" title="type sc_consensus_grandpa::AuthorityPair">AuthorityPair</a></div><div class="desc docblock-short">The grandpa crypto scheme defined via the keypair type.</div></li><li><div class="item-name"><a class="type" href="type.CatchUp.html" title="type sc_consensus_grandpa::CatchUp">CatchUp</a></div><div class="desc docblock-short">A catch up message for this chain’s block type.</div></li><li><div class="item-name"><a class="type" href="type.Commit.html" title="type sc_consensus_grandpa::Commit">Commit</a></div><div class="desc docblock-short">A commit message for this chain’s block type.</div></li><li><div class="item-name"><a class="type" href="type.CompactCommit.html" title="type sc_consensus_grandpa::CompactCommit">CompactCommit</a></div><div class="desc docblock-short">A compact commit message for this chain’s block type.</div></li><li><div class="item-name"><a class="type" href="type.GrandpaJustificationSender.html" title="type sc_consensus_grandpa::GrandpaJustificationSender">GrandpaJustificationSender</a></div><div class="desc docblock-short">The sending half of the Grandpa justification channel(s).</div></li><li><div class="item-name"><a class="type" href="type.GrandpaJustificationStream.html" title="type sc_consensus_grandpa::GrandpaJustificationStream">GrandpaJustificationStream</a></div><div class="desc docblock-short">The receiving half of the Grandpa justification channel.</div></li><li><div class="item-name"><a class="type" href="type.Message.html" title="type sc_consensus_grandpa::Message">Message</a></div><div class="desc docblock-short">A GRANDPA message for a substrate chain.</div></li><li><div class="item-name"><a class="type" href="type.Precommit.html" title="type sc_consensus_grandpa::Precommit">Precommit</a></div><div class="desc docblock-short">A precommit message for this chain’s block type.</div></li><li><div class="item-name"><a class="type" href="type.Prevote.html" title="type sc_consensus_grandpa::Prevote">Prevote</a></div><div class="desc docblock-short">A prevote message for this chain’s block type.</div></li><li><div class="item-name"><a class="type" href="type.PrimaryPropose.html" title="type sc_consensus_grandpa::PrimaryPropose">PrimaryPropose</a></div><div class="desc docblock-short">A primary propose message for this chain’s block type.</div></li><li><div class="item-name"><a class="type" href="type.SignedMessage.html" title="type sc_consensus_grandpa::SignedMessage">SignedMessage</a></div><div class="desc docblock-short">A signed message.</div></li><li><div class="item-name"><a class="type" href="type.VotingRuleResult.html" title="type sc_consensus_grandpa::VotingRuleResult">VotingRuleResult</a></div><div class="desc docblock-short">A future returned by a <code>VotingRule</code> to restrict a given vote, if any restriction is necessary.</div></li></ul></section></div></main><script> mermaid.init({ startOnLoad: true, theme: "dark" }, "pre.language-mermaid > code");</script>


</body></html>