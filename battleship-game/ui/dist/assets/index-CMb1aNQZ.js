var _f=Object.defineProperty;var Of=(t,e,n)=>e in t?_f(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var w=(t,e,n)=>Of(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Tf="modulepreload",Lf=function(t){return"/"+t},Wi={},Rf=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(n.map(c=>{if(c=Lf(c),c in Wi)return;Wi[c]=!0;const l=c.endsWith(".css"),f=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":Tf,l||(u.as="script"),u.crossOrigin="",u.href=c,a&&u.setAttribute("nonce",a),document.head.appendChild(u),l)return new Promise((d,h)=>{u.addEventListener("load",d),u.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return s.then(i=>{for(const a of i||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})},le=10,at=64,ce=32,Fc=320,Vc=40,Ki=[{id:"carrier",name:"Carrier",size:5},{id:"battleship",name:"Battleship",size:4},{id:"cruiser",name:"Cruiser",size:3},{id:"submarine",name:"Submarine",size:3},{id:"destroyer",name:"Destroyer",size:2}];function jc(t,e,n){return{definition:t,position:e,orientation:n,hits:new Set}}function _n(t){const e=[];for(let n=0;n<t.definition.size;n++)t.orientation==="horizontal"?e.push({x:t.position.x+n,y:t.position.y}):e.push({x:t.position.x,y:t.position.y+n});return e}function gs(t){return t.hits.size>=t.definition.size}function Pf(t,e){t.hits.add(e)}function Gc(t,e,n,r){const s=jc(t,e,n),o=_n(s);for(const i of o)if(i.x<0||i.x>=le||i.y<0||i.y>=le)return!1;for(const i of r){const a=_n(i);for(const c of o)for(const l of a)if(c.x===l.x&&c.y===l.y)return!1}return!0}function Mf(t,e){const n=["horizontal","vertical"];for(let s=0;s<100;s++){const o=n[Math.floor(Math.random()*2)],i=o==="horizontal"?le-t.size:le,a=o==="vertical"?le-t.size:le,c={x:Math.floor(Math.random()*i),y:Math.floor(Math.random()*a)};if(Gc(t,c,o,e))return{position:c,orientation:o}}return null}class Yi{constructor(){w(this,"grid");w(this,"ships",[]);this.grid=this.createEmptyGrid()}createEmptyGrid(){const e=[];for(let n=0;n<le;n++){const r=[];for(let s=0;s<le;s++)r.push({state:"empty",shipId:null});e.push(r)}return e}getCell(e){return e.x<0||e.x>=le||e.y<0||e.y>=le?null:this.grid[e.y][e.x]}getShips(){return this.ships}canPlace(e,n,r){return Gc(e,n,r,this.ships)}placeShip(e,n,r){if(!this.canPlace(e,n,r))return!1;const s=jc(e,n,r);this.ships.push(s);const o=_n(s);for(const i of o)this.grid[i.y][i.x]={state:"ship",shipId:e.id};return!0}removeShip(e){const n=this.ships.findIndex(o=>o.definition.id===e);if(n===-1)return;const r=this.ships[n],s=_n(r);for(const o of s)this.grid[o.y][o.x]={state:"empty",shipId:null};this.ships.splice(n,1)}receiveAttack(e){const n=this.getCell(e);if(!n)return"invalid";if(n.state==="hit"||n.state==="miss")return"already_attacked";if(n.state==="ship"){this.grid[e.y][e.x].state="hit";const r=this.ships.find(s=>s.definition.id===n.shipId);if(r){const o=_n(r).findIndex(i=>i.x===e.x&&i.y===e.y);o!==-1&&Pf(r,o)}return"hit"}return this.grid[e.y][e.x].state="miss","miss"}markAttackResult(e,n){e.x<0||e.x>=le||e.y<0||e.y>=le||(this.grid[e.y][e.x].state=n?"hit":"miss")}isShipSunk(e){const n=this.ships.find(r=>r.definition.id===e);return n?gs(n):!1}allShipsSunk(){return this.ships.every(e=>gs(e))}allShipsPlaced(){return this.ships.length===Ki.length}placeShipsRandomly(){this.reset();for(const e of Ki){const n=Mf(e,this.ships);n&&this.placeShip(e,n.position,n.orientation)}}reset(){this.grid=this.createEmptyGrid(),this.ships=[]}getGrid(){return this.grid}}var Hf=Object.defineProperty,Df=(t,e,n)=>e in t?Hf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Zi=(t,e,n)=>(Df(t,typeof e!="symbol"?e+"":e,n),n),oo={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};function Uf(t){const e=t.length%2,n=(t[1]==="x"?2:0)+e,r=(t.length-n)/2+e,s=new Uint8Array(r);e&&(s[0]=0|oo[t[2]]);for(let o=0;o<r;){const i=n+o*2,a=oo[t[i]],c=oo[t[i+1]];s[e+o++]=a<<4|c}return s}var Xi=class extends Uint8Array{constructor(t){super(t),Zi(this,"i",0),Zi(this,"v"),this.v=new DataView(t)}},st=t=>e=>t(e instanceof Xi?e:new Xi(e instanceof Uint8Array?e.buffer:typeof e=="string"?Uf(e).buffer:e)),yt=t=>{const e=t.length;let n=0;for(let s=0;s<e;s++)n+=t[s].length;const r=new Uint8Array(n);for(let s=0,o=0;s<e;s++){const i=t[s];r.set(i,o),o+=i.byteLength}return r};function ms(t,e){const n=Object.keys(t),r=n.length,s={};for(let o=0;o<r;o++){const i=n[o];s[i]=e(t[i],i)}return s}var Ut=st,Q=(t,e)=>{const n=[t,e];return n.enc=t,n.dec=e,n},Ds=(t,e)=>n=>t(e(n)),Us=(t,e)=>n=>e(t(n)),wt=([t,e],n,r)=>Q(Ds(t,n),Us(e,r));function Nf(t,e){return st(n=>{const r=n.v[e](n.i,!0);return n.i+=t,r})}function zf(t,e){return n=>{const r=new Uint8Array(t);return new DataView(r.buffer)[e](0,n,!0),r}}function pn(t,e,n){return Q(zf(t,n),Nf(t,e))}var Z=pn(1,"getUint8","setUint8"),bt=pn(2,"getUint16","setUint16"),tt=pn(4,"getUint32","setUint32"),Tr=pn(8,"getBigUint64","setBigUint64"),Ff=pn(1,"getInt8","setInt8"),Vf=pn(2,"getInt16","setInt16"),jf=pn(4,"getInt32","setInt32"),Gf=pn(8,"getBigInt64","setBigInt64"),qc=t=>{const e=new Uint8Array(16),n=new DataView(e.buffer);return n.setBigInt64(0,t,!0),n.setBigInt64(8,t>>64n,!0),e},Wc=t=>st(e=>{const{v:n,i:r}=e,s=n.getBigUint64(r,!0),o=n[t](r+8,!0);return e.i+=16,o<<64n|s}),Kc=Q(qc,Wc("getBigUint64")),qf=Q(qc,Wc("getBigInt64")),Yc=t=>{const e=new Uint8Array(32),n=new DataView(e.buffer);return n.setBigInt64(0,t,!0),n.setBigInt64(8,t>>64n,!0),n.setBigInt64(16,t>>128n,!0),n.setBigInt64(24,t>>192n,!0),e},Zc=t=>st(e=>{let n=e.v.getBigUint64(e.i,!0);return e.i+=8,n|=e.v.getBigUint64(e.i,!0)<<64n,e.i+=8,n|=e.v.getBigUint64(e.i,!0)<<128n,e.i+=8,n|=e.v[t](e.i,!0)<<192n,e.i+=8,n}),Wf=Q(Yc,Zc("getBigUint64")),Kf=Q(Yc,Zc("getBigInt64")),Yf=wt(Z,t=>t?1:0,Boolean),Zf=[Z[1],bt[1],tt[1]],Xf=st(t=>{const e=t[t.i],n=e&3;if(n<3)return Zf[n](t)>>>2;const r=(e>>>2)+4;t.i++;let s=0n;const o=r/8|0;let i=0n;for(let c=0;c<o;c++)s=Tr[1](t)<<i|s,i+=64n;let a=r%8;return a>3&&(s=BigInt(tt[1](t))<<i|s,i+=32n,a-=4),a>1&&(s=BigInt(bt[1](t))<<i|s,i+=16n,a-=2),a&&(s=BigInt(Z[1](t))<<i|s),s}),Jf=1n<<56n,Qf=1<<24,ed=256,td=4294967295n,nd=64,rd=16384,sd=1<<30,od=t=>{if(t<0)throw new Error(`Wrong compact input (${t})`);const e=Number(t)<<2;if(t<nd)return Z[0](e);if(t<rd)return bt[0](e|1);if(t<sd)return tt[0](e|2);let n=[new Uint8Array(1)],r=BigInt(t);for(;r>=Jf;)n.push(Tr[0](r)),r>>=64n;r>=Qf&&(n.push(tt[0](Number(r&td))),r>>=32n);let s=Number(r);s>=ed&&(n.push(bt[0](s)),s>>=16),s&&n.push(Z[0](s));const o=yt(n);return o[0]=o.length-5<<2|3,o},_e=Q(od,Xf),id=new TextEncoder,ad=t=>{const e=id.encode(t);return yt([_e.enc(e.length),e])},cd=new TextDecoder,ld=st(t=>{let e=_e.dec(t);const n=new DataView(t.buffer,t.i,e);return t.i+=e,cd.decode(n)}),K=Q(ad,ld),ud=()=>{},hd=new Uint8Array(0),N=Q(()=>hd,ud),Xc=t=>t===void 0?e=>yt([_e.enc(e.length),e]):e=>e.length===t?e:e.slice(0,t),Jc=t=>st(e=>{const n=t===void 0?_e.dec(e):t!==1/0?t:e.byteLength-e.i,r=new Uint8Array(e.buffer.slice(e.i,e.i+n));return e.i+=n,r}),ee=t=>Q(Xc(t),Jc(t));ee.enc=Xc;ee.dec=Jc;var Qc=(t,e)=>{const n=Object.keys(t),r=new Map((e==null?void 0:e.map((o,i)=>[n[i],o]))??n.map((o,i)=>[o,i])),s=o=>r.get(o);return({tag:o,value:i})=>yt([Z.enc(s(o)),t[o](i)])},el=(t,e)=>{const n=Object.keys(t),r=new Map((e==null?void 0:e.map((s,o)=>[s,n[o]]))??n.map((s,o)=>[o,s]));return st(s=>{const o=Z.dec(s),i=r.get(o),a=t[i];return{tag:i,value:a(s)}})},ze=(t,...e)=>Q(Qc(ms(t,([n])=>n),...e),el(ms(t,([,n])=>n),...e));ze.enc=Qc;ze.dec=el;var tl=t=>st(e=>Z[1](e)>0?t(e):void 0),nl=t=>e=>{const n=new Uint8Array(1);return e===void 0?n:(n[0]=1,yt([n,t(e)]))},Fe=t=>Q(nl(t[0]),tl(t[1]));Fe.enc=nl;Fe.dec=tl;var rl=(t,e)=>st(n=>{const r=Z[1](n)===0,o=(r?t:e)(n);return{success:r,value:o}}),sl=(t,e)=>({success:n,value:r})=>yt([Z[0](n?0:1),(n?t:e)(r)]),Lr=(t,e)=>Q(sl(t[0],e[0]),rl(t[1],e[1]));Lr.dec=rl;Lr.enc=sl;var ol=(...t)=>st(e=>t.map(n=>n(e))),il=(...t)=>e=>yt(t.map((n,r)=>n(e[r]))),Ve=(...t)=>Q(il(...t.map(([e])=>e)),ol(...t.map(([,e])=>e)));Ve.enc=il;Ve.dec=ol;var al=t=>{const e=Object.keys(t);return Ds(Ve.enc(...Object.values(t)),n=>e.map(r=>n[r]))},cl=t=>{const e=Object.keys(t);return Us(Ve.dec(...Object.values(t)),n=>Object.fromEntries(n.map((r,s)=>[e[s],r])))},z=t=>Q(al(ms(t,e=>e[0])),cl(ms(t,e=>e[1])));z.enc=al;z.dec=cl;var ll=(t,e)=>e>=0?n=>yt(n.map(t)):n=>yt([_e.enc(n.length),yt(n.map(t))]),ul=(t,e)=>st(n=>{const r=e>=0?e:_e.dec(n),s=new Array(r);for(let o=0;o<r;o++)s[o]=t(n);return s}),q=(t,e)=>Q(ll(t[0],e),ul(t[1],e));q.enc=ll;q.dec=ul;/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function fd(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function hl(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(n=>typeof n=="string"):e.every(n=>Number.isSafeInteger(n)):!1}function No(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function fl(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function zo(t){if(!Array.isArray(t))throw new Error("array expected")}function dl(t,e){if(!hl(!0,e))throw new Error(`${t}: array of strings expected`)}function dd(t,e){if(!hl(!1,e))throw new Error(`${t}: array of numbers expected`)}function pd(...t){const e=o=>o,n=(o,i)=>a=>o(i(a)),r=t.map(o=>o.encode).reduceRight(n,e),s=t.map(o=>o.decode).reduce(n,e);return{encode:r,decode:s}}function gd(t){const e=typeof t=="string"?t.split(""):t,n=e.length;dl("alphabet",e);const r=new Map(e.map((s,o)=>[s,o]));return{encode:s=>(zo(s),s.map(o=>{if(!Number.isSafeInteger(o)||o<0||o>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${o}". Allowed: ${t}`);return e[o]})),decode:s=>(zo(s),s.map(o=>{No("alphabet.decode",o);const i=r.get(o);if(i===void 0)throw new Error(`Unknown letter: "${o}". Allowed: ${t}`);return i}))}}function md(t=""){return No("join",t),{encode:e=>(dl("join.decode",e),e.join(t)),decode:e=>(No("join.decode",e),e.split(t))}}function Ji(t,e,n){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(zo(t),!t.length)return[];let r=0;const s=[],o=Array.from(t,a=>{if(fl(a),a<0||a>=e)throw new Error(`invalid integer: ${a}`);return a}),i=o.length;for(;;){let a=0,c=!0;for(let l=r;l<i;l++){const f=o[l],u=e*a,d=u+f;if(!Number.isSafeInteger(d)||u/e!==a||d-f!==u)throw new Error("convertRadix: carry overflow");const h=d/n;a=d%n;const g=Math.floor(h);if(o[l]=g,!Number.isSafeInteger(g)||g*n+a!==d)throw new Error("convertRadix: carry overflow");if(c)g?c=!1:r=l;else continue}if(s.push(a),c)break}for(let a=0;a<t.length-1&&t[a]===0;a++)s.push(0);return s.reverse()}function yd(t){fl(t);const e=2**8;return{encode:n=>{if(!fd(n))throw new Error("radix.encode input should be Uint8Array");return Ji(Array.from(n),e,t)},decode:n=>(dd("radix.decode",n),Uint8Array.from(Ji(n,t,e)))}}const bd=t=>pd(yd(58),gd(t),md("")),pl=bd("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function vd(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Jn(t,e=""){if(!Number.isSafeInteger(t)||t<0){const n=e&&`"${e}" `;throw new Error(`${n}expected integer >= 0, got ${t}`)}}function et(t,e,n=""){const r=vd(t),s=t==null?void 0:t.length,o=e!==void 0;if(!r||o&&s!==e){const i=n&&`"${n}" `,a=o?` of length ${e}`:"",c=r?`length=${s}`:`type=${typeof t}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return t}function Ar(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ui(t,e){et(t,void 0,"digestInto() output");const n=e.outputLen;if(t.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function wd(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function Ln(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function un(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function ys(t,e){return t<<32-e|t>>>e}const gl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ml(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Ot=gl?t=>t:t=>ml(t);function xd(t){for(let e=0;e<t.length;e++)t[e]=ml(t[e]);return t}const Oe=gl?t=>t:xd;function hi(t,e={}){const n=(s,o)=>t(o).update(s).digest(),r=t(void 0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=s=>t(s),Object.assign(n,e),Object.freeze(n)}const Ed=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]);function zt(t,e,n,r,s){return t=t+e+s|0,r=ys(r^t,16),n=n+r|0,e=ys(e^n,12),{a:t,b:e,c:n,d:r}}function Ft(t,e,n,r,s){return t=t+e+s|0,r=ys(r^t,8),n=n+r|0,e=ys(e^n,7),{a:t,b:e,c:n,d:r}}const kd=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),zr=BigInt(2**32-1),Qi=BigInt(32);function bs(t,e=!1){return e?{h:Number(t&zr),l:Number(t>>Qi&zr)}:{h:Number(t>>Qi&zr)|0,l:Number(t&zr)|0}}function Sd(t,e=!1){const n=t.length;let r=new Uint32Array(n),s=new Uint32Array(n);for(let o=0;o<n;o++){const{h:i,l:a}=bs(t[o],e);[r[o],s[o]]=[i,a]}return[r,s]}const yl=(t,e,n)=>t>>>n|e<<32-n,bl=(t,e,n)=>t<<32-n|e>>>n,Bd=(t,e,n)=>t<<64-n|e>>>n-32,Ad=(t,e,n)=>t>>>n-32|e<<64-n,Id=(t,e)=>e,$d=(t,e)=>t,Cd=(t,e,n)=>t<<n|e>>>32-n,_d=(t,e,n)=>e<<n|t>>>32-n,Od=(t,e,n)=>e<<n-32|t>>>64-n,Td=(t,e,n)=>t<<n-32|e>>>64-n;function vl(t,e,n,r){const s=(e>>>0)+(r>>>0);return{h:t+n+(s/2**32|0)|0,l:s|0}}const wl=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),xl=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,fe=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),L=new Uint32Array(32);function Vt(t,e,n,r,s,o){const i=s[o],a=s[o+1];let c=L[2*t],l=L[2*t+1],f=L[2*e],u=L[2*e+1],d=L[2*n],h=L[2*n+1],g=L[2*r],p=L[2*r+1],m=wl(c,f,i);l=xl(m,l,u,a),c=m|0,{Dh:p,Dl:g}={Dh:p^l,Dl:g^c},{Dh:p,Dl:g}={Dh:Id(p,g),Dl:$d(p)},{h,l:d}=vl(h,d,p,g),{Bh:u,Bl:f}={Bh:u^h,Bl:f^d},{Bh:u,Bl:f}={Bh:yl(u,f,24),Bl:bl(u,f,24)},L[2*t]=c,L[2*t+1]=l,L[2*e]=f,L[2*e+1]=u,L[2*n]=d,L[2*n+1]=h,L[2*r]=g,L[2*r+1]=p}function jt(t,e,n,r,s,o){const i=s[o],a=s[o+1];let c=L[2*t],l=L[2*t+1],f=L[2*e],u=L[2*e+1],d=L[2*n],h=L[2*n+1],g=L[2*r],p=L[2*r+1],m=wl(c,f,i);l=xl(m,l,u,a),c=m|0,{Dh:p,Dl:g}={Dh:p^l,Dl:g^c},{Dh:p,Dl:g}={Dh:yl(p,g,16),Dl:bl(p,g,16)},{h,l:d}=vl(h,d,p,g),{Bh:u,Bl:f}={Bh:u^h,Bl:f^d},{Bh:u,Bl:f}={Bh:Bd(u,f,63),Bl:Ad(u,f,63)},L[2*t]=c,L[2*t+1]=l,L[2*e]=f,L[2*e+1]=u,L[2*n]=d,L[2*n+1]=h,L[2*r]=g,L[2*r+1]=p}function Ld(t,e={},n,r,s){if(Jn(n),t<0||t>n)throw new Error("outputLen bigger than keyLen");const{key:o,salt:i,personalization:a}=e;if(o!==void 0&&(o.length<1||o.length>n))throw new Error('"key" expected to be undefined or of length=1..'+n);i!==void 0&&et(i,r,"salt"),a!==void 0&&et(a,s,"personalization")}class El{constructor(e,n){w(this,"buffer");w(this,"buffer32");w(this,"finished",!1);w(this,"destroyed",!1);w(this,"length",0);w(this,"pos",0);w(this,"blockLen");w(this,"outputLen");Jn(e),Jn(n),this.blockLen=e,this.outputLen=n,this.buffer=new Uint8Array(e),this.buffer32=Ln(this.buffer)}update(e){Ar(this),et(e);const{blockLen:n,buffer:r,buffer32:s}=this,o=e.length,i=e.byteOffset,a=e.buffer;for(let c=0;c<o;){this.pos===n&&(Oe(s),this.compress(s,0,!1),Oe(s),this.pos=0);const l=Math.min(n-this.pos,o-c),f=i+c;if(l===n&&!(f%4)&&c+l<o){const u=new Uint32Array(a,f,Math.floor((o-c)/4));Oe(u);for(let d=0;c+n<o;d+=s.length,c+=n)this.length+=n,this.compress(u,d,!1);Oe(u);continue}r.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Ar(this),ui(e,this);const{pos:n,buffer32:r}=this;this.finished=!0,un(this.buffer.subarray(n)),Oe(r),this.compress(r,0,!0),Oe(r);const s=Ln(e);this.get().forEach((o,i)=>s[i]=Ot(o))}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){const{buffer:n,length:r,finished:s,destroyed:o,outputLen:i,pos:a}=this;return e||(e=new this.constructor({dkLen:i})),e.set(...this.get()),e.buffer.set(n),e.destroyed=o,e.finished=s,e.length=r,e.pos=a,e.outputLen=i,e}clone(){return this._cloneInto()}}class Rd extends El{constructor(n={}){const r=n.dkLen===void 0?64:n.dkLen;super(128,r);w(this,"v0l",fe[0]|0);w(this,"v0h",fe[1]|0);w(this,"v1l",fe[2]|0);w(this,"v1h",fe[3]|0);w(this,"v2l",fe[4]|0);w(this,"v2h",fe[5]|0);w(this,"v3l",fe[6]|0);w(this,"v3h",fe[7]|0);w(this,"v4l",fe[8]|0);w(this,"v4h",fe[9]|0);w(this,"v5l",fe[10]|0);w(this,"v5h",fe[11]|0);w(this,"v6l",fe[12]|0);w(this,"v6h",fe[13]|0);w(this,"v7l",fe[14]|0);w(this,"v7h",fe[15]|0);Ld(r,n,64,16,16);let{key:s,personalization:o,salt:i}=n,a=0;if(s!==void 0&&(et(s,void 0,"key"),a=s.length),this.v0l^=this.outputLen|a<<8|65536|1<<24,i!==void 0){et(i,void 0,"salt");const c=Ln(i);this.v4l^=Ot(c[0]),this.v4h^=Ot(c[1]),this.v5l^=Ot(c[2]),this.v5h^=Ot(c[3])}if(o!==void 0){et(o,void 0,"personalization");const c=Ln(o);this.v6l^=Ot(c[0]),this.v6h^=Ot(c[1]),this.v7l^=Ot(c[2]),this.v7h^=Ot(c[3])}if(s!==void 0){const c=new Uint8Array(this.blockLen);c.set(s),this.update(c)}}get(){let{v0l:n,v0h:r,v1l:s,v1h:o,v2l:i,v2h:a,v3l:c,v3h:l,v4l:f,v4h:u,v5l:d,v5h:h,v6l:g,v6h:p,v7l:m,v7h:b}=this;return[n,r,s,o,i,a,c,l,f,u,d,h,g,p,m,b]}set(n,r,s,o,i,a,c,l,f,u,d,h,g,p,m,b){this.v0l=n|0,this.v0h=r|0,this.v1l=s|0,this.v1h=o|0,this.v2l=i|0,this.v2h=a|0,this.v3l=c|0,this.v3h=l|0,this.v4l=f|0,this.v4h=u|0,this.v5l=d|0,this.v5h=h|0,this.v6l=g|0,this.v6h=p|0,this.v7l=m|0,this.v7h=b|0}compress(n,r,s){this.get().forEach((l,f)=>L[f]=l),L.set(fe,16);let{h:o,l:i}=bs(BigInt(this.length));L[24]=fe[8]^i,L[25]=fe[9]^o,s&&(L[28]=~L[28],L[29]=~L[29]);let a=0;const c=Ed;for(let l=0;l<12;l++)Vt(0,4,8,12,n,r+2*c[a++]),jt(0,4,8,12,n,r+2*c[a++]),Vt(1,5,9,13,n,r+2*c[a++]),jt(1,5,9,13,n,r+2*c[a++]),Vt(2,6,10,14,n,r+2*c[a++]),jt(2,6,10,14,n,r+2*c[a++]),Vt(3,7,11,15,n,r+2*c[a++]),jt(3,7,11,15,n,r+2*c[a++]),Vt(0,5,10,15,n,r+2*c[a++]),jt(0,5,10,15,n,r+2*c[a++]),Vt(1,6,11,12,n,r+2*c[a++]),jt(1,6,11,12,n,r+2*c[a++]),Vt(2,7,8,13,n,r+2*c[a++]),jt(2,7,8,13,n,r+2*c[a++]),Vt(3,4,9,14,n,r+2*c[a++]),jt(3,4,9,14,n,r+2*c[a++]);this.v0l^=L[0]^L[16],this.v0h^=L[1]^L[17],this.v1l^=L[2]^L[18],this.v1h^=L[3]^L[19],this.v2l^=L[4]^L[20],this.v2h^=L[5]^L[21],this.v3l^=L[6]^L[22],this.v3h^=L[7]^L[23],this.v4l^=L[8]^L[24],this.v4h^=L[9]^L[25],this.v5l^=L[10]^L[26],this.v5h^=L[11]^L[27],this.v6l^=L[12]^L[28],this.v6h^=L[13]^L[29],this.v7l^=L[14]^L[30],this.v7h^=L[15]^L[31],un(L)}destroy(){this.destroyed=!0,un(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Ns=hi(t=>new Rd(t));function ea(t,e,n,r,s,o,i,a,c,l,f,u,d,h,g,p,m,b,y,v){let x=0;for(let k=0;k<r;k++)({a:s,b:c,c:d,d:m}=zt(s,c,d,m,n[e+t[x++]])),{a:s,b:c,c:d,d:m}=Ft(s,c,d,m,n[e+t[x++]]),{a:o,b:l,c:h,d:b}=zt(o,l,h,b,n[e+t[x++]]),{a:o,b:l,c:h,d:b}=Ft(o,l,h,b,n[e+t[x++]]),{a:i,b:f,c:g,d:y}=zt(i,f,g,y,n[e+t[x++]]),{a:i,b:f,c:g,d:y}=Ft(i,f,g,y,n[e+t[x++]]),{a,b:u,c:p,d:v}=zt(a,u,p,v,n[e+t[x++]]),{a,b:u,c:p,d:v}=Ft(a,u,p,v,n[e+t[x++]]),{a:s,b:l,c:g,d:v}=zt(s,l,g,v,n[e+t[x++]]),{a:s,b:l,c:g,d:v}=Ft(s,l,g,v,n[e+t[x++]]),{a:o,b:f,c:p,d:m}=zt(o,f,p,m,n[e+t[x++]]),{a:o,b:f,c:p,d:m}=Ft(o,f,p,m,n[e+t[x++]]),{a:i,b:u,c:d,d:b}=zt(i,u,d,b,n[e+t[x++]]),{a:i,b:u,c:d,d:b}=Ft(i,u,d,b,n[e+t[x++]]),{a,b:c,c:h,d:y}=zt(a,c,h,y,n[e+t[x++]]),{a,b:c,c:h,d:y}=Ft(a,c,h,y,n[e+t[x++]]);return{v0:s,v1:o,v2:i,v3:a,v4:c,v5:l,v6:f,v7:u,v8:d,v9:h,v10:g,v11:p,v12:m,v13:b,v14:y,v15:v}}const kl=new TextEncoder().encode("SS58PRE"),Fo=2,Sl=t=>{try{const e=pl.decode(t),n=e.subarray(0,e[0]&64?2:1),r=e.subarray(n.length,e.length-Fo),s=e.subarray(n.length+r.length),o=Ns(Uint8Array.of(...kl,...n,...r),{dkLen:64}).subarray(0,Fo);return s[0]===o[0]&&s[1]===o[1]?{isValid:!0,ss58Format:Pd(n),publicKey:r.slice()}:{isValid:!1}}catch{return{isValid:!1}}},Pd=t=>{const e=new DataView(t.buffer,t.byteOffset,t.byteLength);return e.byteLength===1?e.getUint8(0):e.getUint16(0)},Md=t=>{let e={},n=0,r=0;const s=()=>{n===r?(e={},n=r=0):(r=n,setTimeout(s,0))};return o=>{var i,a;++n===1&&s();let c=e;const l=o.length-1;for(let f=0;f<=l;f++)c=c[i=o[f]]||(c[i]={});return c[a=o[l]]||(c[a]=t(o))}},Bl=t=>{const e=t<64?Uint8Array.of(t):Uint8Array.of((t&252)>>2|64,t>>8|(t&3)<<6);return Md(n=>{const r=Ns(Uint8Array.of(...kl,...e,...n),{dkLen:64}).subarray(0,Fo);return pl.encode(Uint8Array.of(...e,...n,...r))})};function Hd(t,e){return n=>{const r=Sl(n);if(!r.isValid)throw new Error("Invalid checksum");const{publicKey:s}=r;if(s.length!==t)throw new Error("Invalid public key length");return s}}const gn=(t=42,e=32)=>wt(ee(e),Hd(e),Bl(t)),ta="0123456789abcdef";function oe(t){const e=new Array(t.length+1);e[0]="0x";for(let n=0;n<t.length;){const r=t[n++];e[n]=ta[r>>4]+ta[r&15]}return e.join("")}const io={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};function Le(t){const e=t.length%2,n=(t[1]==="x"?2:0)+e,r=(t.length-n)/2+e,s=new Uint8Array(r);e&&(s[0]=0|io[t[2]]);for(let o=0;o<r;){const i=n+o*2,a=io[t[i]],c=io[t[i+1]];s[e+o++]=a<<4|c}return s}function Wn(t,e){return Object.fromEntries(Object.entries(t).map(([n,r])=>[n,e(r,n)]))}const ke=(...t)=>{const e=Array.isArray(t[0])?t[0]:t,n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);for(let s=0,o=0;s<e.length;s++){const i=e[s];r.set(i,o),o+=i.byteLength}return r},On=Function.prototype;class Al extends Error{constructor(){super("Abort Error"),this.name="AbortError"}}var Dd=Object.defineProperty,Il=t=>{throw TypeError(t)},Ud=(t,e,n)=>e in t?Dd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ur=(t,e,n)=>Ud(t,typeof e!="symbol"?e+"":e,n),$l=(t,e,n)=>e.has(t)||Il("Cannot "+n),St=(t,e,n)=>($l(t,e,"read from private field"),n?n.call(t):e.get(t)),hr=(t,e,n)=>e.has(t)?Il("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),yn=(t,e,n,r)=>($l(t,e,"write to private field"),e.set(t,n),n),Tt,vr,ss,os,is;const Nd=new TextEncoder,zd=new TextDecoder,Fd=Ve(_e,ee(1/0))[1];class Xe{constructor(e,n=!1){if(hr(this,Tt),hr(this,vr,null),hr(this,ss,null),hr(this,os,null),hr(this,is,null),ur(this,"asText",()=>St(this,is)??yn(this,is,zd.decode(St(this,Tt)))),ur(this,"asHex",()=>St(this,ss)??yn(this,ss,oe(St(this,Tt)))),ur(this,"asOpaqueHex",()=>St(this,os)??yn(this,os,oe(this.asOpaqueBytes()))),ur(this,"asBytes",()=>St(this,Tt)),ur(this,"asOpaqueBytes",()=>St(this,vr)??yn(this,vr,ke([_e[0](St(this,Tt).length),St(this,Tt)]))),n){try{const[r,s]=Fd(e);if(r===s.length){yn(this,Tt,s),yn(this,vr,e);return}}catch{}throw new Error("Invalid opaque bytes")}else yn(this,Tt,e)}static fromText(e){return new this(Nd.encode(e))}static fromHex(e){return new this(Le(e))}static fromOpaqueHex(e){return new this(Le(e),!0)}static fromBytes(e){return new this(e)}static fromOpaqueBytes(e){return new this(e,!0)}}Tt=new WeakMap;vr=new WeakMap;ss=new WeakMap;os=new WeakMap;is=new WeakMap;const[Vd]=gn();class fi extends Xe{constructor(e){super(e)}static fromArray(e){return new this(new Uint8Array(e))}static fromAccountId32(e){return new this(Vd(e))}}const Cl=t=>{const e=ee.enc(t);return n=>e(n.asBytes())},_l=t=>{const e=ee.dec(t),n=t==null?Xe:fi;return r=>n.fromBytes(e(r))},Rr=t=>Q(Cl(t),_l(t));Rr.enc=Cl;Rr.dec=_l;const H=wt(_e,t=>t,Number),vs=wt(_e,t=>t,BigInt),jd=Ut(t=>{const e=H.dec(t),n=Math.ceil(e/8);return{bytes:ee(n).dec(t),bitsLen:e}}),Gd=t=>{if(t.bitsLen>t.bytes.length*8)throw new Error(`Not enough bytes. (bitsLen:${t.bitsLen}, bytesLen:${t.bytes.length})`);const e=H.enc(t.bitsLen),n=new Uint8Array(t.bytes.length+e.length);return n.set(e,0),n.set(t.bytes,e.length),n},qd=Q(Gd,jd),Wd=wt(Z,t=>t.charCodeAt(0),String.fromCharCode),Ol=t=>{const e=ee.enc(t);return n=>e(Le(n))},Tl=t=>{const e=ee.dec(t);return n=>oe(e(n))},Re=t=>Q(Ol(t),Tl(t));Re.enc=Ol;Re.dec=Tl;const Ll=new TextEncoder,Kd=new TextDecoder,Yd=t=>wt(ee(t),e=>Ll.encode(e),e=>Kd.decode(e)),Rl=t=>{let e=n=>{const r=t();return e=r,r(n)};return n=>e(n)},Pl=t=>{let e=n=>{const r=t(),s=r;return e=r,s(n)};return n=>e(n)},di=t=>Q(Rl(()=>t().enc),Pl(()=>t().dec)),Zd={is(t,e){return t.type===e},as(t,e){if(e!==t.type)throw new Error(`Enum.as(enum, ${e}) used with actual type ${t.type}`);return t}},zs=Object.assign((t,e)=>({type:t,value:e}),Zd),Xd=new Proxy({},{get(t,e){return n=>zs(e,n)}}),ie=(t,e)=>{const n=t;return n.inner=e,n},Ml=(...t)=>{const e=ze.enc(...t);return ie(n=>e({tag:n.type,value:n.value}),t[0])},Hl=(...t)=>{const e=ze.dec(...t);return ie(n=>{const{tag:r,value:s}=e(n);return zs(r,s)},t[0])},De=(t,...e)=>ie(Q(Ml(Wn(t,([n])=>n),...e),Hl(Wn(t,([,n])=>n),...e)),t);De.enc=Ml;De.dec=Hl;const pi=(t,...e)=>ie(ze(t,...e),t);pi.enc=(t,...e)=>ie(ze.enc(t,...e),t);pi.dec=(t,...e)=>ie(ze.dec(t,...e),t);const ft={CHUNK_START:1,CHUNK_END:2,PARENT:4,ROOT:8,KEYED_HASH:16,DERIVE_KEY_CONTEXT:32,DERIVE_KEY_MATERIAL:64},Bt=kd.slice(),na=(()=>{const t=Array.from({length:16},(r,s)=>s),e=r=>[2,6,3,10,7,0,4,13,1,11,12,5,9,14,15,8].map(s=>r[s]),n=[];for(let r=0,s=t;r<7;r++,s=e(s))n.push(...s);return Uint8Array.from(n)})();class gi extends El{constructor(n={},r=0){super(64,n.dkLen===void 0?32:n.dkLen);w(this,"chunkPos",0);w(this,"chunksDone",0);w(this,"flags",0);w(this,"IV");w(this,"state");w(this,"stack",[]);w(this,"posOut",0);w(this,"bufferOut32",new Uint32Array(16));w(this,"bufferOut");w(this,"chunkOut",0);w(this,"enableXOF",!0);const{key:s,context:o}=n,i=o!==void 0;if(s!==void 0){if(i)throw new Error('Only "key" or "context" can be specified at same time');et(s,32,"key");const a=s.slice();this.IV=Ln(a),Oe(this.IV),this.flags=r|ft.KEYED_HASH}else if(i){et(o,void 0,"context");const a=o,c=new gi({dkLen:32},ft.DERIVE_KEY_CONTEXT).update(a).digest();this.IV=Ln(c),Oe(this.IV),this.flags=r|ft.DERIVE_KEY_MATERIAL}else this.IV=Bt.slice(),this.flags=r;this.state=this.IV.slice(),this.bufferOut=wd(this.bufferOut32)}get(){return[]}set(){}b2Compress(n,r,s,o=0){const{state:i,pos:a}=this,{h:c,l}=bs(BigInt(n),!0),{v0:f,v1:u,v2:d,v3:h,v4:g,v5:p,v6:m,v7:b,v8:y,v9:v,v10:x,v11:k,v12:$,v13:A,v14:S,v15:E}=ea(na,o,s,7,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],Bt[0],Bt[1],Bt[2],Bt[3],c,l,a,r);i[0]=f^y,i[1]=u^v,i[2]=d^x,i[3]=h^k,i[4]=g^$,i[5]=p^A,i[6]=m^S,i[7]=b^E}compress(n,r=0,s=!1){let o=this.flags;if(this.chunkPos||(o|=ft.CHUNK_START),(this.chunkPos===15||s)&&(o|=ft.CHUNK_END),s||(this.pos=this.blockLen),this.b2Compress(this.chunksDone,o,n,r),this.chunkPos+=1,this.chunkPos===16||s){let i=this.state;this.state=this.IV.slice();for(let a,c=this.chunksDone+1;(s||!(c&1))&&(a=this.stack.pop());c>>=1)this.buffer32.set(a,0),this.buffer32.set(i,8),this.pos=this.blockLen,this.b2Compress(0,this.flags|ft.PARENT,this.buffer32,0),i=this.state,this.state=this.IV.slice();this.chunksDone++,this.chunkPos=0,this.stack.push(i)}this.pos=0}_cloneInto(n){n=super._cloneInto(n);const{IV:r,flags:s,state:o,chunkPos:i,posOut:a,chunkOut:c,stack:l,chunksDone:f}=this;return n.state.set(o.slice()),n.stack=l.map(u=>Uint32Array.from(u)),n.IV.set(r),n.flags=s,n.chunkPos=i,n.chunksDone=f,n.posOut=a,n.chunkOut=c,n.enableXOF=this.enableXOF,n.bufferOut32.set(this.bufferOut32),n}destroy(){this.destroyed=!0,un(this.state,this.buffer32,this.IV,this.bufferOut32),un(...this.stack)}b2CompressOut(){const{state:n,pos:r,flags:s,buffer32:o,bufferOut32:i}=this,{h:a,l:c}=bs(BigInt(this.chunkOut++));Oe(o);const{v0:l,v1:f,v2:u,v3:d,v4:h,v5:g,v6:p,v7:m,v8:b,v9:y,v10:v,v11:x,v12:k,v13:$,v14:A,v15:S}=ea(na,0,o,7,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],Bt[0],Bt[1],Bt[2],Bt[3],c,a,r,s);i[0]=l^b,i[1]=f^y,i[2]=u^v,i[3]=d^x,i[4]=h^k,i[5]=g^$,i[6]=p^A,i[7]=m^S,i[8]=n[0]^b,i[9]=n[1]^y,i[10]=n[2]^v,i[11]=n[3]^x,i[12]=n[4]^k,i[13]=n[5]^$,i[14]=n[6]^A,i[15]=n[7]^S,Oe(o),Oe(i),this.posOut=0}finish(){if(this.finished)return;this.finished=!0,un(this.buffer.subarray(this.pos));let n=this.flags|ft.ROOT;this.stack.length?(n|=ft.PARENT,Oe(this.buffer32),this.compress(this.buffer32,0,!0),Oe(this.buffer32),this.chunksDone=0,this.pos=this.blockLen):n|=(this.chunkPos?0:ft.CHUNK_START)|ft.CHUNK_END,this.flags=n,this.b2CompressOut()}writeInto(n){Ar(this,!1),et(n),this.finish();const{blockLen:r,bufferOut:s}=this;for(let o=0,i=n.length;o<i;){this.posOut>=r&&this.b2CompressOut();const a=Math.min(r-this.posOut,i-o);n.set(s.subarray(this.posOut,this.posOut+a),o),this.posOut+=a,o+=a}return n}xofInto(n){if(!this.enableXOF)throw new Error("XOF is not possible after digest call");return this.writeInto(n)}xof(n){return Jn(n),this.xofInto(new Uint8Array(n))}digestInto(n){if(ui(n,this),this.finished)throw new Error("digest() was already called");return this.enableXOF=!1,this.writeInto(n),this.destroy(),n}digest(){return this.digestInto(new Uint8Array(this.outputLen))}}const Jd=hi((t={})=>new gi(t)),Qd=BigInt(0),fr=BigInt(1),ep=BigInt(2),tp=BigInt(7),np=BigInt(256),rp=BigInt(113),Dl=[],Ul=[],Nl=[];for(let t=0,e=fr,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],Dl.push(2*(5*r+n)),Ul.push((t+1)*(t+2)/2%64);let s=Qd;for(let o=0;o<7;o++)e=(e<<fr^(e>>tp)*rp)%np,e&ep&&(s^=fr<<(fr<<BigInt(o))-fr);Nl.push(s)}const zl=Sd(Nl,!0),sp=zl[0],op=zl[1],ra=(t,e,n)=>n>32?Od(t,e,n):Cd(t,e,n),sa=(t,e,n)=>n>32?Td(t,e,n):_d(t,e,n);function ip(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let i=0;i<10;i++)n[i]=t[i]^t[i+10]^t[i+20]^t[i+30]^t[i+40];for(let i=0;i<10;i+=2){const a=(i+8)%10,c=(i+2)%10,l=n[c],f=n[c+1],u=ra(l,f,1)^n[a],d=sa(l,f,1)^n[a+1];for(let h=0;h<50;h+=10)t[i+h]^=u,t[i+h+1]^=d}let s=t[2],o=t[3];for(let i=0;i<24;i++){const a=Ul[i],c=ra(s,o,a),l=sa(s,o,a),f=Dl[i];s=t[f],o=t[f+1],t[f]=c,t[f+1]=l}for(let i=0;i<50;i+=10){for(let a=0;a<10;a++)n[a]=t[i+a];for(let a=0;a<10;a++)t[i+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=sp[r],t[1]^=op[r]}un(n)}class mi{constructor(e,n,r,s=!1,o=24){w(this,"state");w(this,"pos",0);w(this,"posOut",0);w(this,"finished",!1);w(this,"state32");w(this,"destroyed",!1);w(this,"blockLen");w(this,"suffix");w(this,"outputLen");w(this,"enableXOF",!1);w(this,"rounds");if(this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=s,this.rounds=o,Jn(r,"outputLen"),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Ln(this.state)}clone(){return this._cloneInto()}keccak(){Oe(this.state32),ip(this.state32,this.rounds),Oe(this.state32),this.posOut=0,this.pos=0}update(e){Ar(this),et(e);const{blockLen:n,state:r}=this,s=e.length;for(let o=0;o<s;){const i=Math.min(n-this.pos,s-o);for(let a=0;a<i;a++)r[this.pos++]^=e[o++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:r,blockLen:s}=this;e[r]^=n,n&128&&r===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Ar(this,!1),et(e),this.finish();const n=this.state,{blockLen:r}=this;for(let s=0,o=e.length;s<o;){this.posOut>=r&&this.keccak();const i=Math.min(r-this.posOut,o-s);e.set(n.subarray(this.posOut,this.posOut+i),s),this.posOut+=i,s+=i}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Jn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ui(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,un(this.state)}_cloneInto(e){const{blockLen:n,suffix:r,outputLen:s,rounds:o,enableXOF:i}=this;return e||(e=new mi(n,r,s,i,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=r,e.outputLen=s,e.enableXOF=i,e.destroyed=this.destroyed,e}}const ap=(t,e,n,r={})=>hi(()=>new mi(e,t,n),r),cp=ap(1,136,32),yi=cp,oa=t=>{const e=t.slice(2),n=oe(yi(Ll.encode(e))).slice(2),r=new Array(40);for(let s=0;s<40;s++){const o=parseInt(n[s],16),i=e[s];r[s]=o>7?i.toUpperCase():i}return`0x${r.join("")}`},lp=ee(20)[1],Fl=Q(t=>{const e=Le(t);if(e.length!==20)throw new Error(`Invalid length found on EthAddress(${t})`);const n=oe(e);if(t===n||t===n.toUpperCase())return e;if(oa(n)!==t)throw new Error(`Invalid checksum found on EthAddress(${t})`);return e},Ut(t=>oa(oe(lp(t))))),xe=t=>ie(z(t),t);xe.enc=t=>ie(z.enc(t),t);xe.dec=t=>ie(z.dec(t),t);const ct=(...t)=>ie(Ve(...t),t);ct.enc=(...t)=>ie(Ve.enc(...t),t);ct.dec=(...t)=>ie(Ve.dec(...t),t);const Ke=(t,...e)=>ie(q(t,...e),t);Ke.enc=(t,...e)=>ie(q.enc(t,...e),t);Ke.dec=(t,...e)=>ie(q.dec(t,...e),t);const Fs=(t,e)=>ie(Lr(t,e),{ok:t,ko:e});Fs.enc=(t,e)=>ie(Lr.enc(t,e),{ok:t,ko:e});Fs.dec=(t,e)=>ie(Lr.dec(t,e),{ok:t,ko:e});const mn=t=>ie(Fe(t),t);mn.enc=t=>ie(Fe.enc(t),t);mn.dec=t=>ie(Fe.dec(t),t);const Vl=(t=!0)=>Ut(e=>{const n=H.dec(e),r=Math.ceil(n/8),s=ee(r).dec(e),o=new Array(n);let i=0;return s.forEach(a=>{for(let c=0;c<8&&i<n;c++){const l=t?c:7-c;o[i++]=a>>l&1}}),o}),jl=(t=!0)=>e=>{const n=H.enc(e.length),r=Math.ceil(e.length/8),s=new Uint8Array(r);for(let o=0;o<r;o++){let i=o*8,a=0;for(let c=0;c<8&&i<e.length;c++,i++)a|=e[i]<<(t?c:7-c);s[o]=a}return ke([n,s])},Vs=t=>Q(jl(t),Vl(t));Vs.enc=jl;Vs.dec=Vl;const ia=new TextEncoder,aa=new TextDecoder,up=wt(ee(4),ia.encode.bind(ia),aa.decode.bind(aa)),ao=xe({engine:up,payload:Re()}),hp=De({other:ee(),consensus:ao,seal:ao,preRuntime:ao,runtimeUpdated:N},[0,4,5,6,8]),co=Re(32),ws=xe({parentHash:co,number:H,stateRoot:co,extrinsicRoot:co,digests:Ke(hp)}),We=q(K),ca=Fe(K),fp=ze({bool:N,char:N,str:N,u8:N,u16:N,u32:N,u64:N,u128:N,u256:N,i8:N,i16:N,i32:N,i64:N,i128:N,i256:N}),Gl=q(z({name:ca,type:H,typeName:ca,docs:We})),dp=z({len:tt,type:H}),pp=z({bitStoreType:H,bitOrderType:H}),gp=q(z({name:K,fields:Gl,index:Z,docs:We})),mp=ze({composite:Gl,variant:gp,sequence:H,array:dp,tuple:q(H),primitive:fp,compact:H,bitSequence:pp}),yp=z({name:K,type:Fe(H)}),bp=q(yp),vp=z({id:H,path:We,params:bp,def:mp,docs:We}),js=q(vp),Kn=ze({NotDeprecated:N,DeprecatedWithoutNote:N,Deprecated:z({note:K,since:Fe(K)})}),wp=q(z({index:Z,deprecation:ze({DeprecatedWithoutNote:N,Deprecated:z({note:K,since:Fe(K)})},[1,2])})),bi={name:K,inputs:q(z({name:K,type:H})),output:H,docs:We},xp=z({name:K,methods:q(z(bi)),docs:We}),Ep=z({name:K,methods:q(z({...bi,deprecationInfo:Kn})),docs:We,version:H,deprecationInfo:Kn}),kp=z({id:Re(32),...bi,deprecationInfo:Kn}),Sp=ze({Blake2128:N,Blake2256:N,Blake2128Concat:N,Twox128:N,Twox256:N,Twox64Concat:N,Identity:N}),Bp=q(Sp),Ap=z({hashers:Bp,key:H,value:H}),ql={name:K,modifier:Z,type:ze({plain:H,map:Ap}),fallback:Re(),docs:We},lo=Fe(H),Wl={name:K,storage:Fe(z({prefix:K,items:q(z(ql))})),calls:lo,events:lo,constants:q(z({name:K,type:H,value:Re(),docs:We})),errors:lo,index:Z},Ip={...Wl,docs:We},uo=Fe(z({type:H,deprecationInfo:wp})),$p={name:K,storage:Fe(z({prefix:K,items:q(z({...ql,deprecationInfo:Kn}))})),calls:uo,events:uo,constants:q(z({name:K,type:H,value:Re(),docs:We,deprecationInfo:Kn})),errors:uo,associatedTypes:q(z({name:K,type:H,docs:We})),viewFns:q(kp),index:Z,docs:We,deprecationInfo:Kn},Cp=new Uint8Array,la=t=>Q(()=>Cp,()=>t),_p=z({type:H,version:Z,signedExtensions:q(z({identifier:K,type:H,additionalSigned:H}))}),Kl=z({lookup:js,pallets:q(z({...Wl,docs:la([])})),extrinsic:_p,type:H,apis:la([])}),Op=z({version:Z,address:H,call:H,signature:H,extra:H,signedExtensions:q(z({identifier:K,type:H,additionalSigned:H}))}),Yl=z({lookup:js,pallets:q(z(Ip)),extrinsic:Op,type:H,apis:q(xp),outerEnums:z({call:H,event:H,error:H}),custom:q(Ve(K,z({type:H,value:Re()})))}),Tp=z({version:q(Z),address:H,call:H,signature:H,signedExtensionsByVersion:q(Ve(Z,q(H))),signedExtensions:q(z({identifier:K,type:H,additionalSigned:H}))}),Zl=z({lookup:js,pallets:q(z($p)),extrinsic:Tp,apis:q(Ep),outerEnums:z({call:H,event:H,error:H}),custom:q(Ve(K,z({type:H,value:Re()})))}),ua=()=>{throw new Error("Unsupported metadata version!")},Pe=Q(ua,ua),An=z({magicNumber:tt,metadata:ze({v0:Pe,v1:Pe,v2:Pe,v3:Pe,v4:Pe,v5:Pe,v6:Pe,v7:Pe,v8:Pe,v9:Pe,v10:Pe,v11:Pe,v12:Pe,v13:Pe,v14:Kl,v15:Yl,v16:Zl})}),vi=ee(),Lp=Fe(vi),Rp=Ve(_e,vi),Xl=t=>{try{return An.dec(t)}catch{}try{return An.dec(Lp.dec(t))}catch{}try{return An.dec(vi.dec(t))}catch{}try{return An.dec(Rp.dec(t)[1])}catch{}throw null},Gs=t=>{if("magicNumber"in t&&(t=t.metadata),"tag"in t){if(t.tag!=="v14"&&t.tag!=="v15"&&t.tag!=="v16")throw new Error("Only metadata 14, 15, and 16 are supported");t=t.value}if("signedExtensionsByVersion"in t.extrinsic)return{version:16,...t};if("custom"in t){const{lookup:s,extrinsic:o,custom:i,apis:a,pallets:c,outerEnums:l}=t;return{version:15,lookup:s,pallets:c.map(f=>({...f,calls:f.calls!=null?{type:f.calls}:void 0,events:f.events!=null?{type:f.events}:void 0,errors:f.errors!=null?{type:f.errors}:void 0,viewFns:[],associatedTypes:[]})),extrinsic:{...o,version:[o.version]},apis:a,outerEnums:l,custom:i}}const{lookup:e,extrinsic:n,pallets:r}=t;return{version:14,lookup:e,pallets:r.map(s=>({...s,calls:s.calls!=null?{type:s.calls}:void 0,events:s.events!=null?{type:s.events}:void 0,errors:s.errors!=null?{type:s.errors}:void 0,viewFns:[],associatedTypes:[]})),extrinsic:{...n,version:[n.version]},apis:[]}},bn={bare:0,0:"bare",general:1,1:"general",signed:2,2:"signed"},wi=wt(Z,({version:t,type:e})=>t+(bn[e]<<6),t=>{const e=t&63,n=t>>6;if(e===4&&(n===bn.bare||n===bn.signed))return{version:e,type:bn[n]};if(e===5&&(n===bn.bare||n===bn.general))return{version:e,type:bn[n]};throw new Error(`ExtrinsicFormat ${t} not valid`)}),Pp={dkLen:32},sr=t=>Ns(t,Pp),Mp={dkLen:16},xi=t=>Ns(t,Mp),Jl=t=>ke([xi(t),t]),Hp={dkLen:32},Ql=t=>Jd(t,Hp),Dp=t=>ke([Ql(t),t]),eu=t=>t,vn=(t,e,n,r)=>new DataView(new Uint16Array([t,e,n,r]).buffer).getBigUint64(0,!0),Ei=2n**64n-1n,Se=(t,e)=>t<<e&Ei|t>>64n-e,X=(t,e)=>t*e&Ei,pe=(t,e)=>t+e&Ei,ge=11400714785074694791n,je=14029467366897019727n,ha=1609587929392839161n,dr=9650029242287828579n,fa=2870177450012600261n;function an(t,e=0n){let n=pe(pe(e,ge),je),r=pe(e,je),s=e,o=e-ge,i=t.length,a=0,c=null;(function(){let h=0,g=h+i;if(i){if(c=new Uint8Array(32),i<32){c.set(t.subarray(0,i),a),a+=i;return}if(h<=g-32){const p=g-32;do{let m;m=vn(t[h+1]<<8|t[h],t[h+3]<<8|t[h+2],t[h+5]<<8|t[h+4],t[h+7]<<8|t[h+6]),n=X(Se(pe(n,X(m,je)),31n),ge),h+=8,m=vn(t[h+1]<<8|t[h],t[h+3]<<8|t[h+2],t[h+5]<<8|t[h+4],t[h+7]<<8|t[h+6]),r=X(Se(pe(r,X(m,je)),31n),ge),h+=8,m=vn(t[h+1]<<8|t[h],t[h+3]<<8|t[h+2],t[h+5]<<8|t[h+4],t[h+7]<<8|t[h+6]),s=X(Se(pe(s,X(m,je)),31n),ge),h+=8,m=vn(t[h+1]<<8|t[h],t[h+3]<<8|t[h+2],t[h+5]<<8|t[h+4],t[h+7]<<8|t[h+6]),o=X(Se(pe(o,X(m,je)),31n),ge),h+=8}while(h<=p)}h<g&&(c.set(t.subarray(h,g),a),a=g-h)}})(),t=c||t;let l,f=0;for(i>=32?(l=Se(n,1n),l=pe(l,Se(r,7n)),l=pe(l,Se(s,12n)),l=pe(l,Se(o,18n)),n=X(Se(X(n,je),31n),ge),l=l^n,l=pe(X(l,ge),dr),r=X(Se(X(r,je),31n),ge),l=l^r,l=pe(X(l,ge),dr),s=X(Se(X(s,je),31n),ge),l=l^s,l=pe(X(l,ge),dr),o=X(Se(X(o,je),31n),ge),l=l^o,l=pe(X(l,ge),dr)):l=pe(e,fa),l=pe(l,BigInt(i));f<=a-8;){let d=vn(t[f+1]<<8|t[f],t[f+3]<<8|t[f+2],t[f+5]<<8|t[f+4],t[f+7]<<8|t[f+6]);d=X(Se(X(d,je),31n),ge),l=pe(X(Se(l^d,27n),ge),dr),f+=8}if(f+4<=a){let d=X(vn(t[f+1]<<8|t[f],t[f+3]<<8|t[f+2],0,0),ge);l=pe(X(Se(l^d,23n),je),ha),f+=4}for(;f<a;){const d=X(vn(t[f++],0,0,0),fa);l=X(Se(l^d,11n),ge)}let u=l>>33n;return l=X(l^u,je),u=l>>29n,l=X(l^u,ha),u=l>>32n,l^=u,l}const xs=t=>{const e=new Uint8Array(16),n=new DataView(e.buffer);return n.setBigUint64(0,an(t),!0),n.setBigUint64(8,an(t,1n),!0),e},tu=t=>{const e=new Uint8Array(32),n=new DataView(e.buffer);return n.setBigUint64(0,an(t),!0),n.setBigUint64(8,an(t,1n),!0),n.setBigUint64(16,an(t,2n),!0),n.setBigUint64(24,an(t,3n),!0),e},nu=t=>ke([Tr.enc(an(t)),t]),da=new TextEncoder,Up=new Map([[eu,0],[nu,8],[Jl,16],[xi,-16],[sr,-32],[xs,-16],[tu,-32]]),ru=t=>{const e=xs(da.encode(t));return(n,...r)=>{const s=ke([e,xs(da.encode(n))]),o=oe(s),i=l=>{if(!l.startsWith(o))throw new Error(`key does not match this storage (${t}.${n})`);if(r.length===0)return[];const f=Le(l.slice(o.length)),u=new Array(r.length);for(let d=0,h=0;d<r.length;d++){const[g,p]=r[d],m=Up.get(p);if(m==null)throw new Error("Unknown hasher");if(m<0){const b=m*-1;u[d]=oe(f.slice(h,h+b)),h+=b}else h+=m,u[d]=g.dec(f.slice(h)),h+=g.enc(u[d]).length}return u},a=r.map(([{enc:l},f])=>u=>f(l(u)));return{enc:(...l)=>oe(ke([s,...l.map((f,u)=>a[u](f))])),dec:i}}},Np=Xe.fromText("modlpy/utilisuba").asBytes(),zp=({threshold:t,signatories:e})=>{const n=su(e),r=ke([Np,_e.enc(n.length),...n,bt.enc(t)]);return sr(r)},su=t=>t.slice().sort((e,n)=>{for(let r=0;;r++){const s=r>=e.length,o=r>=n.length;if(s&&o)return 0;if(s)return-1;if(o)return 1;if(e[r]!==n[r])return e[r]>n[r]?1:-1}}),rn={Leaf:"Leaf",Branch:"Branch",BranchWithVal:"BranchWithVal",LeafWithHash:"LeafWithHash",BranchWithHash:"BranchWithHash",Empty:"Empty",Reserved:"Reserved"},pa=Re().dec,Fp=Re(1/0).dec,Vp=Re(32).dec,ga=Z.dec,jp=t=>{const e=ga(t);let n=6;const r=e>>n,s=r?r===1?rn.Leaf:r===2?rn.Branch:rn.BranchWithVal:e>>--n?rn.LeafWithHash:e>>--n?rn.BranchWithHash:e?rn.Reserved:rn.Empty;let o=e&255>>8-n;if(o===2**n-1){let i;do o+=i=ga(t);while(i===255)}return{type:s,partialKey:Re(Math.ceil(o/2)).dec(t).slice(o%2?3:2)}},ou=Ut(t=>{const e=jp(t),{type:n}=e;if(n==="Empty"||n==="Reserved")return e;if(n==="Leaf"||n==="LeafWithHash")return{...e,value:Fp(t)};const r=bt.dec(t),s=[];for(let a=0;a<16;a++)r>>a&1&&s.push(a.toString(16));let o=null;n==="BranchWithVal"&&(o=pa(t)),n==="BranchWithHash"&&(o=Vp(t));const i={...e,children:Object.fromEntries(s.map(a=>[a,pa(t)]))};return o!==null&&(i.value=o),i}),iu=t=>Ut(e=>{const n=oe(t(new Uint8Array(e.buffer)));try{return{hash:n,...ou(e)}}catch{return{type:"Raw",hash:n,value:""}}}),Gp=(t,e=sr)=>{const n=t.map(iu(e)),r=Object.fromEntries(n.map(a=>[a.hash,a])),s=n.map(a=>a.hash),o=new Set(s),i=a=>{if(a.value)return;const c=t[s.indexOf(a.hash)];a.value=typeof c=="string"?c:oe(c)};return n.forEach(a=>{if("children"in a&&Object.values(a.children).forEach(c=>{const l=r[c];l&&(l.parent=a.hash,o.delete(c))}),a.type==="BranchWithHash"||a.type==="LeafWithHash"){const c=a.value,l=r[c];if(!l)return;o.delete(c),l.type!=="Raw"&&(Object.keys(l).forEach(f=>delete l[f]),l.type="Raw",l.hash=c),l.parent=a.hash,i(l)}a.type==="Raw"&&i(a)}),o.size===1?{rootHash:o.values().next().value,proofs:r}:null},au=Object.freeze(Object.defineProperty({__proto__:null,AccountId:gn,Bin:Rr,Binary:Xe,BitSeq:Vs,Blake2128:xi,Blake2128Concat:Jl,Blake2256:sr,Blake3256:Ql,Blake3256Concat:Dp,Bytes:ee,Enum:zs,FixedSizeBinary:fi,Hex:Re,Identity:eu,Keccak256:yi,Option:mn,Result:Fs,ScaleEnum:pi,Self:di,Storage:ru,Struct:xe,TrieNodeHeaders:rn,TrieNodeWithHash:iu,Tuple:ct,Twox128:xs,Twox256:tu,Twox64Concat:nu,Variant:De,Vector:Ke,_Enum:Xd,_void:N,bitSequence:qd,blockHeader:ws,bool:Yf,char:Wd,compact:_e,compactBn:vs,compactNumber:H,createCodec:Q,createDecoder:Ut,decAnyMetadata:Xl,enhanceCodec:wt,enhanceDecoder:Us,enhanceEncoder:Ds,ethAccount:Fl,extrinsicFormat:wi,fixedStr:Yd,fromBufferToBase58:Bl,getMultisigAccountId:zp,getSs58AddressInfo:Sl,h64:an,i128:qf,i16:Vf,i256:Kf,i32:jf,i64:Gf,i8:Ff,metadata:An,selfDecoder:Pl,selfEncoder:Rl,sortMultisigSignatories:su,str:K,trieNodeDec:ou,u128:Kc,u16:bt,u256:Wf,u32:tt,u64:Tr,u8:Z,unifyMetadata:Gs,v14:Kl,v14Lookup:js,v15:Yl,v16:Zl,validateProofs:Gp},Symbol.toStringTag,{value:"Module"})),Rt=H,qp=Ke(ct(K,Rt)),J={bool:"boolean",str:"string",num:"number",big:"bigint",bits:"bitseq",void:"void"},Wp=De(Object.fromEntries(Object.values(J).map(t=>[t,N]))),Kp=Ke(ct(K,De({inline:di(()=>ki),lookup:Rt}))),Yp=Ke(Rt),Zp=xe({typeRef:Rt,length:mn(Rt)}),Xp=mn(Rt),Jp=Rt,Qp=xe({ok:Rt,ko:Rt}),ki=De({struct:qp,terminal:Wp,enum:Kp,tuple:Yp,array:Zp,binary:Xp,option:Jp,result:Qp}),e0={i256:J.big,i128:J.big,i64:J.big,i32:J.num,i16:J.num,i8:J.num,u256:J.big,u128:J.big,u64:J.big,u32:J.num,u16:J.num,u8:J.num,bool:J.bool,char:J.str,str:J.str},pr=t=>({type:"terminal",value:{type:t}});function qs(t,e=()=>{}){switch(t.type){case"AccountId20":case"AccountId32":return pr(J.str);case"array":return t.value.type==="primitive"&&t.value.value==="u8"?{type:"binary",value:t.len}:(e(t.value.id),{type:"array",value:{typeRef:t.value.id,length:t.len}});case"bitSequence":return pr(J.bits);case"compact":return pr(t.isBig?J.big:J.num);case"enum":return{type:"enum",value:Object.entries(t.value).map(([n,r])=>r.type!=="lookupEntry"?[n,{type:"inline",value:qs(r,e)}]:(e(r.value.id),[n,{type:"lookup",value:r.value.id}]))};case"struct":{const n=Object.entries(t.value).map(([r,s])=>[r,s.id]);return n.forEach(([,r])=>e(r)),{type:"struct",value:n}}case"tuple":{const n=t.value.map(r=>r.id);return n.forEach(e),{type:"tuple",value:n}}case"option":return e(t.value.id),{type:"option",value:t.value.id};case"primitive":return pr(e0[t.value]);case"result":return e(t.value.ok.id),e(t.value.ko.id),{type:"result",value:{ok:t.value.ok.id,ko:t.value.ko.id}};case"sequence":return t.value.type==="primitive"&&t.value.value==="u8"?{type:"binary",value:void 0}:(e(t.value.id),{type:"array",value:{typeRef:t.value.id}});case"void":return pr(J.void)}}function Ws(t,e,n){if(e.type==="option"&&t==null)return!0;const r=(o,i)=>Ws(o,i,n),s=o=>{switch(o.value.type){case J.str:case J.big:case J.bool:case J.num:return typeof t===o.value.type;case J.bits:return typeof t=="object"&&t!=null&&typeof t.bitsLen=="number"&&t.bytes instanceof Uint8Array;case J.void:return!0}};switch(e.type){case"terminal":return s(e);case"binary":return t!=null&&typeof t.asBytes=="function"&&(e.value==null||t.asBytes().length>=e.value);case"array":if(!Array.isArray(t))return!1;const o=t;return e.value.length!=null&&o.length<e.value.length?!1:o.slice(0,e.value.length).every(l=>r(l,n(e.value.typeRef)));case"enum":if(!t)return!1;const i=t,a=Object.fromEntries(e.value);if(!(i.type in a))return!1;const c=a[i.type];return c==null?!0:r(i.value,c.type==="inline"?c.value:n(c.value));case"option":return t==null?!0:r(t,n(e.value));case"struct":return t?e.value.every(([l,f])=>r(t[l],n(f))):!1;case"tuple":return t?e.value.every((l,f)=>r(t[f],n(l))):!1;case"result":return"success"in t&&"value"in t?r(t.value,n(t.success?e.value.ok:e.value.ko)):!1}}function t0(t,e,n,r){if(t.length>e)return!1;let s=[n];return e>1&&(n.type==="tuple"?s=n.value.map(r):n.type==="array"&&n.value.length&&(s=new Array(n.value.length).fill(r(n.value.typeRef)))),t.every((o,i)=>Ws(o,s[i],r))}var n0=Object.defineProperty,r0=(t,e,n)=>e in t?n0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,s0=(t,e,n)=>r0(t,e+"",n);class cu{constructor(e=[]){s0(this,"value",new Map),e.forEach(([n,r])=>this.add(n,r))}has(e,n){var r;return((r=this.value.get(e))==null?void 0:r.has(n))??!1}add(e,n){this.value.has(e)||this.value.set(e,new Set),this.value.get(e).add(n)}addAll(e){e.forEach(([n,r])=>this.add(n,r))}delete(e,n){if(!this.value.has(e))return;const r=this.value.get(e);r.delete(n),r.size||this.value.delete(e)}isEmpty(){return!this.value.size}get values(){return Array.from(this.value).flatMap(([e,n])=>Array.from(n).map(r=>[e,r]))}}var it=(t=>(t[t.Incompatible=0]="Incompatible",t[t.Partial=1]="Partial",t[t.BackwardsCompatible=2]="BackwardsCompatible",t[t.Identical=3]="Identical",t))(it||{});function Vo(t,e,n,r,s,o=!1){if(!n&&!t)return lt(3,[]);if(!n)return lt(2,[]);if(!t)return lt(n.type==="option"?2:0,[]);s.has(n)||s.set(n,new Map);const i=s.get(n);if(i.has(t)){const c=i.get(t);return c==null?{level:3,changes:[],assumptions:new cu([[t,n]])}:lt(c.level,c.changes)}i.set(t,null);const a=o0(t,n,(c,l)=>Vo(typeof c=="number"?e(c):c,e,typeof l=="number"?r(l):l,r,s),o);return a.assumptions.delete(t,n),a.assumptions.isEmpty()||a.level===0?i.set(t,a):i.delete(t),a}function o0(t,e,n,r){const s=(o,i,a)=>{const c=n(o,i);return{...c,changes:c.level<3?[{id:[typeof o=="number"?o:null,typeof i=="number"?i:null],level:c.level,path:a}]:[]}};if(t.type!==e.type)return e.type==="option"?Fr(s(t,e.value,"some"),2):t.type==="option"?Fr(s(t.value,e,"some"),1):lt(0,[]);switch(e.type){case"terminal":return lt(e.value.type===t.value.type?3:0,[]);case"binary":return fo(ya(t.value,e.value));case"array":const i=t,a=fo(ya(i.value.length,e.value.length));return ho([a,()=>s(i.value.typeRef,e.value.typeRef,"value")],r);case"enum":{const d=t,h=Object.fromEntries(e.value.map(([m,b])=>[m,b.value]));let g=ma(d.value.map(([m,b])=>()=>m in h?s(b.value,h[m],m):lt(0,[{id:[typeof b.value=="number"?b.value:null,null],level:0,path:m}])));if(d.value.length===e.value.length)return g;g=Fr(g,2);const p=new Set(d.value.map(([m])=>m));return g.changes=[...g.changes,...e.value.filter(([m])=>!p.has(m)).map(([m,b])=>({id:[null,typeof b=="number"?b:null],level:0,path:m}))],g}case"option":return i0(s(t.value,e.value,"some"),1);case"struct":const c=t,l=Object.fromEntries(c.value),f=c.value.length===e.value.length?3:2;return Fr(ho(e.value.map(([d,h])=>()=>s(l[d],h,d)),r),f);case"tuple":{const d=t,h=fo(a0(d.value,e.value));return ho([h,...e.value.map((g,p)=>()=>s(d.value[p],g,String(p)))],r)}case"result":const u=t;return ma([s(u.value.ok,e.value.ok,"ok"),s(u.value.ko,e.value.ko,"ko")])}}const Fr=(t,e)=>({...t,level:Math.min(t.level,e)}),i0=(t,e)=>({...t,level:Math.max(t.level,e)}),lu=new cu,lt=(t,e)=>({level:t,changes:e,assumptions:lu}),ho=(t,e)=>{let n=lt(3,[]);for(const r of t){const s=typeof r=="function"?r():r;if(!e&&s.level===0)return s;s.level!==3&&(n.changes=[...n.changes,...s.changes]),n.assumptions.addAll(s.assumptions.values),n.level=Math.min(n.level,s.level)}return n},ma=t=>{if(!t.length)return lt(3,[]);let e=!1,n=lt(3,[]);for(const r of t){const s=typeof r=="function"?r():r;if(s.level!==3&&(n.changes=[...n.changes,...s.changes]),s.level===0){n.level=Math.min(n.level,1);continue}e=!0,n.assumptions.addAll(s.assumptions.values),n.level=Math.min(n.level,s.level)}return e?n:lt(0,n.changes)},fo=t=>({assumptions:lu,changes:t===3?[]:[{id:[null,null],level:t,path:"length"}],level:t}),a0=(t,e)=>e.length===t.length?3:t.length>=e.length?2:0,ya=(t,e)=>e===t?3:e==null||t>=e?2:t==null?1:0,ba=De({lookup:H,typedef:ki}),Yn=t=>({type:"lookup",value:t}),Si=t=>({type:"typedef",value:t}),Es=Si({type:"terminal",value:{type:J.void}}),c0=xe({args:ba,values:ba});function l0(t){if(t.type.tag==="plain")return{args:Es,values:Yn(t.type.value)};const{key:e,value:n}=t.type.value;return{args:Yn(e),values:Yn(n)}}function va(t){return{args:Si({type:"tuple",value:t.inputs.map(e=>e.type)}),values:Yn(t.output)}}function u0(t){return t.type==="lookupEntry"?Yn(t.value.id):Si(qs(t))}function h0(t){return{args:Es,values:Yn(t)}}function f0(t,e,n,r,s,o){const i=(a,c)=>a.type==="lookup"?c(a.value):a.value;return{args:Vo(i(t.args,e),e,i(n.args,r),r,s,o),values:Vo(i(n.values,r),r,i(t.values,e),e,s,o)}}function wa(t,e,n){const r=t.type==="lookup"?e(t.value):t.value;return Ws(n,r,e)}var jo=function(t,e){return jo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(n[s]=r[s])},jo(t,e)};function xt(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");jo(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function d0(t,e,n,r){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function a(f){try{l(r.next(f))}catch(u){i(u)}}function c(f){try{l(r.throw(f))}catch(u){i(u)}}function l(f){f.done?o(f.value):s(f.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function uu(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,s,o,i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(l){return function(f){return c([l,f])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(n=0)),n;)try{if(r=1,s&&(o=l[0]&2?s.return:l[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,l[1])).done)return o;switch(s=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,s=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){n.label=l[1];break}if(l[0]===6&&n.label<o[1]){n.label=o[1],o=l;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(l);break}o[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(f){l=[6,f],s=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Qn(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function nt(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),s,o=[],i;try{for(;(e===void 0||e-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(a){i={error:a}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return o}function rt(t,e,n){if(n||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}function Zn(t){return this instanceof Zn?(this.v=t,this):new Zn(t)}function p0(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),s,o=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",i),s[Symbol.asyncIterator]=function(){return this},s;function i(h){return function(g){return Promise.resolve(g).then(h,u)}}function a(h,g){r[h]&&(s[h]=function(p){return new Promise(function(m,b){o.push([h,p,m,b])>1||c(h,p)})},g&&(s[h]=g(s[h])))}function c(h,g){try{l(r[h](g))}catch(p){d(o[0][3],p)}}function l(h){h.value instanceof Zn?Promise.resolve(h.value.v).then(f,u):d(o[0][2],h)}function f(h){c("next",h)}function u(h){c("throw",h)}function d(h,g){h(g),o.shift(),o.length&&c(o[0][0],o[0][1])}}function g0(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Qn=="function"?Qn(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(i){return new Promise(function(a,c){i=t[o](i),s(a,c,i.done,i.value)})}}function s(o,i,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},i)}}function re(t){return typeof t=="function"}function Bi(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var po=Bi(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,s){return s+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function ks(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var or=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,s,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var a=Qn(i),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(p){e={error:p}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else i.remove(this);var f=this.initialTeardown;if(re(f))try{f()}catch(p){o=p instanceof po?p.errors:[p]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var d=Qn(u),h=d.next();!h.done;h=d.next()){var g=h.value;try{xa(g)}catch(p){o=o??[],p instanceof po?o=rt(rt([],nt(o)),nt(p.errors)):o.push(p)}}}catch(p){r={error:p}}finally{try{h&&!h.done&&(s=d.return)&&s.call(d)}finally{if(r)throw r.error}}}if(o)throw new po(o)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)xa(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&ks(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&ks(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),hu=or.EMPTY;function fu(t){return t instanceof or||t&&"closed"in t&&re(t.remove)&&re(t.add)&&re(t.unsubscribe)}function xa(t){re(t)?t():t.unsubscribe()}var m0={Promise:void 0},y0={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,rt([t,e],nt(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function du(t){y0.setTimeout(function(){throw t})}function Ue(){}function as(t){t()}var Ir=function(t){xt(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,fu(n)&&n.add(r)):r.destination=w0,r}return e.create=function(n,r,s){return new er(n,r,s)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(or),b0=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Vr(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Vr(r)}else Vr(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Vr(n)}},t}(),er=function(t){xt(e,t);function e(n,r,s){var o=t.call(this)||this,i;return re(n)||!n?i={next:n??void 0,error:r??void 0,complete:s??void 0}:i=n,o.destination=new b0(i),o}return e}(Ir);function Vr(t){du(t)}function v0(t){throw t}var w0={closed:!0,next:Ue,error:v0,complete:Ue},Ai=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Et(t){return t}function pu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return gu(t)}function gu(t){return t.length===0?Et:t.length===1?t[0]:function(n){return t.reduce(function(r,s){return s(r)},n)}}var V=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var s=this,o=E0(e)?e:new er(e,n,r);return as(function(){var i=s,a=i.operator,c=i.source;o.add(a?a.call(o,c):c?s._subscribe(o):s._trySubscribe(o))}),o},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=Ea(n),new n(function(s,o){var i=new er({next:function(a){try{e(a)}catch(c){o(c),i.unsubscribe()}},error:o,complete:s});r.subscribe(i)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Ai]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return gu(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Ea(e),new e(function(r,s){var o;n.subscribe(function(i){return o=i},function(i){return s(i)},function(){return r(o)})})},t.create=function(e){return new t(e)},t}();function Ea(t){var e;return(e=t??m0.Promise)!==null&&e!==void 0?e:Promise}function x0(t){return t&&re(t.next)&&re(t.error)&&re(t.complete)}function E0(t){return t&&t instanceof Ir||x0(t)&&fu(t)}function k0(t){return re(t==null?void 0:t.lift)}function se(t){return function(e){if(k0(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ne(t,e,n,r,s){return new S0(t,e,n,r,s)}var S0=function(t){xt(e,t);function e(n,r,s,o,i,a){var c=t.call(this,n)||this;return c.onFinalize=i,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(f){n.error(f)}}:t.prototype._next,c._error=o?function(l){try{o(l)}catch(f){n.error(f)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=s?function(){try{s()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(Ir),B0=Bi(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ut=function(t){xt(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new ka(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new B0},e.prototype.next=function(n){var r=this;as(function(){var s,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var i=Qn(r.currentObservers),a=i.next();!a.done;a=i.next()){var c=a.value;c.next(n)}}catch(l){s={error:l}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(s)throw s.error}}}})},e.prototype.error=function(n){var r=this;as(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var s=r.observers;s.length;)s.shift().error(n)}})},e.prototype.complete=function(){var n=this;as(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,s=this,o=s.hasError,i=s.isStopped,a=s.observers;return o||i?hu:(this.currentObservers=null,a.push(n),new or(function(){r.currentObservers=null,ks(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,s=r.hasError,o=r.thrownError,i=r.isStopped;s?n.error(o):i&&n.complete()},e.prototype.asObservable=function(){var n=new V;return n.source=this,n},e.create=function(n,r){return new ka(n,r)},e}(V),ka=function(t){xt(e,t);function e(n,r){var s=t.call(this)||this;return s.destination=n,s.source=r,s}return e.prototype.next=function(n){var r,s;(s=(r=this.destination)===null||r===void 0?void 0:r.next)===null||s===void 0||s.call(r,n)},e.prototype.error=function(n){var r,s;(s=(r=this.destination)===null||r===void 0?void 0:r.error)===null||s===void 0||s.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,s;return(s=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&s!==void 0?s:hu},e}(ut),A0=function(t){xt(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,s=n.thrownError,o=n._value;if(r)throw s;return this._throwIfClosed(),o},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(ut),Ii={now:function(){return(Ii.delegate||Date).now()},delegate:void 0},Pr=function(t){xt(e,t);function e(n,r,s){n===void 0&&(n=1/0),r===void 0&&(r=1/0),s===void 0&&(s=Ii);var o=t.call(this)||this;return o._bufferSize=n,o._windowTime=r,o._timestampProvider=s,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=r===1/0,o._bufferSize=Math.max(1,n),o._windowTime=Math.max(1,r),o}return e.prototype.next=function(n){var r=this,s=r.isStopped,o=r._buffer,i=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;s||(o.push(n),!i&&o.push(a.now()+c)),this._trimBuffer(),t.prototype.next.call(this,n)},e.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(n),s=this,o=s._infiniteTimeWindow,i=s._buffer,a=i.slice(),c=0;c<a.length&&!n.closed;c+=o?1:2)n.next(a[c]);return this._checkFinalizedStatuses(n),r},e.prototype._trimBuffer=function(){var n=this,r=n._bufferSize,s=n._timestampProvider,o=n._buffer,i=n._infiniteTimeWindow,a=(i?1:2)*r;if(r<1/0&&a<o.length&&o.splice(0,o.length-a),!i){for(var c=s.now(),l=0,f=1;f<o.length&&o[f]<=c;f+=2)l=f;l&&o.splice(0,l+1)}},e}(ut),I0=function(t){xt(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(or),Sa={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,rt([t,e],nt(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},$0=function(t){xt(e,t);function e(n,r){var s=t.call(this,n,r)||this;return s.scheduler=n,s.work=r,s.pending=!1,s}return e.prototype.schedule=function(n,r){var s;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,r)),this.pending=!0,this.delay=r,this.id=(s=this.id)!==null&&s!==void 0?s:this.requestAsyncId(i,this.id,r),this},e.prototype.requestAsyncId=function(n,r,s){return s===void 0&&(s=0),Sa.setInterval(n.flush.bind(n,this),s)},e.prototype.recycleAsyncId=function(n,r,s){if(s===void 0&&(s=0),s!=null&&this.delay===s&&this.pending===!1)return r;r!=null&&Sa.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var s=this._execute(n,r);if(s)return s;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var s=!1,o;try{this.work(n)}catch(i){s=!0,o=i||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,s=n.scheduler,o=s.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ks(o,this),r!=null&&(this.id=this.recycleAsyncId(s,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(I0),Ba=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=Ii.now,t}(),C0=function(t){xt(e,t);function e(n,r){r===void 0&&(r=Ba.now);var s=t.call(this,n,r)||this;return s.actions=[],s._active=!1,s}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var s;this._active=!0;do if(s=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,s){for(;n=r.shift();)n.unsubscribe();throw s}},e}(Ba),mu=new C0($0),_0=mu,fn=new V(function(t){return t.complete()});function yu(t){return t&&re(t.schedule)}function $i(t){return t[t.length-1]}function Ci(t){return re($i(t))?t.pop():void 0}function Mr(t){return yu($i(t))?t.pop():void 0}function O0(t,e){return typeof $i(t)=="number"?t.pop():e}var bu=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function vu(t){return re(t==null?void 0:t.then)}function wu(t){return re(t[Ai])}function xu(t){return Symbol.asyncIterator&&re(t==null?void 0:t[Symbol.asyncIterator])}function Eu(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function T0(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ku=T0();function Su(t){return re(t==null?void 0:t[ku])}function Bu(t){return p0(this,arguments,function(){var n,r,s,o;return uu(this,function(i){switch(i.label){case 0:n=t.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,Zn(n.read())];case 3:return r=i.sent(),s=r.value,o=r.done,o?[4,Zn(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,Zn(s)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function Au(t){return re(t==null?void 0:t.getReader)}function be(t){if(t instanceof V)return t;if(t!=null){if(wu(t))return L0(t);if(bu(t))return R0(t);if(vu(t))return P0(t);if(xu(t))return Iu(t);if(Su(t))return M0(t);if(Au(t))return H0(t)}throw Eu(t)}function L0(t){return new V(function(e){var n=t[Ai]();if(re(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function R0(t){return new V(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function P0(t){return new V(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,du)})}function M0(t){return new V(function(e){var n,r;try{for(var s=Qn(t),o=s.next();!o.done;o=s.next()){var i=o.value;if(e.next(i),e.closed)return}}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}e.complete()})}function Iu(t){return new V(function(e){D0(t,e).catch(function(n){return e.error(n)})})}function H0(t){return Iu(Bu(t))}function D0(t,e){var n,r,s,o;return d0(this,void 0,void 0,function(){var i,a;return uu(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=g0(t),c.label=1;case 1:return[4,n.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(i=r.value,e.next(i),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),s={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function hn(t,e,n,r,s){r===void 0&&(r=0),s===void 0&&(s=!1);var o=e.schedule(function(){n(),s?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(o),!s)return o}function $u(t,e){return e===void 0&&(e=0),se(function(n,r){n.subscribe(ne(r,function(s){return hn(r,t,function(){return r.next(s)},e)},function(){return hn(r,t,function(){return r.complete()},e)},function(s){return hn(r,t,function(){return r.error(s)},e)}))})}function Cu(t,e){return e===void 0&&(e=0),se(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function U0(t,e){return be(t).pipe(Cu(e),$u(e))}function N0(t,e){return be(t).pipe(Cu(e),$u(e))}function z0(t,e){return new V(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function F0(t,e){return new V(function(n){var r;return hn(n,e,function(){r=t[ku](),hn(n,e,function(){var s,o,i;try{s=r.next(),o=s.value,i=s.done}catch(a){n.error(a);return}i?n.complete():n.next(o)},0,!0)}),function(){return re(r==null?void 0:r.return)&&r.return()}})}function _u(t,e){if(!t)throw new Error("Iterable cannot be null");return new V(function(n){hn(n,e,function(){var r=t[Symbol.asyncIterator]();hn(n,e,function(){r.next().then(function(s){s.done?n.complete():n.next(s.value)})},0,!0)})})}function V0(t,e){return _u(Bu(t),e)}function j0(t,e){if(t!=null){if(wu(t))return U0(t,e);if(bu(t))return z0(t,e);if(vu(t))return N0(t,e);if(xu(t))return _u(t,e);if(Su(t))return F0(t,e);if(Au(t))return V0(t,e)}throw Eu(t)}function dn(t,e){return e?j0(t,e):be(t)}function he(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Mr(t);return dn(t,n)}function Pn(t,e){var n=re(t)?t:function(){return t},r=function(s){return s.error(n())};return new V(r)}var Ou=Bi(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function G0(t,e){return new Promise(function(n,r){var s=!1,o;t.subscribe({next:function(i){o=i,s=!0},error:r,complete:function(){s?n(o):r(new Ou)}})})}function qe(t,e){return new Promise(function(n,r){var s=new er({next:function(o){n(o),s.unsubscribe()},error:r,complete:function(){r(new Ou)}});t.subscribe(s)})}function q0(t){return t instanceof Date&&!isNaN(t)}function O(t,e){return se(function(n,r){var s=0;n.subscribe(ne(r,function(o){r.next(t.call(e,o,s++))}))})}var W0=Array.isArray;function K0(t,e){return W0(e)?t.apply(void 0,rt([],nt(e))):t(e)}function Tu(t){return O(function(e){return K0(t,e)})}var Y0=Array.isArray,Z0=Object.getPrototypeOf,X0=Object.prototype,J0=Object.keys;function Q0(t){if(t.length===1){var e=t[0];if(Y0(e))return{args:e,keys:null};if(eg(e)){var n=J0(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function eg(t){return t&&typeof t=="object"&&Z0(t)===X0}function tg(t,e){return t.reduce(function(n,r,s){return n[r]=e[s],n},{})}function Pt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Mr(t),r=Ci(t),s=Q0(t),o=s.args,i=s.keys;if(o.length===0)return dn([],n);var a=new V(Lu(o,n,i?function(c){return tg(i,c)}:Et));return r?a.pipe(Tu(r)):a}function Lu(t,e,n){return n===void 0&&(n=Et),function(r){Aa(e,function(){for(var s=t.length,o=new Array(s),i=s,a=s,c=function(f){Aa(e,function(){var u=dn(t[f],e),d=!1;u.subscribe(ne(r,function(h){o[f]=h,d||(d=!0,a--),a||r.next(n(o.slice()))},function(){--i||r.complete()}))},r)},l=0;l<s;l++)c(l)},r)}}function Aa(t,e,n){t?hn(n,t,e):e()}function ng(t,e,n,r,s,o,i,a){var c=[],l=0,f=0,u=!1,d=function(){u&&!c.length&&!l&&e.complete()},h=function(p){return l<r?g(p):c.push(p)},g=function(p){l++;var m=!1;be(n(p,f++)).subscribe(ne(e,function(b){e.next(b)},function(){m=!0},void 0,function(){if(m)try{l--;for(var b=function(){var y=c.shift();i||g(y)};c.length&&l<r;)b();d()}catch(y){e.error(y)}}))};return t.subscribe(ne(e,h,function(){u=!0,d()})),function(){}}function j(t,e,n){return n===void 0&&(n=1/0),re(e)?j(function(r,s){return O(function(o,i){return e(r,o,s,i)})(be(t(r,s)))},n):(typeof e=="number"&&(n=e),se(function(r,s){return ng(r,s,t,n)}))}function Ks(t){return t===void 0&&(t=1/0),j(Et,t)}function rg(){return Ks(1)}function tr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return rg()(dn(t,Mr(t)))}function Ys(t){return new V(function(e){be(t()).subscribe(e)})}function Zs(t,e,n){t===void 0&&(t=0),n===void 0&&(n=_0);var r=-1;return e!=null&&(yu(e)?n=e:r=e),new V(function(s){var o=q0(t)?+t-n.now():t;o<0&&(o=0);var i=0;return n.schedule(function(){s.closed||(s.next(i++),0<=r?this.schedule(void 0,r):s.complete())},o)})}function Hr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Mr(t),r=O0(t,1/0),s=t;return s.length?s.length===1?be(s[0]):Ks(r)(dn(s,n)):fn}var sg=new V(Ue),og=Array.isArray;function Ru(t){return t.length===1&&og(t[0])?t[0]:t}function vt(t,e){return se(function(n,r){var s=0;n.subscribe(ne(r,function(o){return t.call(e,o,s++)&&r.next(o)}))})}function ig(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=Ru(t),t.length===1?be(t[0]):new V(ag(t))}function ag(t){return function(e){for(var n=[],r=function(o){n.push(be(t[o]).subscribe(ne(e,function(i){if(n){for(var a=0;a<n.length;a++)a!==o&&n[a].unsubscribe();n=null}e.next(i)})))},s=0;n&&!e.closed&&s<t.length;s++)r(s)}}function Ne(t){return se(function(e,n){var r=null,s=!1,o;r=e.subscribe(ne(n,void 0,void 0,function(i){o=be(t(i,Ne(t)(e))),r?(r.unsubscribe(),r=null,o.subscribe(n)):s=!0})),s&&(r.unsubscribe(),r=null,o.subscribe(n))})}function cg(t,e,n,r,s){return function(o,i){var a=n,c=e,l=0;o.subscribe(ne(i,function(f){var u=l++;c=a?t(c,f,u):(a=!0,f),i.next(c)},s))}}function Pu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Ci(t);return n?pu(Pu.apply(void 0,rt([],nt(t))),Tu(n)):se(function(r,s){Lu(rt([r],nt(Ru(t))))(s)})}function lg(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Pu.apply(void 0,rt([],nt(t)))}function ug(t,e){return re(e)?j(t,e,1):j(t,1)}function Ce(t){return t<=0?function(){return fn}:se(function(e,n){var r=0;e.subscribe(ne(n,function(s){++r<=t&&(n.next(s),t<=r&&n.complete())}))})}function Go(){return se(function(t,e){t.subscribe(ne(e,Ue))})}function hg(t){return O(function(){return t})}function fg(t,e){return j(function(n,r){return be(t(n,r)).pipe(Ce(1),hg(n))})}function dg(t,e){e===void 0&&(e=mu);var n=Zs(t,e);return fg(function(){return n})}function pg(t,e){return se(function(n,r){var s=new Set;n.subscribe(ne(r,function(o){var i=t?t(o):o;s.has(i)||(s.add(i),r.next(o))})),e&&be(e).subscribe(ne(r,function(){return s.clear()},Ue))})}function Ee(t,e){return e===void 0&&(e=Et),t=t??gg,se(function(n,r){var s,o=!0;n.subscribe(ne(r,function(i){var a=e(i);(o||!t(s,a))&&(o=!1,s=a,r.next(i))}))})}function gg(t,e){return t===e}function Mu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(n){return tr(n,he.apply(void 0,rt([],nt(t))))}}function mg(t,e){return se(function(n,r){var s=0,o=null,i=!1;n.subscribe(ne(r,function(a){o||(o=ne(r,void 0,function(){o=null,i&&r.complete()}),be(t(a,s++)).subscribe(o))},function(){i=!0,!o&&r.complete()}))})}function yg(t){return se(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function bg(){return se(function(t,e){var n,r=!1;t.subscribe(ne(e,function(s){var o=n;n=s,r&&e.next([o,s]),r=!0}))})}function Ss(t,e){return se(cg(t,e,arguments.length>=2,!0))}function Dr(t){t===void 0&&(t={});var e=t.connector,n=e===void 0?function(){return new ut}:e,r=t.resetOnError,s=r===void 0?!0:r,o=t.resetOnComplete,i=o===void 0?!0:o,a=t.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var f,u,d,h=0,g=!1,p=!1,m=function(){u==null||u.unsubscribe(),u=void 0},b=function(){m(),f=d=void 0,g=p=!1},y=function(){var v=f;b(),v==null||v.unsubscribe()};return se(function(v,x){h++,!p&&!g&&m();var k=d=d??n();x.add(function(){h--,h===0&&!p&&!g&&(u=go(y,c))}),k.subscribe(x),!f&&h>0&&(f=new er({next:function($){return k.next($)},error:function($){p=!0,m(),u=go(b,s,$),k.error($)},complete:function(){g=!0,m(),u=go(b,i),k.complete()}}),be(v).subscribe(f))})(l)}}function go(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(e===!0){t();return}if(e!==!1){var s=new er({next:function(){s.unsubscribe(),t()}});return be(e.apply(void 0,rt([],nt(n)))).subscribe(s)}}function Xs(t,e,n){var r,s,o,i,a=!1;return t&&typeof t=="object"?(r=t.bufferSize,i=r===void 0?1/0:r,s=t.windowTime,e=s===void 0?1/0:s,o=t.refCount,a=o===void 0?!1:o,n=t.scheduler):i=t??1/0,Dr({connector:function(){return new Pr(i,e,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function Hu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Mr(t);return se(function(r,s){(n?tr(t,r,n):tr(t,r)).subscribe(s)})}function $r(t,e){return se(function(n,r){var s=null,o=0,i=!1,a=function(){return i&&!s&&r.complete()};n.subscribe(ne(r,function(c){s==null||s.unsubscribe();var l=0,f=o++;be(t(c,f)).subscribe(s=ne(r,function(u){return r.next(e?e(c,u,f,l++):u)},function(){s=null,a()}))},function(){i=!0,a()}))})}function vg(){return $r(Et)}function Du(t){return se(function(e,n){be(t).subscribe(ne(n,function(){return n.complete()},Ue)),!n.closed&&e.subscribe(n)})}function nr(t,e){return e===void 0&&(e=!1),se(function(n,r){var s=0;n.subscribe(ne(r,function(o){var i=t(o,s++);(i||e)&&r.next(o),!i&&r.complete()}))})}function ir(t,e,n){var r=re(t)||e||n?{next:t,error:e,complete:n}:t;return r?se(function(s,o){var i;(i=r.subscribe)===null||i===void 0||i.call(r);var a=!0;s.subscribe(ne(o,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),o.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),o.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),o.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):Et}function qo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Ci(t);return se(function(r,s){for(var o=t.length,i=new Array(o),a=t.map(function(){return!1}),c=!1,l=function(u){be(t[u]).subscribe(ne(s,function(d){i[u]=d,!c&&!a[u]&&(a[u]=!0,(c=a.every(Et))&&(a=null))},Ue))},f=0;f<o;f++)l(f);r.subscribe(ne(s,function(u){if(c){var d=rt([u],nt(i));s.next(n?n.apply(void 0,rt([],nt(d))):d)}}))})}var wg=Object.defineProperty,xg=(t,e,n)=>e in t?wg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ia=(t,e,n)=>xg(t,typeof e!="symbol"?e+"":e,n);class $a extends Error{constructor(e){super(e.message),Ia(this,"code"),Ia(this,"data"),this.code=e.code,this.data=e.data,this.name="RpcError"}}const Uu=()=>{const t=new Map;return{has:t.has.bind(t),subscribe(e,n){t.set(e,n)},unsubscribe(e){t.delete(e)},next(e,n){var r;(r=t.get(e))==null||r.next(n)},error(e,n){const r=t.get(e);r&&(t.delete(e),r.error(n))},errorAll(e){const n=[...t.values()];t.clear(),n.forEach(r=>{r.error(e)})}}};class Wo extends Error{constructor(){super("Client destroyed"),this.name="DestroyedError"}}let Eg=1;const kg=t=>{let e=Eg++;const n=new Map,r=Uu();let s=null;const o=(f,u,d)=>{s.send(JSON.stringify({jsonrpc:"2.0",id:f,method:u,params:d}))};function i(f){var u;try{let d,h,g,p,m;if({id:d,result:h,error:g,params:p}=JSON.parse(f),d===null)throw new Error(((u=p==null?void 0:p.error)==null?void 0:u.message)??"id null");if(d!=null){const v=n.get(d);return v?(n.delete(d),g?v.onError(new $a(g)):v.onSuccess(h,(x,k)=>{const $=x;return r.subscribe($,k),()=>{r.unsubscribe($)}})):void 0}if({subscription:m,result:h,error:g}=p,!m||!g&&!Object.hasOwn(p,"result"))throw 0;const y=m;g?r.error(y,new $a(g)):r.next(y,h)}catch(d){console.warn("Error parsing incomming message: "+f),console.error(d)}}s=t(i);const a=()=>{s==null||s.disconnect(),s=null,r.errorAll(new Wo),n.forEach(f=>f.onError(new Wo)),n.clear()};let c=1;return{request:(f,u,d)=>{if(!s)throw new Error("Not connected");const h=`${e}-${c++}`;return d&&n.set(h,d),o(h,f,u),()=>{n.delete(h)}},disconnect:a}};var Sg=Object.defineProperty,Bg=(t,e,n)=>e in t?Sg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ur=(t,e,n)=>Bg(t,e+"",n);const Nu=class zu extends Error{constructor(){super("ChainHead stopped"),this.name=zu.errorName}};Ur(Nu,"errorName","StopError");let Fu=Nu;const Vu=class ju extends Error{constructor(){super("ChainHead disjointed"),this.name=ju.errorName}};Ur(Vu,"errorName","DisjointError");let cs=Vu;const Gu=class qu extends Error{constructor(){super("ChainHead operations limit reached"),this.name=qu.errorName}};Ur(Gu,"errorName","OperationLimitError");let Js=Gu;const Wu=class Ku extends Error{constructor(e){super(e),this.name=Ku.errorName}};Ur(Wu,"errorName","OperationError");let Yu=Wu;const Zu=class Xu extends Error{constructor(){super("ChainHead operation inaccessible"),this.name=Xu.errorName}};Ur(Zu,"errorName","OperationInaccessibleError");let Qs=Zu;const Je={body:"",call:"",continue:"",follow:"",header:"",stopOperation:"",storage:"",unfollow:"",unpin:"",followEvent:""},ls={chainName:"",genesisHash:"",properties:""},Ko={broadcast:"",stop:""};Object.entries({chainHead:Je,chainSpec:ls,transaction:Ko}).forEach(([t,e])=>{Object.keys(e).forEach(n=>{e[n]=`${t}_v1_${n}`})});var Ag=Object.defineProperty,Ig=(t,e,n)=>e in t?Ag(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_i=(t,e,n)=>Ig(t,e+"",n);const Ju=class Qu extends Error{constructor(e){super(`Invalid BlockHash: ${e}`),this.name=Qu.errorName}};_i(Ju,"errorName","BlockHashNotFoundError");let eh=Ju;const th=class nh extends Error{constructor(e){super(`Storage Error: ${e}`),this.name=nh.errorName}};_i(th,"errorName","StorageError");let $g=th;const rh=class sh extends Error{constructor(e){super(`Call Error: ${e}`),this.name=sh.errorName}};_i(rh,"errorName","CallError");let Cg=rh;const jn=()=>{},_g=t=>(e,n)=>{let r=!1,s=()=>{r=!0};return t(Ko.broadcast,[e],{onSuccess:o=>{o!==null?(s=()=>{t(Ko.stop,[o]),s=jn},r&&s()):r||n(new Error("Max # of broadcasted transactions has been reached"))},onError:n}),()=>{s()}};function Og(){let t=()=>{},e=()=>{};return{promise:new Promise((r,s)=>{t=r,e=s}),res:t,rej:e}}const ar=t=>(...e)=>new Promise((n,r)=>{let s=On;const[o,i]=e[e.length-1]instanceof AbortSignal?[e.slice(0,e.length-1),e[e.length-1]]:[e],a=()=>{s(),r(new Al)};i==null||i.addEventListener("abort",a,{once:!0});const c=l=>f=>{s=On,i==null||i.removeEventListener("abort",a),l(f)};s=t(c(n),c(r),...o)}),oh=(t,e)=>n=>ar((r,s,...o)=>{let i=!0,a=()=>{i=!1};const[c,l]=e(...o);return n(t,c,{onSuccess:(f,u)=>{if(f.result==="limitReached")return s(new Js);const{operationId:d}=f,h=()=>{n(Je.stopOperation,[d])};if(!i)return h();let g=jn;const p=b=>{i=!1,g(),r(b)},m=b=>{i=!1,g(),s(b)};g=u(d,{next:b=>{const y=b;y.event==="operationError"?s(new Yu(y.error)):y.event==="operationInaccessible"?s(new Qs):l(b,p,m)},error:m}),a=()=>{i&&(g(),h())}},onError:s}),()=>{a()}}),Tg=oh(Je.body,t=>[[t],(e,n)=>{n(e.value)}]),Lg=oh(Je.call,(t,e,n)=>[[t,e,n],(r,s)=>{s(r.output)}]),Rg=t=>e=>new Promise((n,r)=>{t(Je.header,[e],{onSuccess:n,onError:r})}),ih=t=>(e,n,r,s,o,i,a)=>{if(n.length===0)return i(),On;let c=!0,l=()=>{c=!1};return t(Je.storage,[e,n,r],{onSuccess:(f,u)=>{if(f.result==="limitReached"||f.discardedItems===n.length)return o(new Js);const{operationId:d}=f,h=()=>{t(Je.stopOperation,[d])};if(!c)return h();const g=u(f.operationId,{next:b=>{switch(b.event){case"operationStorageItems":{s(b.items);break}case"operationStorageDone":{m();break}case"operationError":{p(new Yu(b.error));break}case"operationInaccessible":{p(new Qs);break}default:t(Je.continue,[b.operationId])}},error:o});l=()=>{g(),t(Je.stopOperation,[f.operationId])};const p=b=>{l=On,g(),o(b)},m=()=>{l=On,g(),i()};a(f.discardedItems)},onError:o}),()=>{l()}},Pg=t=>{const e=ih(t);return ar((n,r,s,o,i,a)=>{const c=o.startsWith("descendants");let l=c?[]:null;const u=e(s,[{key:i,type:o}],a??null,c?d=>{l.push(d)}:d=>{var h;l=(h=d[0])==null?void 0:h[o]},r,()=>{try{n(c?l.flat():l)}catch(d){r(d)}},d=>{d>0&&(u(),r(new Js))});return u})},Mg=t=>e=>e.length>0?new Promise((n,r)=>{t(Je.unpin,[e],{onSuccess(){n()},onError:r})}):Promise.resolve();function Hg(t){return t.operationId!==void 0}function Dg(t){return(e,n,r)=>{const s=Uu(),o=new Set,i=Og();let a=i.promise,c=jn;const l=g=>{t(Je.unfollow,[g])},f=g=>{c(),a!==null&&(g&&(a instanceof Promise?a.then(p=>{typeof p=="string"&&l(p)}):l(a)),a=null,o.forEach(p=>{p()}),o.clear(),s.errorAll(new cs))},u=g=>{if(Hg(g))return s.next(g.operationId,g);switch(g.event){case"stop":return r(new Fu),f(!1);case"initialized":case"newBlock":case"bestBlockChanged":case"finalized":const{event:p,...m}=g;return n({type:p,...m})}},d=g=>{r(g),f(!(g instanceof Wo))};t(Je.follow,[e],{onSuccess:(g,p)=>{a instanceof Promise&&(a=g,c=p(g,{next:u,error:d})),i.res(g)},onError:g=>{a=null,i.res(g),r(g)}});const h=(g,p,m)=>{const b=()=>{m==null||m.onError(new cs)};if(a===null)return b(),jn;const y=x=>{if(!m)return t(g,[x,...p]);o.add(b);const k=(A,S)=>a===null?(S.error(new cs),jn):(s.subscribe(A,S),()=>{s.unsubscribe(A)}),$=t(g,[x,...p],{onSuccess:A=>{o.delete(b),m.onSuccess(A,k)},onError:A=>{o.delete(b),m.onError(A)}});return()=>{o.delete(b),$()}};if(typeof a=="string")return y(a);let v=jn;return a.then(x=>{if(x instanceof Error)return b();a&&(v=y(x))}),()=>{v()}};return{unfollow(){f(!0)},body:Tg(h),call:Lg(h),header:Rg(h),storage:Pg(h),storageSubscription:ih(h),unpin:Mg(h),_request:h}}}const Ug=t=>{const e=ar((r,s,o,i)=>t(o,i,{onSuccess:r,onError:s}));let n=null;return async()=>n||(n=Promise.all([e(ls.chainName,[]),e(ls.genesisHash,[]),e(ls.properties,[])]).then(([r,s,o])=>({name:r,genesisHash:s,properties:o})))},Ng=t=>(e,n,r,s,o,i)=>{if(n.length===0)return i(),On;let a=!0,c=()=>{a=!1};return t("storage",[e,n,r],{onSuccess:(l,f)=>{const u=()=>{t("stopStorage",[l])};if(!a)return u();const d=f(l,{next:m=>{const{event:b}=m;if(b==="storage"){const{event:y,...v}=m;s(v)}else b==="storageDone"?p():g(new $g(m.error))},error:o}),h=()=>{c=On,d()};c=()=>{h(),u()};const g=m=>{h(),o(m)},p=()=>{h(),i()}},onError:o}),()=>{c()}},zg=t=>ar((e,n,r,s,o,i)=>{const a=s.startsWith("descendants");let c=a?[]:null;const l=a?c.push.bind(c):({[s]:f})=>{c=f};return t(r,[{key:o,type:s}],i,l,f=>{n(f),c=null},()=>{e(c),c=null})}),Ca=()=>t=>t,_a=()=>(t,e)=>{if(t===null)throw new eh(e);return t},Fg=t=>{const e=(f,...u)=>t(`archive_v1_${f}`,...u),n=f=>u=>ar((d,h,...g)=>e(f,g,{onSuccess:p=>{try{d(u(p,...g))}catch(m){h(m)}},onError:h})),r=n("header")(_a()),s=n("body")(_a()),o=Ng(e),i=zg(o),a=n("call")((f,u)=>{if(!f)throw new eh(u);if(!f.success)throw new Cg(f.error);return f.value}),c=n("finalizedHeight")(Ca()),l=n("hashByHeight")(Ca());return{header:r,body:s,storageSubscription:o,storage:i,call:a,finalizedHeight:c,hashByHeight:l}},Vg=t=>{const{request:e,disconnect:n}=kg(t);return{archive:Fg(e),chainHead:Dg(e),transaction:_g(e),getChainSpecData:Ug(e),destroy:n,request:ar((r,s,o,i)=>e(o,i,{onSuccess:r,onError:s})),_request:e}};var jg=Object.defineProperty,Gg=(t,e,n)=>e in t?jg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Oa=(t,e,n)=>Gg(t,typeof e!="symbol"?e+"":e,n);class qg{constructor(){Oa(this,"first"),Oa(this,"last")}getRemoveFn(e){return()=>{e.prev?e.prev.next=e.next:this.first=e.next,e.next?e.next.prev=e.prev:this.last=e.prev,delete e.prev,delete e.next}}push(e){const n={value:e};return this.last===void 0?this.last=this.first=n:(this.last.next=n,n.prev=this.last,this.last=n),this.getRemoveFn(n)}unshift(e){return this.first={value:e,next:this.first},this.first.next&&(this.first.next.prev=this.first),this.last||(this.last=this.first),this.getRemoveFn(this.first)}pop(){var n,r;const e=(n=this.first)==null?void 0:n.value;return this.first&&(this.first=this.first.next,this.first?((r=this.first.prev)==null||delete r.next,delete this.first.prev):this.last=void 0),e}isEmpty(){return!this.first}}const Wg=()=>{const t=new Map,e=(d,h)=>{t.set(d,()=>{t.delete(d),h()})},n=d=>{var h;(h=t.get(d))==null||h()},r=new qg,s=r.unshift.bind(r),o=r.push.bind(r),i=(d,h)=>{const g=h?s:o;e(d.source$,g(d))},a=()=>{const d=r.pop();d&&(t.delete(d.source$),c(d))},c=d=>{const{source$:h,observer:g}=d;let p=!1;const m=h.subscribe({next(b){g.next(b)},error(b){(p=b instanceof Error&&b.name===Js.errorName)?i(d,!0):g.error(b)},complete(){g.complete()}});m.closed?p||a():e(h,()=>{m.unsubscribe(),a()})},l=(d=!1)=>h=>new V(g=>{const p={observer:g,source$:h};return r.isEmpty()?c(p):i(p,d),()=>{n(h)}}),f=l();return{withRecovery:l,withRecoveryFn:d=>(...h)=>f(d(...h))}};class Mt extends Error{constructor(e,n){super(`Block ${e} is not pinned (${n})`),this.name="BlockNotPinnedError"}}const Yo=t=>{const e=t.pipe(Ne(n=>n instanceof Error&&n.name===Qs.errorName?Zs(750).pipe(ug(()=>e)):Pn(()=>n)));return e},Kg=new Set(["best","finalized",null]),Yg=(t,e,n)=>r=>(s,...o)=>{if(!Kg.has(s))return Yo(r(s,...o)).pipe(n(s));const a=(s==="best"?e:t).pipe(Ce(1),j(c=>r(c,...o).pipe(n(c))),Ne(c=>c instanceof Mt?a:Pn(()=>c)));return Yo(a)},In=t=>(...e)=>new V(n=>{let r=new AbortController;return t(...e,r.signal).then(s=>{n.next(s),n.complete()},s=>{n.error(s)}),()=>{n.unsubscribe(),r.abort(),r=void 0}}),Zg=t=>e=>(...n)=>t()[e](...n);var $e=(t=>(t[t.Initializing=0]="Initializing",t[t.Ready=1]="Ready",t[t.RecoveringInit=2]="RecoveringInit",t[t.RecoveringFin=3]="RecoveringFin",t))($e||{});function us(t,e,n){return(r,...s)=>{let o;const i=()=>new Mt(r,n),a=e(r,...s).pipe(O(l=>({type:"val",value:l})),Mu({type:"end"})),c=t.pipe(nr(l=>!l.blocks.has(r)),O(l=>{if(l.blocks.get(l.finalized).number>=o.number)throw i()}),Go());return t.pipe(O(l=>l.state.type===$e.Ready),Ee(),$r(l=>l?(o||(o=t.state.blocks.get(r)),o?tr(c,a):Pn(i)):sg),nr(l=>l.type==="val"),O(l=>l.value))}}const Xg=(t,e)=>{const n=(r,s,o,i)=>new V(a=>t().storageSubscription(r,s,o??null,c=>{a.next(c)},c=>{a.error(c)},()=>{a.complete()},c=>{c>0&&a.next(n(r,s.slice(-c),o,!0))})).pipe(Ks(),e(i));return n},Jg=[sr,yi],Qg=(t,e)=>Jg.find(n=>oe(n(Le(t)))===e)||(()=>{throw new Error("Unsupported hasher")}),em=t=>{const e=(n,r,s)=>{const o=n[r.idx],i=n[s.idx];if(n.length===2)return he([[o,r.id],[i,s.id]]);const a=r.idx+Math.floor((s.idx-r.idx)/2);return t(n[a]).pipe(j(c=>{const l={id:c,idx:a};return l.id===r.id?e(n,l,s):l.id===s.id?e(n,r,l):Pt([e(n,r,l),e(n,l,s)]).pipe(O(([f,[u,...d]])=>[...f,...d]))}))};return n=>{const[r]=n;if(n.length===1)return t(r).pipe(O(o=>[[r,o]]));const s=n.length-1;return Pt([r,n[s]].map(t)).pipe(j(([o,i])=>o===i?he([[r,o]]):e(n,{idx:0,id:o},{idx:s,id:i})))}},tm=(t,e,n)=>{const r=em(e),s=c=>Ys(()=>t().header(c)),o=new Pr(1),i=c=>{if(c.type==="initialized"){const[l]=c.finalizedBlockHashes;return Pt([s(l),r(c.finalizedBlockHashes)]).pipe(O(([f,u])=>{o.closed||(o.next(Qg(f,l)),o.complete());const{number:d,parentHash:h,digests:g}=ws.dec(f);return{type:"initialized",finalizedBlockHashes:c.finalizedBlockHashes,runtimeChanges:new Map(u),number:d,parentHash:h,hasNewRuntime:g.some(p=>p.type==="runtimeUpdated")}}))}if(c.type==="newBlock"&&c.newRuntime)return e(c.blockHash).pipe(O(l=>({...c,codeHash:l})))},a=c=>new V(l=>{let f=null,u;const d=p=>(f==null?void 0:f.push(p))||h(p),h=p=>{const m=i(p);m?(f=[],u=m.subscribe({next:b=>{const y=[...f];f=null,l.next(b),y.forEach(d)},error:n})):l.next(p)},g=c.subscribe(p=>{p.type==="stop-error"?(u==null||u.unsubscribe(),f=null,l.next(p)):d(p)});return()=>{u==null||u.unsubscribe(),g.unsubscribe()}});return{getHeader:c=>s(c).pipe(O(ws[1])),hasher$:o.asObservable(),enhancer:a}},nm=(t,e)=>{let n=null,r=!1,s=()=>{r=!0};const o=()=>{if(!n)throw new Error("Missing chainHead subscription");return n},i=e(In((d,h)=>o().storage(d,"hash","0x3a636f6465",null,h)));let a=Ue;const{hasher$:c,enhancer:l,getHeader:f}=tm(o,i,()=>a()),u=new V(d=>{if(r)return d.complete();let h;const g=()=>{n=t(!0,p=>d.next(p),p=>{n=null,!r&&(p instanceof Error&&p.name===Fu.errorName?(g(),d.next({type:"stop-error"})):(console.warn("ChainHead follow request failed, retrying",p),h=setTimeout(g,250)))})};a=()=>{d.next({type:"stop-error"}),clearTimeout(h),n==null||n.unfollow(),g()},g(),s=()=>{r=!0,clearTimeout(h),d.complete(),n==null||n.unfollow()}}).pipe(l,Dr());return{getHeader:f,hasher$:c,getFollower:o,follow$:u,unfollow:()=>{s()}}},rm=t=>oe(tt.enc(t)),ah=ee(),sm=mn(ah),om=Ke(tt).dec,ch=t=>{const e=t("Metadata_metadata_versions","").pipe(O(om),Ne(()=>he([14]))),n=r=>{const[s]=r.filter(o=>o>13&&o<17).sort((o,i)=>i-o);return s===14?t("Metadata_metadata","").pipe(O(ah.dec)):t("Metadata_metadata_at_version",rm(s)).pipe(O(o=>sm.dec(o)))};return e.pipe(j(n))},Ta=(t,e)=>t.type==="array"&&t.len===e&&t.value.type==="primitive"&&t.value.value==="u8",sn={type:"void"},im=(t,e=()=>null)=>{const n=new Map,r=new Set,s=f=>u=>{let d=n.get(u);if(d)return d;if(r.has(u)){const g={id:u};return n.set(u,g),g}r.add(u);const h=f(u);return d=n.get(u),d?Object.assign(d,h):(d={id:u,...h},n.set(u,d)),r.delete(u),d};let o=!0,i=!0;const a=s(f=>{const u=e(t[f]);if(u)return u;const{def:d,path:h,params:g}=t[f];if(d.tag==="composite"){if(d.value.length===0)return sn;if(d.value.length===1){const p=a(d.value[0].type);return o&&h.at(-1)==="AccountId32"&&Ta(p,32)?(o=!1,{type:"AccountId32"}):i&&h.at(-1)==="AccountId20"&&Ta(p,20)?(i=!1,{type:"AccountId20"}):p}return c(d.value)}if(d.tag==="variant"){if(h.length===1&&h[0]==="Option"&&g.length===1&&g[0].name==="T"){const b=a(g[0].type);return b.type==="void"?{type:"primitive",value:"bool"}:{type:"option",value:b}}if(h.length===1&&h[0]==="Result"&&g.length===2&&g[0].name==="T"&&g[1].name==="E")return{type:"result",value:{ok:a(g[0].type),ko:a(g[1].type)}};if(d.value.length===0)return sn;const p={},m={};return d.value.forEach(b=>{const y=b.name;if(m[y]=b.docs,b.fields.length===0){p[y]={...sn,idx:b.index};return}if(b.fields.length===1&&!b.fields[0].name){p[y]={type:"lookupEntry",value:a(b.fields[0].type),idx:b.index};return}p[y]={...c(b.fields),idx:b.index}}),{type:"enum",value:p,innerDocs:m}}if(d.tag==="sequence")return{type:"sequence",value:a(d.value)};if(d.tag==="array"){const{len:p}=d.value,m=a(d.value.type);return!p||m.type==="void"?sn:p>1?{type:"array",value:m,len:d.value.len}:m}if(d.tag==="tuple")return d.value.length===0?sn:d.value.length>1?l(d.value.map(p=>a(p)),d.value.map(p=>t[p].docs)):a(d.value[0]);if(d.tag==="primitive")return{type:"primitive",value:d.value.tag};if(d.tag==="compact"){const p=a(d.value);return p.type==="void"?sn:{type:"compact",isBig:Number(p.value.slice(1))>32,size:p.value}}return{type:d.tag,isLSB:(t[d.value.bitOrderType].path.at(-1)??"LSB").toUpperCase().startsWith("LSB")}}),c=f=>{let u=!0;const d={},h={};return f.forEach((g,p)=>{u=u&&!!g.name;const m=g.name||p,b=a(g.type);b.type!=="void"&&(d[m]=b,h[m]=g.docs)}),u?{type:"struct",value:d,innerDocs:h}:l(Object.values(d),Object.values(h))},l=(f,u)=>{if(f.every(d=>d.id===f[0].id)&&u.every(d=>!d.length)){const[d]=f;return d.type==="void"?sn:{type:"array",value:f[0],len:f.length}}return{type:"tuple",value:f,innerDocs:u}};return a},lh=t=>{const e=im(t.lookup,({def:s})=>{if(s.tag==="composite"){const o=n(s);if(o)return{type:"enum",innerDocs:{},value:Object.fromEntries(t.pallets.map(i=>[i.name,i.errors==null?{...sn,idx:i.index}:{type:"lookupEntry",value:e(i.errors.type),idx:i.index}])),byteLength:o}}return null});function n(s){if(!(s.value.length===2&&s.value[0].name==="index"&&s.value[1].name==="error"))return null;const i=e(s.value[0].type),a=e(s.value[1].type);return i.type==="primitive"&&i.value==="u8"&&a.type==="array"&&a.value.type==="primitive"&&a.value.value==="u8"?1+a.len:null}return Object.assign(e,{metadata:t,call:(()=>{if("call"in t.extrinsic)return t.extrinsic.call;const s=t.lookup[t.extrinsic.type],o=s==null?void 0:s.params.find(i=>i.name==="Call");return(o==null?void 0:o.type)??null})()})},am=(t,e,n)=>(r,s,o,...i)=>{const{id:a}=r;if(s.has(a))return s.get(a);if(o.has(a)){const l=e(()=>s.get(a),r,...i);return s.set(a,l),l}o.add(a);let c=t(r,s,o,...i);return o.delete(a),s.has(a)&&(c=n(c,s.get(a),r,...i)),s.set(a,c),c},cm=Rr(),lm=(t,e,n,r)=>{if(t.type==="primitive")return au[t.value];if(t.type==="void")return N;if(t.type==="AccountId32")return r;if(t.type==="AccountId20")return Fl;if(t.type==="compact")return t.isBig?vs:H;if(t.type==="bitSequence")return Vs(t.isLSB);const s=h=>uh(h,e,n,r),o=(h,g)=>{const p=s(h);return g?Ke(p,g):Ke(p)},i=h=>ct(...h.map(s)),a=h=>{const g=Object.fromEntries(Object.entries(h).map(([p,m])=>[p,s(m)]));return xe(g)};if(t.type==="sequence"&&t.value.type==="primitive"&&t.value.value==="u8")return cm;if(t.type==="array")return t.value.type==="primitive"&&t.value.value==="u8"?Rr(t.len):o(t.value,t.len);if(t.type==="sequence")return o(t.value);if(t.type==="tuple")return i(t.value);if(t.type==="struct")return a(t.value);if(t.type==="option")return mn(s(t.value));if(t.type==="result")return Fs(s(t.value.ok),s(t.value.ko));const c=Object.values(t.value).map(h=>{switch(h.type){case"void":return N;case"lookupEntry":return s(h.value);case"tuple":return i(h.value);case"struct":return a(h.value);case"array":return o(h.value,h.len)}}),l=Object.fromEntries(Object.keys(t.value).map((h,g)=>[h,c[g]])),f=Object.values(t.value).map(h=>h.idx),d=f.every((h,g)=>h===g)?De(l):De(l,f);return t.byteLength?um(d,t.byteLength):d},uh=am(lm,di,t=>t),La=(t,e=gn())=>{const n=new Map,r=s=>uh(t(s),n,new Set,e);return s=>r(s)},um=(t,e)=>{const n=ee(e);return Q(r=>n.enc(t.enc(r)),r=>t.dec(n.dec(r)))},hm=wt(N,()=>{},()=>null),fm=t=>{var d;const{metadata:e}=t;let n=La(t);const r=(d=e.pallets.find(h=>h.name==="System"))==null?void 0:d.constants.find(h=>h.name==="SS58Prefix");let s;if(r)try{const h=n(r.type).dec(r.value);typeof h=="number"&&(s=h,n=La(t,gn(h)))}catch{}const o=new Map,i=(h,g)=>{let p=o.get(h);p||o.set(h,p=ru(h));const m=e.pallets.find(E=>E.name===h).storage.items.find(E=>E.name===g),b=E=>E===N?hm:E,y=(E,B,...I)=>{const C=p(...I),[,...T]=I;return{args:ct(...T.map(([D])=>D)),keys:C,value:B,len:E,fallback:m.modifier===1?B.dec(m.fallback):void 0}};if(m.type.tag==="plain")return y(0,b(n(m.type.value)),g);const{key:v,value:x,hashers:k}=m.type.value,$=b(n(x)),A=k.map(E=>au[E.tag]),S=(()=>{if(A.length===1)return[[n(v),A[0]]];const E=t(v);switch(E.type){case"array":return A.map(B=>[n(E.value.id),B]);case"tuple":return E.value.map((B,I)=>[n(B.id),A[I]]);default:throw new Error("Invalid key type")}})();return y(A.length,$,g,...S)},a=h=>{switch(h.type){case"void":return N;case"lookupEntry":return n(h.value.id);case"tuple":return ct(...Object.values(h.value).map(g=>n(g.id)));case"struct":return xe(Wn(h.value,g=>n(g.id)));case"array":return Ke(n(h.value.id),h.len)}},c=(h,g)=>{const p=e.pallets.find(m=>m.name===h).constants.find(m=>m.name===g);return n(p.type)},l=h=>(g,p)=>{const m=e.pallets.find(v=>v.name===g),b=t(m[h].type);if(b.type!=="enum")throw null;const y=b.value[p];return{location:[m.index,y.idx],codec:a(b.value[p])}},f=(h,g)=>{var m;const p=(m=e.pallets.find(b=>b.name===h))==null?void 0:m.viewFns.find(b=>b.name===g);if(!p)throw null;return{args:ct(...p.inputs.map(b=>n(b.type))),value:n(p.output)}},u=(h,g)=>{var m;const p=(m=e.apis.find(b=>b.name===h))==null?void 0:m.methods.find(b=>b.name===g);if(!p)throw null;return{args:ct(...p.inputs.map(b=>n(b.type))),value:n(p.output)}};return{buildDefinition:n,buildStorage:i,buildEvent:l("events"),buildError:l("errors"),buildViewFn:f,buildRuntimeCall:u,buildCall:l("calls"),buildConstant:c,ss58Prefix:s}},hh="CheckMortality",fh=(t,e,n)=>{const r=lh(t),s=fm(r),o=s.buildStorage("System","Events"),i=t.extrinsic.signedExtensions.find(f=>f.identifier==="ChargeAssetTxPayment");let a=null;if(i){const f=r(i.type);if(f.type==="struct"){const u=f.value.asset_id;u.type==="option"&&(a=u.value.id)}}const c=gm(r.metadata,s),l=f=>{const u=c(f);return"extra"in u&&u.extra[hh]||{mortal:!1}};return{assetId:a,metadataRaw:e,codeHash:n,lookup:r,dynamicBuilder:s,events:{key:o.keys.enc(),dec:o.value.dec},accountId:gn(s.ss58Prefix),getMortalityFromTx:l,extVersions:t.extrinsic.version}},mo=ee(1/0).dec,dm=Us(bt[1],t=>{const e=2<<t%16,n=Math.max(e>>12,1),r=(t>>4)*n;return{mortal:!0,period:e,phase:r}}),pm=Ut(t=>{const e=Z.dec(t);if(e===0)return{mortal:!1};const n=Z.dec(t);return dm(Uint8Array.from([e,n]))}),gm=(t,e)=>{var a,c,l,f;const n=Object.fromEntries(t.extrinsic.signedExtensions.map(u=>[u.identifier,u.identifier===hh?pm:e.buildDefinition(u.type)[1]]));let r,s;const{extrinsic:o}=t;if("address"in o)r=e.buildDefinition(o.address)[1],s=e.buildDefinition(o.signature)[1];else{const u=(a=t.lookup[o.type])==null?void 0:a.params,d=(c=u==null?void 0:u.find(p=>p.name==="Call"))==null?void 0:c.type,h=(l=u==null?void 0:u.find(p=>p.name==="Address"))==null?void 0:l.type,g=(f=u==null?void 0:u.find(p=>p.name==="Signature"))==null?void 0:f.type;if(d==null||h==null||g==null)throw new Error("Call, Address and/or signature not found");r=e.buildDefinition(h)[1],s=e.buildDefinition(g)[1]}const i=xe.dec({address:r,signature:s,extra:xe.dec(n),callData:mo});return Ut(u=>{const d=H.dec(u),{type:h,version:g}=wi[1](u);if(h==="bare")return{len:d,version:g,type:h,callData:mo(u)};if(h==="signed")return{len:d,version:g,type:h,...i(u)};const p=Z.dec(u);let m;if(t.version===16){const y=t.extrinsic.signedExtensionsByVersion.find(([v])=>v===p);if(!y)throw new Error("Unexpected extension version");m=xe.dec(Object.fromEntries(Object.entries(n).filter((v,x)=>y[1].includes(x))))}else m=xe.dec(n);const b=m(u);return{len:d,type:h,version:g,extensionVersion:p,extra:b,callData:mo(u)}})},mm=t=>e=>{const n=(...r)=>{let s;try{s=t()}catch(o){return Pn(o)}return s?e(s,...r).pipe(Ne(o=>{if(o instanceof Mt)return n(...r);if(o instanceof Error&&o.name===Qs.errorName)return Zs(750).pipe(j(()=>n(...r)));throw o})):fn};return n},ym=(t,e,n)=>{const r=(s,o)=>e(s).pipe(Ne(()=>he(null)),j(i=>i?he(i):o.pipe(ir(a=>{n(s,a)}))),O(i=>({codeHash:s,metadataRaw:i,metadata:Gs(An.dec(i))})));return(s,o)=>{const i=new Set([o]),a={},c=mm(()=>{if(!i.size)throw a;return i.has(o)?o:[...i].at(-1)}),l=r(s,ch(c(t)).pipe(Ne(u=>u===a?fn:Pn(()=>u)))).pipe(O(({metadata:u,metadataRaw:d,codeHash:h})=>fh(u,d,h)),Xs(1)),f={codeHash:s,runtime:l,addBlock:u=>{i.add(u)},deleteBlocks:u=>(u.forEach(d=>{i.delete(d)}),i.size),usages:i};return l.subscribe({error(){}}),f}},wr=Dr({connector:()=>new Pr(1),resetOnError:!0,resetOnComplete:!0,resetOnRefCountZero:!0}),hs=({hash:t,number:e,parent:n,hasNewRuntime:r})=>({hash:t,number:e,parent:n,hasNewRuntime:r}),bm=(t,e,n,r,s,o,i,a)=>{const c=({blocks:y,runtimes:v},x)=>{x.forEach(k=>{var $;($=y.get(y.get(k).parent))==null||$.children.delete(k),y.delete(k),a(k)}),Object.entries(v).map(([k,$])=>({key:k,usages:$.deleteBlocks(x)})).filter(k=>k.usages===0).map(k=>k.key).forEach(k=>{delete v[k]})},l=y=>{o.next(hs(y))},f=y=>{c(y,[...y.blocks.values()].filter(x=>x.recovering).map(x=>x.hash));const v="pendingBlocks"in y.state?y.state.pendingBlocks:[];y.state={type:$e.Ready},v.forEach(l)},u=new ut,d=u.pipe(mg(()=>Zs(0)),O(()=>({type:"cleanup"}))),h=Ra(),g=()=>(c(h,[...h.blocks.values()].map(y=>y.hash)),Object.assign(h,Ra())),p=Hr(s,d,t).pipe(Ss((y,v)=>{var $;const x=A=>{c(y,A),i(A)},k=(...A)=>{var B;const S=((B=y.blocks.get(y.finalized))==null?void 0:B.number)??-1,E=A.filter(({refCount:I,recovering:C,number:T,pruned:D})=>!I&&!C&&(D||T<S)).map(({hash:I})=>I);E.length&&x(E)};switch(v.type){case"initialized":if(y.state.type!==$e.Initializing&&y.state.type!==$e.RecoveringInit)throw new Error("Initialized event out of order");y.state.type===$e.RecoveringInit&&!v.finalizedBlockHashes.some(I=>y.blocks.has(I))&&(g(),o.next(null));const A=(($=y.blocks.get(y.finalized))==null?void 0:$.number)??-1,S=v.finalizedBlockHashes.length-1,E=[];A>v.number+S?y.state={type:$e.RecoveringFin,target:A,pendingBlocks:E}:(y.state={type:$e.Initializing,pendingBlocks:E},y.finalized=v.finalizedBlockHashes[S]);let B=y.finalizedRuntime.codeHash;return v.finalizedBlockHashes.forEach((I,C)=>{const T=y.blocks.get(I);if(T)T.recovering=!1;else{const D=v.number+C,P=D>A,F=v.runtimeChanges.get(I),G=F&&!y.runtimes[F]&&P;G&&(B=F);const W=C===0?v.parentHash:v.finalizedBlockHashes[C-1],te={hash:I,hasNewRuntime:C?v.runtimeChanges.has(I):v.hasNewRuntime,parent:W,children:new Set(C===S?[]:[v.finalizedBlockHashes[C+1]]),pruned:!1,runtime:B,refCount:0,number:D,recovering:!1};y.blocks.set(I,te),G&&(y.finalizedRuntime=y.runtimes[F]=b(F,I)),y.runtimes[B].usages.add(I),P&&E.push(te)}}),y;case"stop-error":if(y.state.type===$e.Initializing)return g();for(const I of y.blocks.values())I.recovering=!0;return y.state={type:$e.RecoveringInit},y;case"newBlock":{const{parentBlockHash:I,blockHash:C}=v;if(y.blocks.has(C))y.blocks.get(C).recovering=!1;else{const T=y.blocks.get(I);T.children.add(C);const D=T.number+1,P={hash:C,number:D,parent:I,children:new Set,runtime:T.runtime,pruned:!1,refCount:0,recovering:!1,hasNewRuntime:!!v.newRuntime};if(y.blocks.set(C,P),v.newRuntime){const{codeHash:F}=v;P.runtime=F,y.runtimes[F]=b(F,C)}y.runtimes[P.runtime].addBlock(C),"pendingBlocks"in y.state?y.state.pendingBlocks.push(P):l(P)}return y}case"bestBlockChanged":return y.state.type===$e.RecoveringFin||(y.best=v.bestBlockHash,y.state.type===$e.Initializing&&f(y)),y;case"finalized":{const I=v.finalizedBlockHashes.slice(-1)[0];let C=!1;if(y.state.type===$e.RecoveringFin){if(y.blocks.get(I).number<y.state.target)return y;C=!0}y.finalized=I;const{blocks:T}=y;return T.get(y.best).number<T.get(y.finalized).number&&(y.best=y.finalized),y.finalizedRuntime=y.runtimes[T.get(y.finalized).runtime],v.prunedBlockHashes.forEach(D=>{const P=y.blocks.get(D);P&&(P.pruned=!0)}),C&&f(y),y.state.type===$e.Ready&&u.next(),y}case"cleanup":return k(...y.blocks.values()),y;case"blockUsage":{const I=y.blocks.get(v.value.hash);return I&&(I.refCount+=v.value.type==="hold"?1:-1,k(I)),y}}},h),O(y=>({...y})),ir({error(y){o.error(y)}}),wr),m=Object.assign(p,{state:h}),b=ym(us(m,e,"pinned-blocks"),n,r);return m},Ra=()=>({best:"",finalized:"",runtimes:{},blocks:new Map,finalizedRuntime:{},state:{type:$e.Initializing,pendingBlocks:[]}}),Pa=(t,e,n,r,s,o)=>{const i=new Map,a=h=>{var g;(g=i.get(h))==null||g(),i.delete(h)},c=new V(h=>{const g=e.subscribe({next:({hash:p})=>{i.set(p,o(p))},complete(){h.error(new Error("Tracking stopped"))}});return g.add(t.pipe(O(p=>p.finalized),Ee()).subscribe(()=>{t.state.blocks.forEach(({pruned:p,hash:m})=>{p&&a(m)})})),g.add(()=>[...i.keys()].forEach(a)),g}),l=h=>Du(t.pipe(vt(({blocks:g})=>{var p;return((p=g.get(h))==null?void 0:p.pruned)??!0}))),f=(h,g,p)=>{if(p)return he({hash:h,found:{type:!1,validity:null}});const m=l(h);return n(h).pipe(j(b=>{const y=b.indexOf(g);return y>-1?m(s(h)).pipe(O(v=>({hash:h,found:{type:!0,index:y,events:v}}))):r(h,g).pipe(O(v=>({hash:h,found:{type:!1,validity:v}})))}),m,yg(()=>a(h)))},u=h=>{var p;[...((p=t.state.blocks.get(h))==null?void 0:p.children.keys())??[]].forEach(u),a(h)},d=(h,g,p)=>f(h,g,p.has(h)).pipe(j(m=>{var v;const{found:b}=m,y=b.type||((v=b.validity)==null?void 0:v.success)===!1;return y&&u(h),y?he(m):t.pipe(l(h),j(x=>x.blocks.get(h).children),pg(),j(x=>d(x,g,p)))}));return h=>Hr(c,t.pipe(Ce(1),j(g=>d(g.finalized,h,new Set(g.blocks.keys())))))},vm=new Uint8Array([2]),wm=(t,e)=>oe(ke([vm,Le(t),Le(e)])),Ma="TaggedTransactionQueue",Ha="validate_transaction",[,xm]=De({InvalidTransaction:De({Call:N,Payment:N,Future:N,Stale:N,BadProof:N,AncientBirthBlock:N,ExhaustsResources:N,Custom:Z,BadMandatory:N,MandatoryValidation:N,BadSigner:N}),UnknownTransaction:De({CannotLookup:N,NoUnsignedValidator:N,Custom:Z})}),Em=Ut(t=>{const e=Z.dec(t);if(e>1)throw new Error("Unable to decode validateTransaction result");if(!e)return{success:!0,value:void 0};let n;try{n=xm(t)}catch{n={type:"UnknownInvalidTx"}}return{success:!1,value:n}}),km=(t,e)=>(n,r)=>{const s=e(n).pipe(O(o=>{try{return o.dynamicBuilder.buildRuntimeCall(Ma,Ha).value[1]}catch{return Em}}));return t(n,`${Ma}_${Ha}`,wm(r,n)).pipe(qo(s),O(([o,i])=>i(o)))},Sm=t=>e=>new V(n=>{let r=!1;const s=e.subscribe({next(o){r=!0,n.next(o)},error(o){n.error(o)},complete(){n.complete()}});return r||n.next(t),s}),Bm=t=>e=>new V(n=>{const r=e.subscribe({next(o){n.next(o)},error(o){n.error(o)},complete(){n.complete()}}),s=()=>r.unsubscribe();return()=>{Promise.resolve().then(s)}}),dh=(t,e=1/0)=>n=>new V(r=>{let s;const o=new Map,i=new Map,a=new Map;let c=0,l=0,f=0;const u=()=>{const d=o.get(l);if(!d){i.size===0&&(typeof s>"u"||s.closed)&&r.complete();return}const h=l++;o.delete(h),f!==h&&a.set(h,[]);let g=!1,p=d.subscribe({next(m){f===h?r.next(m):a.get(h).push(m)},complete(){if(g=!0,i.delete(h),h===f)for(f++;a.has(f)&&(a.get(f).forEach(m=>r.next(m)),a.delete(f),!i.has(f));)f++;u()},error(m){r.error(m)}});g||i.set(h,p)};return s=new or,s.add(n.subscribe({next(d){const h=c++;o.set(h,Ys(()=>t(d,h))),i.size<e&&u()},error(d){r.error(d)},complete(){i.size===0&&r.complete()}})),()=>{i.forEach(d=>d.unsubscribe()),s.unsubscribe(),o.clear(),a.clear()}}),Am=(t,e,n)=>{const{withRecovery:r,withRecoveryFn:s}=Wg(),{getFollower:o,unfollow:i,follow$:a,getHeader:c,hasher$:l}=nm(t,s),f=Zg(o),u=new ut,d=_=>M=>new V(U=>{u.next({type:"blockUsage",value:{type:"hold",hash:_}});const Y=M.subscribe(U);return Y.add(()=>{setTimeout(()=>{u.next({type:"blockUsage",value:{type:"release",hash:_}})},0)}),Y}),h=_=>(M,...U)=>_(M,...U).pipe(d(M)),g=(_,M)=>(U,...Y)=>new V(ve=>v.state.blocks.has(U)?_(U,...Y).subscribe(ve):ve.error(new Mt(U,M))),p=_=>o().unpin(_).catch(M=>{if(!(M instanceof Error&&M.name===cs.errorName))throw M}),m=(_,M)=>g(h(us(v,s(In(_)),`stop-${M}`)),M),b=new Map,y=new ut,v=bm(a,h(s(In(f("call")))),e,n,u,y,_=>{p(_).catch(M=>{console.error("unpin",M)}),_.forEach(M=>{b.delete(M)})},_=>{b.delete(_)}),x=g(h(_=>v.state.runtimes[v.state.blocks.get(_).runtime].runtime),"getRuntimeCtx"),k=_=>M=>M.pipe(dh(U=>x(_(U)).pipe(O(Y=>[U,Y])))),$=(_,M,U)=>{const Y=b.get(_)??new Map,ve=Y.get(M);if(ve)return ve;b.set(_,Y);let Nt;const kt=U.pipe(Dr({connector:()=>Nt=new Pr}),ir({complete(){Y.set(M,Nt)}}),Bm());return Y.set(M,kt),kt},A=Object.assign(v.pipe(vt(_=>_.state.type===$e.Ready)),{state:v.state}),S=A.pipe(Ee((_,M)=>_.finalized===M.finalized),Ss((_,M)=>{let U=M.blocks.get(M.finalized);const Y=[U],ve=_.at(-1);if(!ve)return Y;for(;U.number>ve.number+1&&(U=M.blocks.get(U.parent),!!U);)Y.unshift(U);return Y},[]),Ks(),O(hs),wr),E=A.pipe(Ee((_,M)=>_.best===M.best),O(_=>hs(_.blocks.get(_.best))),wr),B=A.pipe(Ee((_,M)=>_.finalized===M.finalized&&_.best===M.best),Ss((_,M)=>{const U=Ze=>_.get(Ze)||hs(M.blocks.get(Ze)),Y=U(M.best),ve=U(M.finalized),Nt=Y.number-ve.number+1,kt=new Array(Nt);for(let Ze=0,qi=Y.hash;Ze<Nt;Ze++)kt[Ze]=U(qi),qi=kt[Ze].parent;return new Map(kt.map(Ze=>[Ze.hash,Ze]))},new Map),O(_=>[..._.values()]),wr),I=A.pipe(Ee((_,M)=>_.finalizedRuntime===M.finalizedRuntime),$r(({finalizedRuntime:{runtime:_}})=>_.pipe(Sm(null))),wr),C=I.pipe(O(_=>(_==null?void 0:_.lookup.metadata)??null)),T=Yg(S.pipe(O(_=>_.hash)),E.pipe(O(_=>_.hash)),d),D=m(f("body"),"body"),P=_=>Yo($(_,"body",D(_))),F=m(f("storage"),"storage"),G=T(g((_,M,U,Y=null,ve)=>v.state.runtimes[v.state.blocks.get(_).runtime].runtime.pipe(j(Nt=>{const kt=U(Nt);return $(_,`storage-${M}-${kt}-${Y??""}`,F(_,M,kt,Y)).pipe(ve?O(Ze=>ve(Ze,Nt)):Et)})),"storage")),W=Xg(o,r),te=T(g(us(v,(_,M,U)=>W(_,M,U??null,!1),"storageQueries"),"storageQueries")),Ye=T(g(us(v,c,"header"),"header")),ht=_=>G(_,"value",M=>M.events.key,null,(M,U)=>U.events.dec(M)),Mn=m(f("call"),"call"),cr=T((_,M,U)=>$(_,`call-${M}-${U}`,Mn(_,M,U))),lr=km(cr,x),Bf=I.pipe(vt(Boolean),Ce(1),j(_=>{const{enc:M}=_.dynamicBuilder.buildStorage("System","BlockHash").keys;let U;try{U=M(0)}catch{U=M(0n)}return G(null,"value",()=>U,null)}),Xs(1));Hr(I,B).subscribe({error(){}});const Af=_=>{var M;return((M=v.state.runtimes[_])==null?void 0:M.runtime)??he(null)},Nr=(_,M=!1)=>{let U=_||"finalized";if(U=v.state[U]||U,!v.state.blocks.has(U)){if(M)throw new Mt(U,"holdBlock");return Ue}u.next({type:"blockUsage",value:{type:"hold",hash:U}});let Y=()=>{u.next({type:"blockUsage",value:{type:"release",hash:U}}),Y=Ue};return()=>{Y()}},If=_=>M=>new V(U=>{const Y=M.subscribe(U);return Y.closed||Y.add(Nr(_)),Y}),so=y.pipe(nr(Boolean)),$f=Pa(A,so,P,lr,ht,Nr),Cf=Pa(v,so,P,lr,()=>he(),Nr);return{follow$:a,unfollow:i,finalized$:S,best$:E,bestBlocks$:B,newBlocks$:tr(A.pipe(Ce(1),j(({blocks:_,finalized:M})=>{const U=Y=>{const ve=_.get(Y);return ve?[ve,...Array.from(ve.children).flatMap(U)]:[]};return U(M)})),so),runtime$:I,metadata$:C,genesis$:Bf,hasher$:l,getRuntime$:Af,header$:Ye,body$:P,call$:cr,storage$:G,storageQueries$:te,eventsAt$:ht,withHodl:If,holdBlock:Nr,trackTx$:$f,trackTxWithoutEvents$:Cf,validateTx$:lr,pinnedBlocks$:A,withRuntime:k,getRuntimeContext$:T(x)}};var Im=t=>e=>new V(n=>t(e,r=>{n.error(r)}));const $m=({storageSubscription:t,...e})=>n=>{const r={},s=In(e.storage),o=In(e.call),i=In(e.header),a=In(e.body),c=p=>i(p).pipe(O(ws[1])),l=p=>s(p,"hash","0x3a636f6465",null).pipe(O(m=>m)),f=(p,m)=>n(p).pipe(Ne(()=>he(null)),j(b=>b?he(b):ch((...y)=>o(m,...y)).pipe(O(y=>fh(Gs(An.dec(y)),y,p)))),ir(b=>{r[p]=b})),u=p=>l(p).pipe(j(m=>{const b=r[m];return b?he(b):f(m,p)})),d=(p,m,b,y=null,v)=>u(p).pipe(j(x=>s(p,m,b(x),y).pipe(O(k=>v?v(k,x):k))));return{body$:a,header$:c,storage$:d,storageQueries$:(p,m,b)=>new V(y=>t(p,m,b||null,v=>y.next(v),v=>y.error(v),()=>{y.complete()})),call$:o,eventsAt$:p=>d(p,"value",m=>m.events.key,null,(m,b)=>b.events.dec(m)),getRuntimeContext$:u}},Cm=()=>he(null),_m=(t,{getMetadata:e,setMetadata:n}={})=>({chainHead$:()=>Am(t.chainHead,e||Cm,n||Ue),archive:$m(t.archive),broadcastTx$:Im(t.transaction),destroy:t.destroy}),Om=(t,e)=>t.pipe(nr(n=>n.blocks.has(e)),Ee((n,r)=>n.finalized===r.finalized&&n.best===r.best),O(n=>{if(n.blocks.get(e).number>n.blocks.get(n.best).number)return null;const{number:r}=n.blocks.get(e);let s=n.blocks.get(n.best),o=n.finalized===s.hash;for(;s.number>r;)s=n.blocks.get(s.parent),o=o||n.finalized===s.hash;return o?"finalized":s.hash===e?"best":null}),Ee(),nr(n=>n!=="finalized",!0)),wn=(t,e)=>(n,...r)=>t(n,...r).pipe(Ne(s=>{if(!(s instanceof Mt))throw s;return e(n,...r).pipe(Ne(o=>{throw console.warn(o),s}))}));class Tn{constructor(){}_runtime(e){}}class Oi{constructor(){}_compatibility(e){}}const Bs=new WeakMap,ph=new WeakMap,eo=t=>t instanceof Tn?ph.get(t):Bs.get(t);var on=(t=>(t.Storage="storage",t.Tx="tx",t.Event="events",t.Const="constants",t.ViewFns="viewFns",t.Api="apis",t))(on||{});const Tm=Ke(c0),Lm=Ke(ki),Rm=ct(Tm,Lm),Pm=(t,e)=>{const n=new Promise(async s=>{const o=e.runtime$.pipe(vt(a=>a!=null));let i=await qe(o);o.subscribe(a=>i=a),s(()=>i)});return Promise.all([t.metadataTypes.then(Rm.dec),t.descriptors,n]).then(([[s,o],i,a])=>{const c=new Oi;return Bs.set(c,{runtime:a,getEntryPoint(l,f,u){var h,g;const d=(g=(h=i[l])==null?void 0:h[f])==null?void 0:g[u];if(d==null)throw new Error(`Descriptor for ${l} ${f}.${u} does not exist`);return s[d]},typedefNodes:o}),c})},Mm=t=>new Promise(async r=>{const s=t.runtime$.pipe(vt(i=>i!=null));let o=await qe(s);s.subscribe(i=>o=i),r(()=>o)}).then(r=>{const s=new Tn;return ph.set(s,{runtime:r}),s}),yo=new WeakMap,Da=t=>(yo.has(t.metadataRaw)||yo.set(t.metadataRaw,{compat:new Map,lookup:t.lookup,typeNodes:[]}),yo.get(t.metadataRaw)),xn=(t,e,n)=>{const r=(d,h)=>{var g;const p=Da(d);return(g=p.typeNodes)[h]||(g[h]=qs(p.lookup(h)))};function s(d,h){if(d instanceof Tn)return{args:it.Identical,values:it.Identical};const g=Bs.get(d);h||(h=g.runtime());const p=n(h);if(p==null)return{args:it.Incompatible,values:it.Incompatible};const m=g.typedefNodes,b=Da(h),y=e(g),v=f0(y,x=>m[x],p,x=>r(h,x),b.compat);return{args:v.args.level,values:v.values.level}}const o=Ua(t,d=>gh(s(d)));return{isCompatible:Ua(t,(d,h)=>o(h)>=d),getCompatibilityLevel:o,getCompatibilityLevels:s,descriptors:t,withCompatibleRuntime:(d,h)=>g=>Pt([g.pipe(d.withRuntime(h)),t]).pipe(O(([[p,m],b])=>[p,b,m])),compatibleRuntime$:(d,h)=>Pt([t,d.getRuntimeContext$(h)]),argsAreCompatible:(d,h,g)=>{if(d instanceof Tn)return!0;const p=s(d,h);if(p.args===it.Incompatible)return!1;if(p.args>it.Partial)return!0;if(p.values===it.Incompatible)return!1;const m=n(h);return m==null?!1:wa(m.args,b=>r(h,b),g)},valuesAreCompatible:(d,h,g)=>{if(d instanceof Tn)return!0;const p=s(d,h).values;if(p===it.Incompatible)return!1;if(p>it.Partial)return!0;const m=Bs.get(d),b=e(m);return wa(b.values,y=>m.typedefNodes[y],g)},getRuntimeTypedef:r,storageKeysAreCompatible:(d,h,g)=>{const p=n(d);if(p==null)return!1;const m=y=>r(d,y),b=p.args.type==="lookup"?m(p.args.value):p.args.value;return t0(h,g,b,m)}}},gh=t=>Math.min(t.args,t.values),Ua=(t,e)=>(...n)=>{const r=n.at(-1);return r instanceof Oi||r instanceof Tn?e(...n):t.then(s=>e(...n,s))},Hm=(t,e,{valuesAreCompatible:n,descriptors:r,isCompatible:s,getCompatibilityLevel:o})=>{const i=new WeakMap,a=l=>{if(i.has(l))return i.get(l);const f=l.lookup.metadata.pallets.find(h=>h.name===t),u=f==null?void 0:f.constants.find(h=>h.name===e);if(u==null)throw new Error(`Runtime entry Constant(${t}.${e}) not found`);const d=l.dynamicBuilder.buildConstant(t,e).dec(u.value);return i.set(l,d),d},c=l=>{if(l){const f=eo(l).runtime(),u=a(f);if(!n(l,f,u))throw new Error(`Incompatible runtime entry Constant(${t}.${e})`);return u}return r.then(c)};return Object.assign(c,{isCompatible:s,getCompatibilityLevel:o})},Dm=Dr({connector:()=>new Pr(1),resetOnError:!0,resetOnComplete:!0,resetOnRefCountZero:!0}),Um=(t,e,n,{isCompatible:r,getCompatibilityLevel:s,withCompatibleRuntime:o,argsAreCompatible:i,valuesAreCompatible:a})=>{const c=()=>new Error(`Incompatible runtime entry Event(${t}.${e})`),l=n.finalized$.pipe(o(n,h=>h.hash),O(([h,g,p])=>{var b,y;const m=(y=(b=p.lookup.metadata.pallets.find(v=>v.name===t))==null?void 0:b.events)==null?void 0:y.type;if(m==null||p.lookup.metadata.lookup[m].def.tag!=="variant"||p.lookup.metadata.lookup[m].def.value.find(v=>v.name===e)==null)throw new Error(`Runtime entry Event(${t}.${e}) not found`);if(!i(g,p,null))throw c();return[h,g,p]}),dh(([h,g,p])=>n.eventsAt$(h.hash).pipe(O(m=>m.filter(y=>y.event.type===t&&y.event.value.type===e).map(y=>{if(!a(g,p,y.event.value.value))throw c();return{meta:{phase:y.phase,block:h},payload:y.event.value.value}})))),Dm);return{watch:h=>l.pipe(j(g=>h?g.filter(p=>h(p.payload)):g)),pull:()=>qe(l),filter:h=>h.filter(g=>g.type===t&&g.value.type===e).map(g=>g.value.value),getCompatibilityLevel:s,isCompatible:r}};function rr(t,e){return new Promise((n,r)=>{let s=null,o=!1;const i=e?()=>{s==null||s.unsubscribe(),r(new Al)}:Ue;s=t.subscribe({next:a=>{n(a),s==null||s.unsubscribe(),o=!0},error:a=>{e==null||e.removeEventListener("abort",i),r(a),o=!0},complete:()=>{e==null||e.removeEventListener("abort",i),r(new Error("Observable completed without emitting")),o=!0}}),o||e==null||e.addEventListener("abort",i)})}const Gn=t=>typeof t=="object"&&t!==null&&Object.entries(t).every(([e,n])=>e==="at"&&(n===void 0||typeof n=="string")||e==="signal"&&(n===void 0||n instanceof AbortSignal)),Nm=(t,e,n,{isCompatible:r,getCompatibilityLevel:s,compatibleRuntime$:o,argsAreCompatible:i,valuesAreCompatible:a})=>{const c=`${t}_${e}`,l=()=>new Error(`Incompatible runtime entry RuntimeCall(${c})`);return Object.assign((...u)=>{const d=u[u.length-1],h=Gn(d),{signal:g,at:p}=h?d:{},m=p??null,b=o(n,m).pipe(j(([y,v])=>{let x;try{x=v.dynamicBuilder.buildRuntimeCall(t,e)}catch{throw new Error(`Runtime entry RuntimeCall(${c}) not found`)}if(!i(y,v,u))throw l();return n.call$(m,c,oe(x.args.enc(u))).pipe(O(x.value.dec),O(k=>{if(!a(y,v,k))throw l();return k}))}),n.withHodl(m));return rr(b,g)},{getCompatibilityLevel:s,isCompatible:r})},bo=Symbol("EMPTY_VALUE"),Zo=t=>e=>new V(n=>{let r=0,s=null,o=bo,i=!1;const a=()=>{const l=t(o,r++);o=bo,s=l.subscribe({next(f){n.next(f)},error(f){n.error(f)},complete(){o!==bo?a():(s=null,i&&n.complete())}})},c=e.subscribe({next(l){o=l,s||a()},error(l){n.error(l)},complete(){s||n.complete(),i=!0}});return()=>{s==null||s.unsubscribe(),c.unsubscribe()}}),Na=O(t=>t.mapped),zm=(t,e,n,r,{isCompatible:s,getCompatibilityLevel:o,getCompatibilityLevels:i,descriptors:a,argsAreCompatible:c,storageKeysAreCompatible:l,valuesAreCompatible:f})=>{const u=t==="System"&&e==="Number",d=t==="System"&&e==="BlockHash",h=n.runtime$.pipe(vt(Boolean),Ce(1),O(({dynamicBuilder:E})=>typeof E.buildStorage("System","Number").value.dec(new Uint8Array(32))=="bigint"?BigInt:Et),Xs()),g=pu(lg(h),O(([E,B])=>B(E))),p=()=>new Error(`Incompatible runtime entry Storage(${t}.${e})`),m=E=>new Error(`Invalid Arguments calling ${t}.${e}(${E})`),b=E=>{try{return E.dynamicBuilder.buildStorage(t,e)}catch{throw new Error(`Runtime entry Storage(${t}.${e}) not found`)}},y=(...E)=>{const B=E[E.length-1],I=B==="best",C=I||B==="finalized"?E.slice(0,-1):E;return n[I?"best$":"finalized$"].pipe(Zo(()=>v(...C,I?{at:"best"}:{})),Ee((T,D)=>T.raw===D.raw),Na)},v=(...E)=>{const B=E[E.length-1],I=Gn(B),{at:C}=I?B:{},T=C??null,D=dn(a).pipe(j(P=>n.storage$(T,"value",F=>{const G=b(F),W=E.length===G.len?E:E.slice(0,-1);if(E!==W&&!I)throw m(E);if(!l(F,W,G.len))throw p();return G.keys.enc(...W)},null,(F,G)=>{const W=b(G),te=F===null?W.fallback:W.value.dec(F);if(F!==null&&!f(P,G,te))throw p();return{raw:F,mapped:te}})),n.withHodl(T));return u?n.pinnedBlocks$.pipe(O(P=>{const F=T==="finalized"||!T?P.finalized:T==="best"?P.best:T,G=P.blocks.get(F);if(!G)throw new Mt(F,"System.Number");return G.number}),Ee(),g,O(P=>({raw:P.toString(),mapped:P})),Ne(P=>{if(P instanceof Mt)return D;throw P})):d&&Number(E[0])===0?n.genesis$.pipe(O(P=>({raw:P,mapped:fi.fromHex(P)}))):D},x=async(...E)=>{const B=E[E.length-1],I=Gn(B),{signal:C}=I?B:{};return rr(v(...E).pipe(Na),C)},k=async(...E)=>{const B=E[E.length-1],I=Gn(B),{signal:C,at:T}=I?B:{},D=T??null,P=dn(a).pipe(j(F=>n.storage$(D,"descendantsValues",G=>{const W=b(G);if(gh(i(F,G))===it.Incompatible)throw p();if(E.length>W.len)throw m(E);const te=E.length>0&&I?E.slice(0,-1):E;if(E.length===W.len&&te===E)throw m(E);return W.keys.enc(...te)},null,(G,W)=>{const te=b(W),Ye=G.map(({key:ht,value:Mn})=>({keyArgs:te.keys.dec(ht),value:te.value.dec(Mn)}));if(Ye.some(({value:ht})=>!f(F,W,ht)))throw p();return Ye})),n.withHodl(D));return rr(P,C)},$=(E,B)=>Promise.all(E.map(I=>x(...B?[...I,B]:I))),A=(...E)=>{const B=E.at(-1),I=Gn(B);return r(t,e,I?E.slice(0,-1):E,I&&B.at==="best")},S=(...E)=>{const B=E.at(-1);if(B instanceof Oi||B instanceof Tn){const I=E.slice(0,-1),C=eo(B).runtime();if(!c(B,C,I))throw p();return b(C).keys.enc(...I)}return a.then(I=>S(...E,I))};return{isCompatible:s,getCompatibilityLevel:o,getKey:S,getValue:x,getValues:$,getEntries:k,watchValue:y,watchEntries:A}},vo=()=>new Error("Unkown signer"),Fm=t=>{const{extrinsic:e}=t,n=lh(t);let r,s;if("address"in e)r=n(e.address),s=n(e.signature);else{const o=Object.fromEntries(t.lookup[e.type].params.filter(i=>i.type!=null).map(i=>[i.name,n(i.type)]));if(r=o.Address,s=o.Signature,!r||!s)throw vo()}if(r.type==="AccountId20"&&s.type==="array"&&s.len===65&&s.value.type==="primitive"&&s.value.value==="u8")return[1,[]];if(s.type!=="enum"||["Ecdsa","Ed25519","Sr25519"].some(o=>!(o in s.value)))throw vo();if(r.type==="enum"){const o=r.value.Id;if(o.type==="lookupEntry"&&o.value.type==="AccountId32")return[0,[o.idx]]}else if(r.type==="AccountId32")return[0,[]];throw vo()},Vm={Ed25519:0,Sr25519:1,Ecdsa:2},jm=(t,e,n,r,s,o)=>{const[i,a]=Fm(t),c=ke([wi.enc({version:4,type:"signed"}),i===1?e:new Uint8Array([...a,...e]),i===1||!o?n:new Uint8Array([Vm[o],...n]),...r,s]);return ke([_e.enc(c.length),c])},[jr,gr]=["<Bytes>","</Bytes>"].map(t=>Xe.fromText(t).asBytes()),Gm=t=>async e=>{let n=!0,r;for(r=0;n&&r<jr.length;r++)n=jr[r]===e[r];n=n&&r===jr.length;const s=e.length-gr.length;for(r=0;n&&r<gr.length;r++)n=gr[r]===e[s+r];return n=n&&r===gr.length,t(n?e:ke([jr,e,gr]))};function Ti(t,e,n){return{publicKey:t,signTx:async(s,o,i,a,c=sr)=>{const l=Gs(Xl(i)),f=[],u=[];l.extrinsic.signedExtensions.map(({identifier:g})=>{const p=o[g];if(!p)throw new Error(`Missing ${g} signed extension`);f.push(p.value),u.push(p.additionalSigned)});const d=ke([s,...f,...u]),h=await n(d.length>256?c(d):d);return jm(l,t,h,f,s,e)},signBytes:Gm(n)}}Uint8Array.from([1]);const qm=(t,e)=>{const n=t.metadata.pallets.find(o=>o.name==="System").constants.find(o=>o.name==="Version"),r=t(n.type),s=e.buildDefinition(n.type).dec;if(r.type!=="struct")throw new Error("not a struct");return s(n.value)};function Wm(t){let e=0;for(;!(t&1);)e++,t>>=1;return e}const Km=t=>1<<Math.ceil(Math.log2(t)),Ym=Ds(ee(2)[0],t=>{const e=Math.min(Math.max(Km(t.period),4),65536),n=t.startAtBlock%e,r=Math.max(e>>12,1),s=Math.min(Math.max(Wm(e)-1,1),15),o=n/r<<4;return bt[0](s|o)}),[Zm]=xe({tip:_e,asset:mn(ee(1/0))}),mh=new Uint8Array,wo=Uint8Array.from([0]),xo=t=>({value:t,additionalSigned:mh}),Eo=t=>({value:mh,additionalSigned:t}),ko=(t,e)=>({value:t,additionalSigned:e}),Xm=(t,e,n)=>{const r={};return e.metadata.extrinsic.signedExtensions.forEach(({identifier:s,type:o,additionalSigned:i})=>{r[s]=[o,i].map(a=>n.buildDefinition(a)[0])}),({mortality:s,tip:o=0n,nonce:i,customSignedExtensions:a={},...c})=>{const l=[],f=qm(e,n),u=h=>{const[g,p]=r[h],m=a[h];try{return Wn({value:g,additionalSigned:p},(b,y)=>{const v=m==null?void 0:m[y];return v instanceof Uint8Array?v:b(v)})}catch{if(m)throw new Error(`Wrong input received for ${h}`);return l.push(h),null}},d=Wn(r,([h,g],p)=>{if(a[p])return u(p);switch(p){case"CheckNonce":return xo(h(i));case"CheckMortality":return s.mortal?ko(Ym({period:s.period,startAtBlock:s.startAtBlock.height}),Le(s.startAtBlock.hash)):ko(wo,t);case"ChargeTransactionPayment":return xo(h(o));case"ChargeAssetTxPayment":return xo(Zm({tip:o,asset:c.asset}));case"CheckGenesis":return Eo(t);case"CheckMetadataHash":return ko(wo,wo);case"CheckSpecVersion":return Eo(g(f.spec_version));case"CheckTxVersion":return Eo(g(f.transaction_version));default:return u(p)}});return l.forEach(h=>{delete d[h]}),Wn(d,(h,g)=>({...h,identifier:g}))}},za="AccountNonceApi_account_nonce",Jm={1:Z.dec,2:bt.dec,4:tt.dec,8:Tr.dec},Qm=(t,e,n)=>t(n,za,e).pipe(O(r=>{const s=Le(r),o=Jm[s.length];if(!o)throw new Error(`${za} retrieved wrong data`);return o(s)})),ey=(t,e,n,r,s,o={})=>Pt([o.nonce?he(o.nonce):ty(t,oe(e.publicKey)),t.getRuntimeContext$(r.hash),t.genesis$]).pipe(Ce(1),j(([i,a,c])=>{const l=Xm(Le(c),a.lookup,a.dynamicBuilder),f=o.mortality??{period:64,mortal:!0},u=l({nonce:i,tip:o.tip??0n,mortality:f.mortal?{mortal:!0,period:f.period,startAtBlock:{height:r.number,hash:r.hash}}:{mortal:!1},customSignedExtensions:s,asset:o.asset});return e.signTx(n,u,a.metadataRaw,r.number)})),ty=(t,e)=>{const n=o=>t.newBlocks$.pipe(Ss((i,a)=>a.parent===i?a.hash:i,o),Hu(o),Ee()),r=o=>n(o).pipe(Ce(2),$r(i=>Qm(t.call$,e,i))),s=o=>Pt(o.map(i=>r(i).pipe(O(a=>({success:!0,value:a})),Ne(a=>he({success:!1,value:a}))))).pipe(Ce(1));return t.pinnedBlocks$.pipe(Ce(1),O(({blocks:o,best:i})=>{const a=o.get(i);return[...o.values()].filter(c=>!c.pruned&&c.children.size===0&&c.number>=a.number).map(c=>c.hash)}),$r(s),O(o=>{const i=o.reduce((a,c)=>c.success&&c.value>=(a??0)?c.value:a,null);if(i==null)throw o[0].value;return i}))};let Fa={};const ny=t=>e=>new V(n=>{let r=Fa,s=e.subscribe({next(o){n.next(r=o)},error(o){n.error(o)},complete(){r===Fa?n.complete():s=t(r).subscribe(n)}});return()=>{s.unsubscribe()}});var ry=Object.defineProperty,sy=(t,e,n)=>e in t?ry(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,oy=(t,e,n)=>sy(t,e+"",n);const iy=(t,e)=>new V(n=>{const r=new Map;let s,o;const i=()=>{var h;let c=s.best,l=r.get(c),f=s.blocks.get(c).number;for(;!l;){const g=s.blocks.get(c);if(!g)break;l=r.get(c=g.parent),f--}if(!l)return;const u=f<=s.blocks.get(s.finalized).number,d=l.found.type;if(d&&(o!=null&&o.found)&&o.hash===l.hash){u&&n.complete();return}n.next(o=l.found.type?{found:d,hash:l.hash,number:f,index:l.found.index,events:l.found.events}:{found:d,validity:l.found.validity}),u&&(d?n.complete():((h=l.found.validity)==null?void 0:h.success)===!1&&n.error(new yh(l.found.validity.value)))},a=e.pipe(Ee((c,l)=>c.finalized===l.finalized&&c.best===l.best)).subscribe({next:c=>{s=c,r.size!==0&&i()},error(c){n.error(c)}});return a.add(t.subscribe({next:c=>{r.set(c.hash,c),i()},error(c){n.error(c)}})),a}).pipe(Ee((n,r)=>n===r)),ay=(t,e)=>{const n=t.filter(s=>s.phase.type==="ApplyExtrinsic"&&s.phase.value===e).map(s=>({...s.event,topics:s.topics})),r=n[n.length-1];return r.type==="System"&&r.value.type==="ExtrinsicFailed"?{ok:!1,events:n,dispatchError:r.value.value.dispatch_error}:{ok:!0,events:n}};class yh extends Error{constructor(e){super(JSON.stringify(e,(n,r)=>typeof r=="bigint"?r.toString():r instanceof Xe?r.asHex():r,2)),oy(this,"error"),this.name="InvalidTxError",this.error=e}}const Li=(t,e,n,r=!1)=>t.hasher$.pipe(j(s=>{const o=oe(s(Le(n))),i=(g,p)=>({type:g,txHash:o,...p}),a=t.pinnedBlocks$.state,c=g=>{if(!g.mortal)return 0;const{phase:p,period:m}=g,b=a.blocks.get(a.best).number;return Math.floor((Math.max(b,p)-p)/m)*m+p},l=g=>{let p=[...a.blocks.values()].filter(y=>!y.pruned&&!y.children.size);const m=Math.max(...p.map(({number:y})=>y));p=p.filter(({number:y})=>y>=m-1);const b=a.blocks.get(a.finalized);return p=b.children?[b,...p]:p,p.filter(y=>y.number>=g)},f=({hash:g})=>t.validateTx$(g,n),u=Ys(()=>a.finalizedRuntime.runtime.pipe(O(g=>g.getMortalityFromTx(n)),O(c),O(l),j(g=>{let p;return Hr(...g.map(m=>ig(f(m),t.finalized$.pipe(nr(b=>{if(b.number<m.number)return!0;let y=b;for(;y.number>m.number;){const v=a.blocks.get(y.parent);if(!v)return!1;y=v}return y.hash===b.hash}),Go(),Mu({success:null}))))).pipe(vt((m,b)=>{if(m.success===!1&&(p??(p=new yh(m.value))),m.success)return!0;if(b===g.length-1&&p)throw p;return!1}),Ce(1))}),Go())),d=new V(g=>{const p=t.trackTx$(n).subscribe(g);return p.add(e(n).subscribe({error(m){g.error(m)}})),p}),h=iy(d,t.pinnedBlocks$).pipe(O(g=>{var p;return g.found?i("txBestBlocksState",{found:!0,block:{index:g.index,number:g.number,hash:g.hash},...ay(g.events,g.index)}):i("txBestBlocksState",{found:!1,isValid:((p=g.validity)==null?void 0:p.success)!==!1})}));return tr(r?he(i("signed",{})):fn,u,he(i("broadcasted",{})),h.pipe(ny(({found:g,type:p,...m})=>g?he(i("finalized",m)):fn)))})),bh=async(t,e,n,r)=>G0(Li(t,e,n)).then(s=>{if(s.type!=="finalized")throw null;const o={...s};return delete o.type,o}),cy=gn().enc,ly=new Uint8Array(64),uy=new Uint8Array(65),hy=t=>()=>t?uy:ly,[,fy]=xe({weight:xe({ref_time:vs,proof_size:vs}),class:De({Normal:N,Operational:N,Mandatory:N}),partial_fee:Kc}),Va=(t,e,n,r,{isCompatible:s,getCompatibilityLevel:o,compatibleRuntime$:i,argsAreCompatible:a,getRuntimeTypedef:c},l)=>Object.assign(u=>{const d=(A,S,E={})=>{const B=eo(A).runtime(),{dynamicBuilder:I,assetId:C,lookup:T,extVersions:D}=B;let P;try{P=I.buildCall(t,e)}catch{throw new Error(`Runtime entry Tx(${t}.${e}) not found`)}if(l&&!a(A,B,S))throw new Error(`Incompatible runtime entry Tx(${t}.${e})`);let F=E;if(E.asset){if(C==null||!Ws(E.asset,qs(T(C)),Ye=>c(B,Ye)))throw new Error("Incompatible runtime asset");F={...E,asset:I.buildDefinition(C).enc(E.asset)}}const{location:G,codec:W}=P,te=ke([new Uint8Array(G),W.enc(S)]);return{callData:Xe.fromBytes(te),bare:oe(ke(_e.enc(te.length+1),new Uint8Array(D.slice(-1)),te)),options:F}},h=(A,S={})=>i(n,null).pipe(O(([E])=>d(E,A,S))),g=A=>A?d(A,u).callData:qe(h(u).pipe(O(S=>S.callData))),p=A=>A?d(A,u).bare:qe(h(u).pipe(O(S=>S.bare))),m=(A,{...S},E)=>h(u,S).pipe(j(({callData:B,options:I})=>ey(n,A,B.asBytes(),E,S.customSignedExtensions||{},I))),b=(A,{at:S,...E}={})=>(!S||S==="finalized"?n.finalized$:S==="best"?n.best$:n.bestBlocks$.pipe(O(B=>B.find(I=>I.hash===S)))).pipe(Ce(1),j(B=>B?m(A,E,B).pipe(O(I=>({tx:oe(I),block:B}))):Pn(()=>new Error(`Uknown block ${S}`)))),y=(A,S)=>qe(b(A,S)).then(E=>E.tx),v=(A,S)=>qe(b(A,S)).then(({tx:E,block:B})=>bh(n,r,E,B.hash)),x=(A,S)=>b(A,S).pipe(j(({tx:E})=>Li(n,r,E,!0))),k=async(A,S)=>{typeof A=="string"&&(A=A.startsWith("0x")?Le(A):cy(A));const E=A.length===20,B=Ti(A,E?"Ecdsa":"Sr25519",hy(E)),I=Le(await y(B,S)),C=oe(ke([I,tt.enc(I.length)])),T=n.getRuntimeContext$(null).pipe(O(P=>{try{return P.dynamicBuilder.buildRuntimeCall("TransactionPaymentApi","query_info").value[1]}catch{return fy}})),D=n.call$(null,"TransactionPaymentApi_query_info",C);return qe(Pt([D,T]).pipe(O(([P,F])=>F(P))))};return{getPaymentInfo:k,getEstimatedFees:async(A,S)=>(await k(A,S)).partial_fee,decodedCall:{type:t,value:zs(e,u)},getEncodedData:g,getBareTx:p,sign:y,signSubmitAndWatch:x,signAndSubmit:v}},{getCompatibilityLevel:o,isCompatible:s}),dy=()=>{const t=new A0(new ut);return[t.pipe(vg()),()=>ir({next:e=>t.value.next(e),error:e=>{t.value.error(e),t.next(new ut)},complete:()=>{t.value.complete(),t.next(new ut)}})]};var py=Object.defineProperty,gy=(t,e,n)=>e in t?py(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,gt=(t,e,n)=>(gy(t,typeof e!="symbol"?e+"":e,n),n),So=Symbol("SUSPENSE"),my=class extends Promise{constructor(t){super(t)}},ja=class extends Error{constructor(){super(),this.name="NoSubscribersError"}},Ga=class extends Error{constructor(){super(),this.name="EmptyObservableError"}},Ge={},As=class extends V{constructor(t,e,n=Ue){super(r=>{const s=new Ir({next:r.next.bind(r),error:r.error.bind(r),complete:Ue});this.refCount++;let o;r.add(()=>{var i;this.refCount--,o.unsubscribe(),this.refCount===0&&(this.currentValue=Ge,this.subscription&&this.subscription.unsubscribe(),n(),(i=this.subject)==null||i.complete(),this.subject=null,this.subscription=null,this.promise&&(this.promise.rej(new ja),this.promise=null))}),this.subject?(o=this.subject.subscribe(s),this.currentValue!==Ge&&r.next(this.currentValue)):(this.subject=new ut,o=this.subject.subscribe(s),this.subscription=null,this.subscription=new Ir({next:i=>{this.promise&&i!==So&&(this.promise.res(i),this.promise=null),this.subject.next(this.currentValue=i)},error:i=>{var a;this.subscription=null;const c=this.subject;this.subject=null,this.currentValue=Ge;const l=(a=this.promise)==null?void 0:a.rej;l&&i===So&&(this.promise.rej=()=>{l(i)}),c.error(i),l&&this.promise&&(this.promise.rej=l)},complete:()=>{if(this.subscription=null,this.promise&&(this.promise.rej(new Ga),this.promise=null),this.currentValue!==Ge)return this.subject.complete();if(e===Ge){const i=this.subject;return this.subject=null,i.error(new Ga)}this.subject.next(this.currentValue=e),this.subject.complete()}}),t.subscribe(this.subscription),e!==Ge&&this.currentValue===Ge&&this.subject.next(this.currentValue=e))}),this.defaultValue=e,gt(this,"subject",null),gt(this,"subscription",null),gt(this,"refCount",0),gt(this,"currentValue",Ge),gt(this,"promise",null),gt(this,"pipeState",(...r)=>{const s=super.pipe(...r);return s instanceof As?s:new As(s,Ge)}),gt(this,"getRefCount",()=>this.refCount),gt(this,"getValue",()=>{if(this.promise)return this.promise.p;if(this.currentValue!==Ge&&this.currentValue!==So)return this.currentValue;if(this.defaultValue!==Ge)return this.defaultValue;if(this.refCount===0)throw new ja;const r=new my((s,o)=>{this.promise={res:s,rej:o,p:null}});return this.promise.p=r,r}),gt(this,"getDefaultValue",()=>this.defaultValue),e===Ge&&delete this.getDefaultValue}};function qa(t,e){e.getValue=t.getValue,e.getRefCount=t.getRefCount,e.pipeState=t.pipeState,t.getDefaultValue&&(e.getDefaultValue=t.getDefaultValue)}function yy(t,e){const n=new by,r=typeof e=="function"?e:()=>e,s=o=>{for(let u=o.length-1;o[u]===void 0&&u>-1;u--)o.splice(-1);const i=[o.length,...o],a=n.get(i);if(a!==void 0)return a;const c=new As(t(...o),r(...o),()=>{n.delete(i)}),l=new V(u=>{const d=n.get(i);let h=c;return d?d!==l&&(h=d,qa(h,l)):n.set(i,f),h.subscribe(u)});qa(c,l);const f=l;return n.set(i,f),f};return(...o)=>s(o)}var by=class{constructor(){gt(this,"root"),this.root=new Map}get(t){let e=this.root;for(let n=0;n<t.length;n++)if(e=e.get(t[n]),!e)return;return e}set(t,e){let n=this.root,r;for(r=0;r<t.length-1;r++){let s=n.get(t[r]);s||(s=new Map,n.set(t[r],s)),n=s}n.set(t[r],e)}delete(t){const e=[this.root];let n=this.root;for(let s=0;s<t.length-1;s++)e.push(n=n.get(t[s]));let r=e.length-1;for(e[r].delete(t[r]);--r>-1&&e[r].get(t[r]).size===0;)e[r].delete(t[r])}};function vy(t,e){return new As(t,e)}var Bo=(...t)=>(typeof t[0]=="function"?yy:vy)(t[0],t.length>1?t[1]:Ge);const Wa=(t,e,n)=>{const r=new Map(e.map(a=>[a.key,a])),s=new Map(t.map(a=>[a.key,a])),o=new Map,i=[];return e.forEach(a=>{const{key:c}=a,l=s.get(c);(!l||l.value!==a.value)&&o.set(c,n(a))}),t.forEach(a=>{r.has(a.key)||i.push(a)}),{deltas:{deleted:i,upserted:[...o.values()]},entries:e.map(({key:a})=>o.get(a)??s.get(a))}},Ka=(t,e,n,r=!1)=>{try{let s=r?t:n.blocks.get(t).parent;for(;s&&!e[s];)s=n.blocks.get(s).parent;return s?e[s]:null}catch{return null}},Ya=(t,e)=>n=>{const{keys:r,value:s}=n.dynamicBuilder.buildStorage(t,e);return o=>(o.dec={value:s.dec(o.value),args:r.dec(o.key)},o)},wy=(t,e,n)=>{const r=Bo((a,c,l)=>{const f=Ya(a,c),u=(m,b)=>{const y=Om(t,b.hash).pipe(vt(v=>!v),Ce(1));return e(b.hash,"closestDescendantMerkleValue",()=>l).pipe(j(v=>v===(m==null?void 0:m.rootHash)?he({...m,block:b,deltas:null,prev:m.block.hash}):e(b.hash,"descendantsValues",()=>l).pipe(n(()=>b.hash),O(([x,k])=>[x,f(k)]),O(([x,k])=>({prev:m&&m.block.hash,rootHash:v,block:b,...Wa((m==null?void 0:m.entries)??[],x,k)})))),Du(y),Ne(v=>v instanceof Mt?fn:Pn(()=>v)))},d=t.pipe(Ee((m,b)=>m.finalized===b.finalized),Zo(({blocks:m,finalized:b})=>u(null,m.get(b))),Ce(1),O(m=>({blocks:{[m.block.hash]:m},finalized:m.block.hash}))),[h,g]=dy(),p=t.pipe(Ee((m,b)=>m.best===b.best),qo(h),Zo(([m,b])=>{const{best:y}=m,{blocks:v}=b;let x=v[y]?null:y;if(!x)return fn;const k=Ka(x,v,m);return k?u(k,m.blocks.get(x)).pipe(O($=>(v[x]=$,b))):(x=m.finalized,u(v[b.finalized],m.blocks.get(x)).pipe(O($=>($.prev=null,{blocks:{[x]:$},finalized:x}))))}));return Hr(d,p).pipe(g())}),s=a=>(c,l,f)=>{const u=r(c,l,f),d=Ya(c,l),h=a?"finalized":"best";return Pt([u.pipe(dg(0)),t.pipe(Ee((g,p)=>g[h]===p[h]))]).pipe(O(([g,p])=>Ka(p[h],g.blocks,p,!0)),vt(Boolean),Ee(),Hu(null),bg(),qo(u),n(([[,g]])=>g.block.hash),O(([[[g,p],m],b])=>[g,p,m,d(b)]),j(([g,p,m,b])=>{if(!g)return[p];let y=p;const v=[];for(;y&&y.block.number>g.block.number;)v.unshift(y),y=y.prev?m.blocks[y.prev]:null;if(a&&(m.finalized=p.block.hash,v.length)){const{blocks:x}=m;Object.keys(x).forEach(k=>{x[k].block.number<v[0].block.number&&delete x[k]})}return g===y?v:[{...p,...g.rootHash===p.rootHash?{entries:g.entries,deltas:null}:Wa(g.entries,p.entries,b)}]}))},o=Bo(s(!0)),i=Bo(s(!1));return(a,c,l,f)=>{const u=f?i:o;return t.pipe(Ce(1),j(h=>h.runtimes[h.blocks.get(h[f?"best":"finalized"]).runtime].runtime),O(h=>h.dynamicBuilder.buildStorage(a,c).keys.enc(...l))).pipe(Ce(1),j(h=>u(a,c,h)),O(({block:{hash:h,number:g,parent:p},deltas:m,entries:b},y)=>{const v=y>0?m:{deleted:[],upserted:b};return{block:{hash:h,number:g,parent:p},entries:b.map(Ao),deltas:v&&{deleted:v.deleted.map(Ao),upserted:v.upserted.map(Ao)}}}))}},Ao=t=>t.dec,vh="RuntimeViewFunction",wh="execute_view_function",Io=vh+"_"+wh,xy=(t,e,n,{isCompatible:r,getCompatibilityLevel:s,compatibleRuntime$:o,argsAreCompatible:i,valuesAreCompatible:a})=>{const c=()=>new Error(`Incompatible runtime entry ViewFn(${t}.${e})`);return Object.assign((...f)=>{const u=f[f.length-1],d=Gn(u),{signal:h,at:g}=d?u:{},p=g??null,m=o(n,p).pipe(j(([b,y])=>{let v;try{v=y.dynamicBuilder.buildRuntimeCall(vh,wh)}catch{throw new Error(`Runtime entry RuntimeCall(${Io}) not found`)}let x;try{x=y.dynamicBuilder.buildViewFn(t,e)}catch{throw new Error(`Runtime entry ViewFn(${t}.${e}) not found`)}if(!i(b,y,f))throw c();const k=x.args.enc(f),$=ke([Le(y.lookup.metadata.pallets.find(({name:A})=>A===t).viewFns.find(({name:A})=>A===e).id),H.enc(k.length),k]);return n.call$(p,Io,oe($)).pipe(O(A=>{try{const S=v.value.dec(A);if(!("success"in S&&"value"in S)||!("type"in S.value)&&!("asBytes"in S.value))throw null;return S}catch{throw new Error(`Unexpected RuntimeCall(${Io}) type`)}}),O(({success:A,value:S})=>{if(!A)throw new Error(`ViewFn API Error: ${S.type}`);const E=x.value.dec(S.asBytes());if(!a(b,y,E))throw c();return E}))}),n.withHodl(p));return rr(m,h)},{getCompatibilityLevel:s,isCompatible:r})},Ey=/^(?:0x)?((?:[0-9a-fA-F][0-9a-fA-F])+)$/,Za=(t,e,n)=>{const r={},s=m=>new Proxy(r,{get(b,y){return m(y)}}),o=m=>{const b={};return s(y=>(b[y]||(b[y]={}),s(v=>(b[y][v]||(b[y][v]=m(y,v)),b[y][v]))))},i=(m,b)=>m.lookup.metadata.pallets.find(y=>y.name===b),a=wy(e.pinnedBlocks$,e.storage$,e.withRuntime),c=o((m,b)=>zm(m,b,e,a,xn(t,y=>y.getEntryPoint(on.Storage,m,b),y=>{var x,k;const v=(k=(x=i(y,m))==null?void 0:x.storage)==null?void 0:k.items.find($=>$.name===b);return v==null?null:l0(v)}))),l=(m,b,y,v)=>{if(y==null)return null;const x=m.lookup(y);if(x.type!=="enum")throw new Error("Expected enum");if(x.value[v]==null)return null;const k=u0(x.value[v]);return{args:b==="args"?k:Es,values:b==="args"?Es:k}},f=o((m,b)=>Va(m,b,e,n,xn(t,y=>y.getEntryPoint(on.Tx,m,b),y=>{var v,x;return l(y,"args",(x=(v=i(y,m))==null?void 0:v.calls)==null?void 0:x.type,b)}),!0)),u=o((m,b)=>Um(m,b,e,xn(t,y=>y.getEntryPoint(on.Event,m,b),y=>{var v,x;return l(y,"values",(x=(v=i(y,m))==null?void 0:v.events)==null?void 0:x.type,b)}))),d=o((m,b)=>Hm(m,b,xn(t,y=>y.getEntryPoint(on.Const,m,b),y=>{var x,k;const v=(k=(x=i(y,m))==null?void 0:x.constants.find($=>$.name===b))==null?void 0:k.type;return v==null?null:h0(v)}))),h=o((m,b)=>Nm(m,b,e,xn(t,y=>y.getEntryPoint(on.Api,m,b),y=>{var x;const v=(x=y.lookup.metadata.apis.find(k=>k.name===m))==null?void 0:x.methods.find(k=>k.name===b);return v==null?null:va(v)}))),g=o((m,b)=>xy(m,b,e,xn(t,y=>y.getEntryPoint(on.ViewFns,m,b),y=>{var x;const v=(x=y.lookup.metadata.pallets.find(k=>k.name===m))==null?void 0:x.viewFns.find(k=>k.name===b);return v==null?null:va(v)}))),p=(m,b)=>{const{lookup:y,dynamicBuilder:v}=eo(b).runtime();try{const x=v.buildDefinition(y.call).dec(m.asBytes()),k=x.type,$=x.value.type,A=x.value.value;return Va(k,$,e,n,xn(t,S=>S.getEntryPoint(on.Tx,k,$),S=>{var E,B;return l(S,"args",(B=(E=i(S,k))==null?void 0:E.calls)==null?void 0:B.type,$)}),!1)(A)}catch{throw new Error("createTx: invalid call data")}};return{query:c,txFromCallData:(m,b)=>b?p(m,b):t.then(y=>p(m,y)),tx:f,event:u,apis:h,constants:d,view:g}};function ky(t,{getMetadata:e,setMetadata:n}={}){const r=Vg(t),s=_m(r,{getMetadata:e?y=>dn(e(y)):void 0,setMetadata:n}),{getChainSpecData:o}=r,{genesis$:i,...a}=s.chainHead$(),c=s.archive(a.getRuntime$),l={...a,genesis$:Ys(o).pipe(O(({genesisHash:y})=>y),Ne(()=>i),Xs(1)),storage$:wn(a.storage$,c.storage$),body$:wn(a.body$,c.body$),call$:wn(a.call$,c.call$),header$:wn(a.header$,c.header$),eventsAt$:wn(a.eventsAt$,c.eventsAt$),storageQueries$:wn(a.storageQueries$,c.storageQueries$),getRuntimeContext$:wn(a.getRuntimeContext$,c.getRuntimeContext$)},f=r.request;let u;const d=new WeakMap,h=y=>{const v=d.get(y)||Pm(y,l);return d.set(y,v),v},g=()=>u??(u=Mm(l)),{broadcastTx$:p}=s,m=y=>l.getRuntimeContext$(y).pipe(O(v=>v.metadataRaw)),b={getChainSpecData:o,getMetadata$:m,getMetadata:(y,v)=>rr(m(y),v),blocks$:l.newBlocks$,hodlBlock:y=>l.holdBlock(y,!0),finalizedBlock$:l.finalized$,getFinalizedBlock:()=>qe(l.finalized$),bestBlocks$:l.bestBlocks$,getBestBlocks:()=>qe(l.bestBlocks$),watchBlockBody:l.body$,getBlockBody:y=>qe(l.body$(y)),getBlockHeader:y=>qe(l.header$(y??null)),submit:(...y)=>bh(l,p,...y),submitAndWatch:y=>Li(l,p,y),getTypedApi:y=>{const v=h(y);return Object.assign(Za(v,l,p),{compatibilityToken:v})},getUnsafeApi:()=>{const y=g();return Object.assign(Za(y,l,p),{runtimeToken:y})},rawQuery:(y,{at:v,signal:x}={})=>rr(l.storage$(v??null,"value",()=>{var $;const k=($=y.match(Ey))==null?void 0:$[1];return k?`0x${k}`:Xe.fromText(y).asHex()}),x),destroy:()=>{l.unfollow(),s.destroy()},_request:f};return b.___INTERNAL_DO_NOT_USE=l,b}const Sy=t=>{let e=null;const{send:n,disconnect:r}=t(s=>{e==null||e(JSON.parse(s))});return s=>(e=s,{send(o){n(JSON.stringify(o))},disconnect(){e=null,r()}})},By=t=>{let e=null;const{send:n,disconnect:r}=t(s=>{e==null||e(JSON.stringify(s))});return s=>(e=s,{send(o){n(JSON.parse(o))},disconnect(){e=null,r()}})},Ay=(...t)=>e=>By(t.reduce((n,r)=>r(n),Sy(e))),ue={body:"",call:"",continue:"",follow:"",header:"",stopOperation:"",storage:"",unfollow:"",unpin:""},Ri={broadcast:"",stop:""},Er={chainName:"",genesisHash:"",properties:""};Object.entries({chainHead:ue,chainSpec:Er,transaction:Ri}).forEach(([t,e])=>{Object.keys(e).forEach(n=>{e[n]=`${t}_v1_${n}`})});const Iy=t=>e=>{const{send:n,disconnect:r}=t(e);return{send:o=>{switch(o.method){case Er.chainName:return n({...o,method:"system_chain"});case Er.genesisHash:return n({...o,method:"chain_getBlockHash",params:[0]});case Er.properties:return n({...o,method:"system_properties"})}n(o)},disconnect:r}},$y=t=>e=>{const n=new Set,r=new Map,s=new Map,{send:o,disconnect:i}=t(c=>{if("id"in c){e(c);const{id:l,result:f}=c;if(n.has(l)){n.delete(l),r.set(f,new Set),s.set(f,new Map);return}}else{const{subscription:l}=c.params,f=r.get(l),u=s.get(l);if(f){const d=c.params.result,{event:h}=d;if(h==="initialized"&&d.finalizedBlockHashes.forEach(g=>{f.add(g)}),h==="newBlock"){const{parentBlockHash:g}=d;if(!f.has(g)){const b=u.get(g)??[];b.push(c),u.set(g,b);return}const p=d.blockHash;f.add(d.blockHash),e(c);const m=u.get(p);m&&(u.delete(p),m.forEach(b=>{f.add(b.params.result.blockHash),e(b)}));return}h==="stop"&&(f.delete(l),s.delete(l))}e(c)}});return{send:c=>{const l=c.params[0];switch(c.method){case ue.follow:n.add(c.id);break;case ue.unpin:const[f,u]=c.params;u.forEach(d=>{var h,g;(h=r.get(f))==null||h.delete(d),(g=s.get(f))==null||g.delete(d)});break;case ue.unfollow:r.delete(l),s.delete(l);break}o(c)},disconnect:i}},Is=t=>({jsonrpc:"2.0",...t}),fs=(t,e,n,r={})=>Is({method:"chainHead_v1_followEvent",params:{subscription:t,result:{event:e,operationId:n,...r}}}),Cy="__INNER_RQ_DesV",_y=t=>{let e=0;const n=new Map,r=({id:a,error:c,result:l})=>{const f=n.get(a);return f&&(n.delete(a),c?f(!1,c):f(!0,l)),!f};let s=()=>{};return[a=>{const{send:c,disconnect:l}=t(f=>{r(f)&&a(f)});return s=c,{send:s,disconnect:()=>{n.clear(),l()}}},(a,c,l,f)=>{const u=Cy+e++;n.set(u,(d,h)=>{(d?l:f)(h)}),s(Is({id:u,method:a,params:c}))}]},Oy="__INNER_OP_DesV";let Ty=0;const Ly=t=>e=>{const[n,r]=_y(t),s=Ry(r),o=new Map,i=new Map,{send:a,disconnect:c}=n(u=>{if("id"in u){const d=o.get(u.id);d&&(o.delete(u.id),u.result.result==="started"&&d(u.result.operationId))}else if(u.params){const{subscription:d,result:h}=u.params,{operationId:g}=h||{},p=i.get(d);p&&h.event==="stop"&&(p.forEach(b=>{b.cancel()}),i.delete(d));const m=p==null?void 0:p.get(g);if(m)switch(h.event){case"operationInaccessible":case"operationError":m.cancel();break;case"operationStorageDone":if(m.isInnerDone)p.delete(g);else{m.isOutterDone=!0;return}}}e(u)}),l=(u,d,h)=>g=>{let p=()=>{};i.has(u)||i.set(u,new Map);const m=i.get(u),b={isOutterDone:!1,isInnerDone:!1,cancel:()=>{p()}};m.set(g,b);let y=0;const v=h.map(x=>s(x,d,k=>{e(fs(u,"operationStorageItems",g,{items:k.map(([$,A])=>({key:$,value:A}))}))},k=>{p(),b.isOutterDone||a(Is({method:"chainHead_v1_stopOperation",params:[g]})),e(fs(u,"operationError",g,{error:typeof k=="string"?k:JSON.stringify(k)}))},()=>{++y===h.length&&(b.isOutterDone?(p(),e(fs(u,"operationStorageDone",g))):b.isInnerDone=!0)}));p=()=>{m.delete(g),v.forEach(x=>x())}};return{send:u=>{var d,h;switch(u.method){case ue.storage:{const[g,p,m]=u.params,b=[],y=m.filter(x=>{const k=x.type==="descendantsValues";return k&&b.push(x.key),!k}),v=l(g,p,b);if(y.length)b.length&&o.set(u.id,v);else{const x=Oy+Ty++;e(Is({id:u.id,result:{result:"started",operationId:x}})),v(x),i.get(g).get(x).isOutterDone=!0;return}u.params[2]=y;break}case ue.stopOperation:{const[g,p]=u.params,m=(d=i.get(g))==null?void 0:d.get(p);if(m&&(m.cancel(),m.isOutterDone))return;break}case ue.unfollow:{const[g]=u.params;(h=i.get(g))==null||h.forEach(p=>p.cancel()),i.delete(g);break}}a(u)},disconnect:c}},Ry=t=>(e,n,r,s,o)=>{let i=!0,a=!1,c=0;const l=d=>{i&&(i=!1,s(d))},f=1e3,u=d=>{t("state_getKeysPaged",[e,f,d||void 0,n],h=>{i&&(h.length>0&&(c++,t("state_queryStorageAt",[h,n],([{changes:g}])=>{i&&(c--,r(g),a&&!c&&o())},l)),h.length<f?(a=!0,c||o()):u(h.at(-1)))},l)};return u(),()=>{i=!1}},Py=t=>e=>{const n=new Set,r=new Map,s=new Map,{send:o,disconnect:i}=t(c=>{if("id"in c){e(c);const{id:l,result:f}=c;if(n.has(l)){n.delete(l),r.set(f,new Set),s.set(f,new Map);return}}else{const{subscription:l}=c.params,f=r.get(l),u=s.get(l);if(f){const d=c.params.result,{event:h}=d;if(h==="initialized"&&d.finalizedBlockHashes.forEach(g=>{f.add(g)}),h==="finalized"&&(d.prunedBlockHashes=d.prunedBlockHashes.filter(g=>f.has(g))),h==="newBlock"){f.add(d.blockHash);const g=d.blockHash,p=u.get(g);if(p){u.delete(g),e(c),Promise.resolve().then(()=>{e(p)});return}}if(h==="bestBlockChanged"){const g=d.bestBlockHash;if(!f.has(g)){s.get(l).set(g,c);return}}h==="stop"&&(f.delete(l),s.delete(l))}e(c)}});return{send:c=>{const l=c.params[0];switch(c.method){case ue.follow:n.add(c.id);break;case ue.unpin:const[f,u]=c.params;u.forEach(d=>{var h,g;(h=r.get(f))==null||h.delete(d),(g=s.get(f))==null||g.delete(d)});break;case ue.unfollow:r.delete(l),s.delete(l);break}o(c)},disconnect:i}},My=new Set(["BodyDone","CallDone","StorageDone","Inaccessible","Error"].map(t=>"operation"+t)),Xa=t=>{var e,n;return My.has((n=(e=t.params)==null?void 0:e.result)==null?void 0:n.event)},Hy=t=>e=>{const n=new Set,r=new Map,s=new Map,o=new Map,{send:i,disconnect:a}=t(l=>{var f,u;if("id"in l){e(l);const{id:d,result:h}=l;if(n.has(d)){n.delete(d),s.set(h,new Set),o.set(h,new Map);return}const g=r.get(d);if(g!==void 0){r.delete(d);const p=(f=l.result)==null?void 0:f.operationId;if(p!==void 0&&s.has(g)){const m=s.get(g);m.add(p);const b=(u=o.get(g))==null?void 0:u.get(p);b&&(b.forEach(e),o.get(g).delete(p),Xa(b.at(-1))&&m.delete(p))}}}else{const{subscription:d,result:h}=l.params,g=s.get(d);if(g){const{operationId:p}=l.params.result;if(p!==void 0)if(g.has(p))Xa(l)&&g.delete(p);else{const m=o.get(d),b=m.get(p)??[];b.push(l),m.set(p,b);return}else(h==null?void 0:h.event)==="stop"&&(s.delete(d),o.delete(d))}e(l)}});return{send:l=>{var u;const f=l.params[0];switch(l.method){case ue.follow:n.add(l.id);break;case ue.body:case ue.call:case ue.storage:r.set(l.id,f);break;case ue.unfollow:s.delete(f),o.delete(f);break;case ue.stopOperation:(u=s.get(f))==null||u.delete(l.params[1])}i(l)},disconnect:a}},Dy=new Set(["newBlock","bestBlockChanged","stop"]),Uy=t=>e=>{const n=new Set,r=new Map,{send:s,disconnect:o}=t(i=>{if("id"in i){const{id:a,result:c}=i;n.has(a)&&(n.delete(a),r.set(c,()=>{r.delete(c)}))}else{const{subscription:a}=i.params,c=r.get(a);if(c){const l=i.params.result,{event:f}=l;if(f==="initialized"){const u=setTimeout(()=>{r.delete(a),e(fs(a,"bestBlockChanged",void 0,{bestBlockHash:l.finalizedBlockHashes.at(-1)}))},500);r.set(a,()=>{r.delete(a),clearTimeout(u)})}else Dy.has(f)&&c()}}e(i)});return{send(i){var a;switch(i.method){case ue.follow:n.add(i.id);break;case ue.unfollow:(a=r.get(i.params[0]))==null||a()}s(i)},disconnect:o}},Ny=t=>e=>t(n=>{var s;const r=(s=n.params)==null?void 0:s.result;if(!("id"in n)&&r){const{prunedBlockHashes:o,finalizedBlockHash:i,event:a}=r;a==="finalized"&&Array.isArray(o)?r.prunedBlockHashes=[...new Set(r.prunedBlockHashes)]:a==="initialized"&&i&&(r.finalizedBlockHashes=[r.finalizedBlockHash],delete r.finalizedBlockHash)}e(n)}),zy=t=>e=>{const{send:n,disconnect:r}=t(e);return{send:o=>{const{method:i,params:a,id:c,...l}=o;i==ue.unpin&&a&&Array.isArray(a[1])?a[1].forEach((f,u)=>{n({...l,id:u===0?c:`${c}-patched-${u}`,method:i,params:[a[0],f]})}):n(o)},disconnect:r}},Ja=t=>({jsonrpc:"2.0",...t}),[$o]=Ri.stop.split("_"),Qa="unstable",ec="rpc_methods",tc="__INTERNAL_ID",Fy=t=>e=>{let n=!0,r=[],s=d=>{r.push(d)};const o=({id:d,result:h,error:g})=>{if(d!==tc||!n)return;if(!h){if(console.error(g),f<4){setTimeout(u,200);return}h={methods:[]}}const p=new Set(h.methods),m={};[ue,Er,Ri].forEach(v=>{Object.values(v).forEach(x=>{if(p.has(x))m[x]=x;else{const[k,,$]=x.split("_"),A=`${k}_${Qa}_${$}`;if(p.has(A))m[x]=A,p.delete(A),p.add(x);else if(m[x]=null,k===$o){let S;const E=x==="stop"?"unwatch":"submitAndWatch";[$o+"Watch",$o].find(I=>["v1",Qa].find(C=>p.has(S=`${I}_${C}_${E}`)))&&(m[x]=S,p.add(x))}}})}),i=e;const b=({method:v,...x})=>{if(v===ec){Promise.resolve().then(()=>{e(Ja({id:x.id,result:{methods:[...p]}}))});return}const k=m[v];k===null?v.split("_")[2]==="follow"?(l(),s({method:v,...x})):Promise.resolve().then(()=>{e({error:{code:-32603,message:`Method not found: ${v}`},id:x.id})}):a({method:k||v,...x})},y=[...r];r=[];for(let v=0;n&&v<y.length;v++)b(y[v]);n&&(s=b)};let i=o;const{send:a,disconnect:c}=t(d=>{i(d)}),l=()=>{n=!0,r=[],s=d=>{r.push(d)},i=o,u()};let f=0;const u=()=>{f++,a(Ja({id:tc,method:ec,params:[]}))};return u(),{send:d=>{s(d)},disconnect(){n=!1,s=i=()=>{},r=[],c()}}},Vy=t=>e=>{let n=0;const r=new Map,{send:s,disconnect:o}=t(i=>{const{id:a}=i;r.has(a)&&(i.id=r.get(a),r.delete(a)),e(i)});return{send:i=>{"id"in i&&(r.set(n,i.id),i.id=n++),s(i)},disconnect:o}},jy=Ay(Vy,Fy,Hy,zy,Ny,$y,Py,Uy,Iy,Ly),En=t=>JSON.stringify({jsonrpc:"2.0",...t});let Gy=0;const xh=()=>`proxyOpaque${Gy++}`,nc=()=>`___proxyInternalId__${xh()}`,qy=t=>{let e={type:1,activeBroadcasts:new Map,pending:[]};const n=s=>{var i;let o=!0;if(e.type===0){const a=JSON.parse(s);if("id"in a){const{id:c}=a;if(e.pendingBroadcasts.has(c)){const l=e.pendingBroadcasts.get(c),f=a.result;e.pendingBroadcasts.delete(c),e.activeBroadcasts.get(l)?e.activeBroadcasts.get(l).upToken=f:e.connection.send(En({id:nc(),method:"transaction_v1_stop",params:[f]}));return}o=e.onGoingRequests.has(c),"result"in a&&((i=e.onGoingRequests.get(c))==null?void 0:i.type)===0&&e.activeChainHeads.add(a.result),e.onGoingRequests.delete(a.id)}else if("params"in a){const{subscription:c,result:l}=a.params;(l==null?void 0:l.event)==="stop"&&e.activeChainHeads.delete(c)}}o&&e.type!==2&&t(s)},r=s=>{if(e.type===2)return;const o=JSON.parse(s);if("id"in o){const{method:i,id:a,params:c}=o,[l,,f]=i.split("_");if(l==="transaction"){if(f==="stop"){const[u]=c,d=e.activeBroadcasts.get(u);e.activeBroadcasts.delete(u),t(En({id:a,result:null})),e.type===0&&d&&d.upToken&&e.connection.send(En({id:a,method:i,params:[d.upToken]}));return}if(f==="broadcast"){const u=xh();e.activeBroadcasts.set(u,{tx:c[0],synToken:u}),e.type===0&&(e.pendingBroadcasts.set(a,u),e.connection.send(s)),t(En({id:a,result:u}));return}}}if(e.type===1){e.pending.push(s);return}if(o.method==="chainHead_v1_unfollow"&&e.activeChainHeads.delete(o.params[0]),"id"in o){const{method:i,id:a}=o,[c,,l]=i.split("_"),f=c==="chainHead"?l==="follow"?{type:0,msg:s}:{type:1,id:a}:{type:2,msg:s};e.onGoingRequests.set(a,f)}e.connection.send(s)};return{send:r,disconnect:()=>{e.type!==2&&(e.type===0&&e.connection.disconnect(),e={type:2})},connect:s=>{if(e.type!==1)throw new Error("Nonesense");const{pending:o,activeBroadcasts:i}=e,a=new Map,c=new Set,l=()=>{const f=e.type!==2?e.activeBroadcasts:new Map;f.forEach(u=>u.upToken=void 0),e={type:1,activeBroadcasts:f,pending:[]},c.forEach(u=>{n(En({params:{subscription:u,result:{event:"stop",internal:!0}}}))}),c.clear();for(const u of a.values())u.type===1?n(En({id:u.id,error:{code:-32603,message:"Internal error"},internal:!0})):r(u.msg);a.clear()};e={type:0,connection:null,activeBroadcasts:i,pendingBroadcasts:new Map,onGoingRequests:a,activeChainHeads:c},e.connection=s(n,l),i.forEach(f=>{if(e.type===0){const u=nc();e.pendingBroadcasts.set(u,f.synToken),r(En({id:u,method:"transaction_v1_broadcast",params:[f.tx]}))}}),o.forEach(r)}}},rc=250,Wy=t=>e=>{let n=qy(e),r=Date.now(),s=0,o;const i=()=>s&&2**Math.min(5,s)*rc,a=()=>t().then(l=>{if(n)n.connect((f,u)=>{let d=!0;return l(f,()=>{if(d){d=!1;const h=r-Date.now();s+=h>rc+i()?-s:1,r+=h,u(),c()}})});else try{l(()=>{},()=>{}).disconnect()}catch{}},c),c=()=>{o=setTimeout(a,i())};return a(),{send:l=>{n==null||n.send(l)},disconnect:()=>{clearTimeout(o);const l=(n==null?void 0:n.disconnect)||(()=>{});n=null,l()}}};var mt=(t=>(t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.ERROR=2]="ERROR",t[t.CLOSE=3]="CLOSE",t))(mt||{});const Xo={};["v1","unstable"].forEach(t=>{Xo[`chainHead_${t}_follow`]="follow",Xo[`chainHead_${t}_unfollow`]="unfollow"});const sc=()=>({latest:Date.now(),count:0}),Ky=(t,e)=>{const n=new Set,r=new Map,s=new Set;let o,i=sc();return Object.assign(c=>{const{send:l,disconnect:f}=t(u=>{const d=JSON.parse(u);if("id"in d){const{id:h,result:g}=d;if(h===o&&(o=void 0,g&&!g.methods.some(m=>{const[b,,y]=m.split("_");return b==="chainHead"&&y==="follow"}))){c(u),e();return}const p=r.get(h);if(p){if(r.delete(h),n.has(g)){n.delete(g);return}s.add(g);const m=s.size+r.size;if(m>2)console.warn(`Too many chainHead follow subscriptions (${m})`);else if(d.error){console.warn(`chainHead follow failed on the ${m} sub`),e(),r.set(h,p),l(p);return}}}else{const{subscription:h,result:g}=d.params;if((g==null?void 0:g.event)==="stop"){const p=Date.now()-i.latest;i.latest+=p,i.count=p<1e3?i.count+1:1,s.has(h)?s.delete(h):n.add(h)}}c(u),i.count>2&&(i=sc(),e())});return{send(u){const d=JSON.parse(u);d.method==="rpc_methods"&&(o=d.id);const h=Xo[d.method];h==="follow"?r.set(d.id,u):h==="unfollow"&&s.delete(d.params[0]),l(u)},disconnect:f}},{cleanup:()=>{n.clear(),r.clear(),s.clear()}})},oc={type:mt.ERROR,event:{type:"timeout"}},qn=()=>{},Eh={onStatusChanged:qn,innerEnhancer:t=>t,timeout:5e3,heartbeatTimeout:4e4},Jo=t=>t.map(e=>typeof e=="string"?[e]:[e.uri,e.protocol]),Yy=(t,e)=>{const{onStatusChanged:n,innerEnhancer:r,timeout:s,heartbeatTimeout:o}={...Eh,...e},i=Jo(Array.isArray(t)?t:[t]),a=(e==null?void 0:e.websocketClass)??globalThis.WebSocket;if(!a)throw new Error("Missing WebSocket class");let c=0,l,f=null,u=qn,d=qn;const h=Ky(Wy(async()=>{const[p,m]=f||i[c++%t.length];f=null;const b=new a(p,m),y=()=>{try{b.addEventListener("error",qn,{once:!0}),b.close()}catch{}};n(l={type:mt.CONNECTING,uri:p,protocols:m}),await new Promise((k,$)=>{const A=()=>{B(),k()},S=I=>{B(),I==null&&y(),console.error(`Unable to connect to ${p}${m?", protocols: "+m:""}`),n(l={type:I?mt.ERROR:mt.CLOSE,event:I}),setTimeout($,I?300:0,I)},E=s!==1/0?setTimeout(()=>{B(),y(),n(l=oc),$(oc.event)},s):void 0,B=()=>{clearTimeout(E),b.removeEventListener("error",S),b.removeEventListener("open",A)};b.addEventListener("open",A),b.addEventListener("error",S),u=()=>{S(null)}}),n(l={type:mt.CONNECTED,uri:p,protocols:m});let v;const x=r(k=>(v=k,{send:$=>{b.send($)},disconnect:()=>{u()}}));return(k,$)=>{let A;const S=()=>{o>Zy||(clearTimeout(A),A=setTimeout(()=>{console.warn("Terminate: heartbeat timeout"),u(!0)},o))};S();const E=x(k),B=D=>{S(),typeof D.data=="string"&&v(D.data)},I=D=>P=>{clearTimeout(A),console.warn(`WS halt (${D})`),n(l={type:D,event:P}),$()},C=I(mt.ERROR),T=I(mt.CLOSE);return b.addEventListener("ping",S),b.addEventListener("message",B),b.addEventListener("error",C),b.addEventListener("close",T),u=D=>{clearTimeout(A),d(),u=qn,b.removeEventListener("ping",S),b.removeEventListener("message",B),b.removeEventListener("error",C),b.removeEventListener("close",T),y(),D&&T({}),E.disconnect()},E}}),()=>{g()});d=h.cleanup,delete h.cleanup;const g=(...p)=>{l.type!==mt.CLOSE&&(p.length&&(f=p),l.type!==mt.ERROR&&u(!0))};return Object.assign(h,{switch:g,getStatus:()=>l})},Zy=2147483647,Xy=t=>(...e)=>{let n=[],{heartbeatTimeout:r,timeout:s,innerEnhancer:o,onStatusChanged:i}=Eh;const[a]=e;return e.length===1&&typeof a=="object"&&!Array.isArray(a)?(n=Jo(a.endpoints),i=a.onStatusChanged??qn,s=a.timeout??s,r=a.heartbeatTimeout??r,o=a.innerEnhancer??(c=>c)):(typeof e[1]=="function"&&(i=e[1]),Array.isArray(a)?n=Jo(a):(n=[[a]],e[1]&&e[1]!==i&&(n[0][1]=e[1]),e[2]&&(i=e[2]))),Yy(n.map(c=>c.length===1?c[0]:{uri:c[0],protocol:c[1]}),{websocketClass:t,onStatusChanged:i,timeout:s,innerEnhancer:o,heartbeatTimeout:r})},Jy=Xy(WebSocket),Qy="ws://localhost:41813";let Xn=null;async function $s(){return Xn||(Xn=ky(jy(Jy(Qy)))),Xn}function eb(){Xn&&(Xn.destroy(),Xn=null)}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function kh(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Pi(t,e,n=""){const r=kh(t),s=t==null?void 0:t.length;if(!r||e!==void 0){const i=n&&`"${n}" `,a="",c=r?`length=${s}`:`type=${typeof t}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return t}function ic(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function tb(t,e){Pi(t,void 0,"digestInto() output");const n=e.outputLen;if(t.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function nb(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Cs(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Co(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const rb=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",At={_0:48,_9:57,A:65,F:70,a:97,f:102};function ac(t){if(t>=At._0&&t<=At._9)return t-At._0;if(t>=At.A&&t<=At.F)return t-(At.A-10);if(t>=At.a&&t<=At.f)return t-(At.a-10)}function sb(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(rb)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let s=0,o=0;s<n;s++,o+=2){const i=ac(t.charCodeAt(o)),a=ac(t.charCodeAt(o+1));if(i===void 0||a===void 0){const c=t[o]+t[o+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+o)}r[s]=i*16+a}return r}function Mi(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function _s(...t){let e=0;for(let r=0;r<t.length;r++){const s=t[r];Pi(s),e+=s.length}const n=new Uint8Array(e);for(let r=0,s=0;r<t.length;r++){const o=t[r];n.set(o,s),s+=o.length}return n}function ob(t,e={}){const n=(s,o)=>t(o).update(s).digest(),r=t(void 0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=s=>t(s),Object.assign(n,e),Object.freeze(n)}function Sh(t=32){const e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof(e==null?void 0:e.getRandomValues)!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(t))}const ib=t=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,t])});let ab=class{constructor(e,n,r,s){w(this,"blockLen");w(this,"outputLen");w(this,"padOffset");w(this,"isLE");w(this,"buffer");w(this,"view");w(this,"finished",!1);w(this,"length",0);w(this,"pos",0);w(this,"destroyed",!1);this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Co(this.buffer)}update(e){ic(this),Pi(e);const{view:n,buffer:r,blockLen:s}=this,o=e.length;for(let i=0;i<o;){const a=Math.min(s-this.pos,o-i);if(a===s){const c=Co(e);for(;s<=o-i;i+=s)this.process(c,i);continue}r.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ic(this),tb(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:s,isLE:o}=this;let{pos:i}=this;n[i++]=128,Cs(this.buffer.subarray(i)),this.padOffset>s-i&&(this.process(r,0),i=0);for(let u=i;u<s;u++)n[u]=0;r.setBigUint64(s-8,BigInt(this.length*8),o),this.process(r,0);const a=Co(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,f[u],o)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:s,finished:o,destroyed:i,pos:a}=this;return e.destroyed=i,e.finished=o,e.length=s,e.pos=a,s%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}};const Be=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Gr=BigInt(2**32-1),cc=BigInt(32);function cb(t,e=!1){return e?{h:Number(t&Gr),l:Number(t>>cc&Gr)}:{h:Number(t>>cc&Gr)|0,l:Number(t&Gr)|0}}function Bh(t,e=!1){const n=t.length;let r=new Uint32Array(n),s=new Uint32Array(n);for(let o=0;o<n;o++){const{h:i,l:a}=cb(t[o],e);[r[o],s[o]]=[i,a]}return[r,s]}const lc=(t,e,n)=>t>>>n,uc=(t,e,n)=>t<<32-n|e>>>n,Hn=(t,e,n)=>t>>>n|e<<32-n,Dn=(t,e,n)=>t<<32-n|e>>>n,qr=(t,e,n)=>t<<64-n|e>>>n-32,Wr=(t,e,n)=>t>>>n-32|e<<64-n,lb=(t,e,n)=>t<<n|e>>>32-n,ub=(t,e,n)=>e<<n|t>>>32-n,hb=(t,e,n)=>e<<n-32|t>>>64-n,fb=(t,e,n)=>t<<n-32|e>>>64-n;function It(t,e,n,r){const s=(e>>>0)+(r>>>0);return{h:t+n+(s/2**32|0)|0,l:s|0}}const db=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),pb=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,gb=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),mb=(t,e,n,r,s)=>e+n+r+s+(t/2**32|0)|0,yb=(t,e,n,r,s)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(s>>>0),bb=(t,e,n,r,s,o)=>e+n+r+s+o+(t/2**32|0)|0,Ah=Bh(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),vb=Ah[0],wb=Ah[1],Gt=new Uint32Array(80),qt=new Uint32Array(80);let xb=class extends ab{constructor(e){super(128,e,16,!1)}get(){const{Ah:e,Al:n,Bh:r,Bl:s,Ch:o,Cl:i,Dh:a,Dl:c,Eh:l,El:f,Fh:u,Fl:d,Gh:h,Gl:g,Hh:p,Hl:m}=this;return[e,n,r,s,o,i,a,c,l,f,u,d,h,g,p,m]}set(e,n,r,s,o,i,a,c,l,f,u,d,h,g,p,m){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=s|0,this.Ch=o|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=f|0,this.Fh=u|0,this.Fl=d|0,this.Gh=h|0,this.Gl=g|0,this.Hh=p|0,this.Hl=m|0}process(e,n){for(let v=0;v<16;v++,n+=4)Gt[v]=e.getUint32(n),qt[v]=e.getUint32(n+=4);for(let v=16;v<80;v++){const x=Gt[v-15]|0,k=qt[v-15]|0,$=Hn(x,k,1)^Hn(x,k,8)^lc(x,k,7),A=Dn(x,k,1)^Dn(x,k,8)^uc(x,k,7),S=Gt[v-2]|0,E=qt[v-2]|0,B=Hn(S,E,19)^qr(S,E,61)^lc(S,E,6),I=Dn(S,E,19)^Wr(S,E,61)^uc(S,E,6),C=gb(A,I,qt[v-7],qt[v-16]),T=mb(C,$,B,Gt[v-7],Gt[v-16]);Gt[v]=T|0,qt[v]=C|0}let{Ah:r,Al:s,Bh:o,Bl:i,Ch:a,Cl:c,Dh:l,Dl:f,Eh:u,El:d,Fh:h,Fl:g,Gh:p,Gl:m,Hh:b,Hl:y}=this;for(let v=0;v<80;v++){const x=Hn(u,d,14)^Hn(u,d,18)^qr(u,d,41),k=Dn(u,d,14)^Dn(u,d,18)^Wr(u,d,41),$=u&h^~u&p,A=d&g^~d&m,S=yb(y,k,A,wb[v],qt[v]),E=bb(S,b,x,$,vb[v],Gt[v]),B=S|0,I=Hn(r,s,28)^qr(r,s,34)^qr(r,s,39),C=Dn(r,s,28)^Wr(r,s,34)^Wr(r,s,39),T=r&o^r&a^o&a,D=s&i^s&c^i&c;b=p|0,y=m|0,p=h|0,m=g|0,h=u|0,g=d|0,{h:u,l:d}=It(l|0,f|0,E|0,B|0),l=a|0,f=c|0,a=o|0,c=i|0,o=r|0,i=s|0;const P=db(B,C,D);r=pb(P,E,I,T),s=P|0}({h:r,l:s}=It(this.Ah|0,this.Al|0,r|0,s|0)),{h:o,l:i}=It(this.Bh|0,this.Bl|0,o|0,i|0),{h:a,l:c}=It(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:f}=It(this.Dh|0,this.Dl|0,l|0,f|0),{h:u,l:d}=It(this.Eh|0,this.El|0,u|0,d|0),{h,l:g}=It(this.Fh|0,this.Fl|0,h|0,g|0),{h:p,l:m}=It(this.Gh|0,this.Gl|0,p|0,m|0),{h:b,l:y}=It(this.Hh|0,this.Hl|0,b|0,y|0),this.set(r,s,o,i,a,c,l,f,u,d,h,g,p,m,b,y)}roundClean(){Cs(Gt,qt)}destroy(){Cs(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Eb=class extends xb{constructor(){super(64);w(this,"Ah",Be[0]|0);w(this,"Al",Be[1]|0);w(this,"Bh",Be[2]|0);w(this,"Bl",Be[3]|0);w(this,"Ch",Be[4]|0);w(this,"Cl",Be[5]|0);w(this,"Dh",Be[6]|0);w(this,"Dl",Be[7]|0);w(this,"Eh",Be[8]|0);w(this,"El",Be[9]|0);w(this,"Fh",Be[10]|0);w(this,"Fl",Be[11]|0);w(this,"Gh",Be[12]|0);w(this,"Gl",Be[13]|0);w(this,"Hh",Be[14]|0);w(this,"Hl",Be[15]|0)}};const kb=ob(()=>new Eb,ib(3));/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function to(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Hi(t,e=""){if(!Number.isSafeInteger(t)||t<0){const n=e&&`"${e}" `;throw new Error(`${n}expected integer >= 0, got ${t}`)}}function ye(t,e,n=""){const r=to(t),s=t==null?void 0:t.length,o=e!==void 0;if(!r||o&&s!==e){const i=n&&`"${n}" `,a=o?` of length ${e}`:"",c=r?`length=${s}`:`type=${typeof t}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return t}function hc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Sb(t,e){ye(t,void 0,"digestInto() output");const n=e.outputLen;if(t.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function Qo(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function _o(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const Ih=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Bb=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function no(t){if(ye(t),Ih)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=Bb[t[n]];return e}const $t={_0:48,_9:57,A:65,F:70,a:97,f:102};function fc(t){if(t>=$t._0&&t<=$t._9)return t-$t._0;if(t>=$t.A&&t<=$t.F)return t-($t.A-10);if(t>=$t.a&&t<=$t.f)return t-($t.a-10)}function Di(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Ih)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let s=0,o=0;s<n;s++,o+=2){const i=fc(t.charCodeAt(o)),a=fc(t.charCodeAt(o+1));if(i===void 0||a===void 0){const c=t[o]+t[o+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+o)}r[s]=i*16+a}return r}function dc(...t){let e=0;for(let r=0;r<t.length;r++){const s=t[r];ye(s),e+=s.length}const n=new Uint8Array(e);for(let r=0,s=0;r<t.length;r++){const o=t[r];n.set(o,s),s+=o.length}return n}function Ab(t,e={}){const n=(s,o)=>t(o).update(s).digest(),r=t(void 0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=s=>t(s),Object.assign(n,e),Object.freeze(n)}function Ib(t=32){const e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof(e==null?void 0:e.getRandomValues)!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(t))}const $b=t=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,t])});let Cb=class{constructor(e,n,r,s){w(this,"blockLen");w(this,"outputLen");w(this,"padOffset");w(this,"isLE");w(this,"buffer");w(this,"view");w(this,"finished",!1);w(this,"length",0);w(this,"pos",0);w(this,"destroyed",!1);this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=s,this.buffer=new Uint8Array(e),this.view=_o(this.buffer)}update(e){hc(this),ye(e);const{view:n,buffer:r,blockLen:s}=this,o=e.length;for(let i=0;i<o;){const a=Math.min(s-this.pos,o-i);if(a===s){const c=_o(e);for(;s<=o-i;i+=s)this.process(c,i);continue}r.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){hc(this),Sb(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:s,isLE:o}=this;let{pos:i}=this;n[i++]=128,Qo(this.buffer.subarray(i)),this.padOffset>s-i&&(this.process(r,0),i=0);for(let u=i;u<s;u++)n[u]=0;r.setBigUint64(s-8,BigInt(this.length*8),o),this.process(r,0);const a=_o(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,f[u],o)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:s,finished:o,destroyed:i,pos:a}=this;return e.destroyed=i,e.finished=o,e.length=s,e.pos=a,s%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}};const Ae=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Kr=BigInt(2**32-1),pc=BigInt(32);function _b(t,e=!1){return e?{h:Number(t&Kr),l:Number(t>>pc&Kr)}:{h:Number(t>>pc&Kr)|0,l:Number(t&Kr)|0}}function Ob(t,e=!1){const n=t.length;let r=new Uint32Array(n),s=new Uint32Array(n);for(let o=0;o<n;o++){const{h:i,l:a}=_b(t[o],e);[r[o],s[o]]=[i,a]}return[r,s]}const gc=(t,e,n)=>t>>>n,mc=(t,e,n)=>t<<32-n|e>>>n,Un=(t,e,n)=>t>>>n|e<<32-n,Nn=(t,e,n)=>t<<32-n|e>>>n,Yr=(t,e,n)=>t<<64-n|e>>>n-32,Zr=(t,e,n)=>t>>>n-32|e<<64-n;function Ct(t,e,n,r){const s=(e>>>0)+(r>>>0);return{h:t+n+(s/2**32|0)|0,l:s|0}}const Tb=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),Lb=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,Rb=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),Pb=(t,e,n,r,s)=>e+n+r+s+(t/2**32|0)|0,Mb=(t,e,n,r,s)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(s>>>0),Hb=(t,e,n,r,s,o)=>e+n+r+s+o+(t/2**32|0)|0,$h=Ob(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Db=$h[0],Ub=$h[1],Wt=new Uint32Array(80),Kt=new Uint32Array(80);let Nb=class extends Cb{constructor(e){super(128,e,16,!1)}get(){const{Ah:e,Al:n,Bh:r,Bl:s,Ch:o,Cl:i,Dh:a,Dl:c,Eh:l,El:f,Fh:u,Fl:d,Gh:h,Gl:g,Hh:p,Hl:m}=this;return[e,n,r,s,o,i,a,c,l,f,u,d,h,g,p,m]}set(e,n,r,s,o,i,a,c,l,f,u,d,h,g,p,m){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=s|0,this.Ch=o|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=f|0,this.Fh=u|0,this.Fl=d|0,this.Gh=h|0,this.Gl=g|0,this.Hh=p|0,this.Hl=m|0}process(e,n){for(let v=0;v<16;v++,n+=4)Wt[v]=e.getUint32(n),Kt[v]=e.getUint32(n+=4);for(let v=16;v<80;v++){const x=Wt[v-15]|0,k=Kt[v-15]|0,$=Un(x,k,1)^Un(x,k,8)^gc(x,k,7),A=Nn(x,k,1)^Nn(x,k,8)^mc(x,k,7),S=Wt[v-2]|0,E=Kt[v-2]|0,B=Un(S,E,19)^Yr(S,E,61)^gc(S,E,6),I=Nn(S,E,19)^Zr(S,E,61)^mc(S,E,6),C=Rb(A,I,Kt[v-7],Kt[v-16]),T=Pb(C,$,B,Wt[v-7],Wt[v-16]);Wt[v]=T|0,Kt[v]=C|0}let{Ah:r,Al:s,Bh:o,Bl:i,Ch:a,Cl:c,Dh:l,Dl:f,Eh:u,El:d,Fh:h,Fl:g,Gh:p,Gl:m,Hh:b,Hl:y}=this;for(let v=0;v<80;v++){const x=Un(u,d,14)^Un(u,d,18)^Yr(u,d,41),k=Nn(u,d,14)^Nn(u,d,18)^Zr(u,d,41),$=u&h^~u&p,A=d&g^~d&m,S=Mb(y,k,A,Ub[v],Kt[v]),E=Hb(S,b,x,$,Db[v],Wt[v]),B=S|0,I=Un(r,s,28)^Yr(r,s,34)^Yr(r,s,39),C=Nn(r,s,28)^Zr(r,s,34)^Zr(r,s,39),T=r&o^r&a^o&a,D=s&i^s&c^i&c;b=p|0,y=m|0,p=h|0,m=g|0,h=u|0,g=d|0,{h:u,l:d}=Ct(l|0,f|0,E|0,B|0),l=a|0,f=c|0,a=o|0,c=i|0,o=r|0,i=s|0;const P=Tb(B,C,D);r=Lb(P,E,I,T),s=P|0}({h:r,l:s}=Ct(this.Ah|0,this.Al|0,r|0,s|0)),{h:o,l:i}=Ct(this.Bh|0,this.Bl|0,o|0,i|0),{h:a,l:c}=Ct(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:f}=Ct(this.Dh|0,this.Dl|0,l|0,f|0),{h:u,l:d}=Ct(this.Eh|0,this.El|0,u|0,d|0),{h,l:g}=Ct(this.Fh|0,this.Fl|0,h|0,g|0),{h:p,l:m}=Ct(this.Gh|0,this.Gl|0,p|0,m|0),{h:b,l:y}=Ct(this.Hh|0,this.Hl|0,b|0,y|0),this.set(r,s,o,i,a,c,l,f,u,d,h,g,p,m,b,y)}roundClean(){Qo(Wt,Kt)}destroy(){Qo(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},zb=class extends Nb{constructor(){super(64);w(this,"Ah",Ae[0]|0);w(this,"Al",Ae[1]|0);w(this,"Bh",Ae[2]|0);w(this,"Bl",Ae[3]|0);w(this,"Ch",Ae[4]|0);w(this,"Cl",Ae[5]|0);w(this,"Dh",Ae[6]|0);w(this,"Dl",Ae[7]|0);w(this,"Eh",Ae[8]|0);w(this,"El",Ae[9]|0);w(this,"Fh",Ae[10]|0);w(this,"Fl",Ae[11]|0);w(this,"Gh",Ae[12]|0);w(this,"Gl",Ae[13]|0);w(this,"Hh",Ae[14]|0);w(this,"Hl",Ae[15]|0)}};const Fb=Ab(()=>new zb,$b(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ch=BigInt(0),yc=BigInt(1);function ei(t,e=""){if(typeof t!="boolean"){const n=e&&`"${e}" `;throw new Error(n+"expected boolean, got type="+typeof t)}return t}function Vb(t){if(typeof t=="bigint"){if(!ds(t))throw new Error("positive bigint expected, got "+t)}else Hi(t);return t}function _h(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ch:BigInt("0x"+t)}function jb(t){return _h(no(t))}function Ht(t){return _h(no(ti(ye(t)).reverse()))}function Oh(t,e){Hi(e),t=Vb(t);const n=Di(t.toString(16).padStart(e*2,"0"));if(n.length!==e)throw new Error("number too large");return n}function Dt(t,e){return Oh(t,e).reverse()}function Gb(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}function ti(t){return Uint8Array.from(t)}const ds=t=>typeof t=="bigint"&&Ch<=t;function qb(t,e,n){return ds(t)&&ds(e)&&ds(n)&&e<=t&&t<n}function ni(t,e,n,r){if(!qb(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}const Th=t=>(yc<<BigInt(t))-yc;function Ui(t,e={},n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(o,i,a){const c=t[o];if(a&&c===void 0)return;const l=typeof c;if(l!==i||c===null)throw new Error(`param "${o}" is invalid: expected ${i}, got ${l}`)}const s=(o,i)=>Object.entries(o).forEach(([a,c])=>r(a,c,i));s(e,!1),s(n,!0)}const bc=()=>{throw new Error("not implemented")};function vc(t){const e=new WeakMap;return(n,...r)=>{const s=e.get(n);if(s!==void 0)return s;const o=t(n,...r);return e.set(n,o),o}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const He=BigInt(0),Te=BigInt(1),$n=BigInt(2),Lh=BigInt(3),Rh=BigInt(4),Ph=BigInt(5),Wb=BigInt(7),Mh=BigInt(8),Kb=BigInt(9),Hh=BigInt(16);function ae(t,e){const n=t%e;return n>=He?n:e+n}function dt(t,e,n){let r=t;for(;e-- >He;)r*=r,r%=n;return r}function wc(t,e){if(t===He)throw new Error("invert: expected non-zero number");if(e<=He)throw new Error("invert: expected positive modulus, got "+e);let n=ae(t,e),r=e,s=He,o=Te;for(;n!==He;){const a=r/n,c=r%n,l=s-o*a;r=n,n=c,s=o,o=l}if(r!==Te)throw new Error("invert: does not exist");return ae(s,e)}function Ni(t,e,n){if(!t.eql(t.sqr(e),n))throw new Error("Cannot find square root")}function Dh(t,e){const n=(t.ORDER+Te)/Rh,r=t.pow(e,n);return Ni(t,r,e),r}function Yb(t,e){const n=(t.ORDER-Ph)/Mh,r=t.mul(e,$n),s=t.pow(r,n),o=t.mul(e,s),i=t.mul(t.mul(o,$n),s),a=t.mul(o,t.sub(i,t.ONE));return Ni(t,a,e),a}function Zb(t){const e=zi(t),n=Uh(t),r=n(e,e.neg(e.ONE)),s=n(e,r),o=n(e,e.neg(r)),i=(t+Wb)/Hh;return(a,c)=>{let l=a.pow(c,i),f=a.mul(l,r);const u=a.mul(l,s),d=a.mul(l,o),h=a.eql(a.sqr(f),c),g=a.eql(a.sqr(u),c);l=a.cmov(l,f,h),f=a.cmov(d,u,g);const p=a.eql(a.sqr(f),c),m=a.cmov(l,f,p);return Ni(a,m,c),m}}function Uh(t){if(t<Lh)throw new Error("sqrt is not defined for small field");let e=t-Te,n=0;for(;e%$n===He;)e/=$n,n++;let r=$n;const s=zi(t);for(;xc(s,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Dh;let o=s.pow(r,e);const i=(e+Te)/$n;return function(c,l){if(c.is0(l))return l;if(xc(c,l)!==1)throw new Error("Cannot find square root");let f=n,u=c.mul(c.ONE,o),d=c.pow(l,e),h=c.pow(l,i);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let g=1,p=c.sqr(d);for(;!c.eql(p,c.ONE);)if(g++,p=c.sqr(p),g===f)throw new Error("Cannot find square root");const m=Te<<BigInt(f-g-1),b=c.pow(u,m);f=g,u=c.sqr(b),d=c.mul(d,u),h=c.mul(h,b)}return h}}function Xb(t){return t%Rh===Lh?Dh:t%Mh===Ph?Yb:t%Hh===Kb?Zb(t):Uh(t)}const kn=(t,e)=>(ae(t,e)&Te)===Te,Jb=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Qb(t){const e={ORDER:"bigint",BYTES:"number",BITS:"number"},n=Jb.reduce((r,s)=>(r[s]="function",r),e);return Ui(t,n),t}function e1(t,e,n){if(n<He)throw new Error("invalid exponent, negatives unsupported");if(n===He)return t.ONE;if(n===Te)return e;let r=t.ONE,s=e;for(;n>He;)n&Te&&(r=t.mul(r,s)),s=t.sqr(s),n>>=Te;return r}function Nh(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),s=e.reduce((i,a,c)=>t.is0(a)?i:(r[c]=i,t.mul(i,a)),t.ONE),o=t.inv(s);return e.reduceRight((i,a,c)=>t.is0(a)?i:(r[c]=t.mul(i,r[c]),t.mul(i,a)),o),r}function xc(t,e){const n=(t.ORDER-Te)/$n,r=t.pow(e,n),s=t.eql(r,t.ONE),o=t.eql(r,t.ZERO),i=t.eql(r,t.neg(t.ONE));if(!s&&!o&&!i)throw new Error("invalid Legendre symbol result");return s?1:o?0:-1}function t1(t,e){e!==void 0&&Hi(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}class n1{constructor(e,n={}){w(this,"ORDER");w(this,"BITS");w(this,"BYTES");w(this,"isLE");w(this,"ZERO",He);w(this,"ONE",Te);w(this,"_lengths");w(this,"_sqrt");w(this,"_mod");var i;if(e<=He)throw new Error("invalid field: expected ORDER > 0, got "+e);let r;this.isLE=!1,n!=null&&typeof n=="object"&&(typeof n.BITS=="number"&&(r=n.BITS),typeof n.sqrt=="function"&&(this.sqrt=n.sqrt),typeof n.isLE=="boolean"&&(this.isLE=n.isLE),n.allowedLengths&&(this._lengths=(i=n.allowedLengths)==null?void 0:i.slice()),typeof n.modFromBytes=="boolean"&&(this._mod=n.modFromBytes));const{nBitLength:s,nByteLength:o}=t1(e,r);if(o>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=e,this.BITS=s,this.BYTES=o,this._sqrt=void 0,Object.preventExtensions(this)}create(e){return ae(e,this.ORDER)}isValid(e){if(typeof e!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof e);return He<=e&&e<this.ORDER}is0(e){return e===He}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}isOdd(e){return(e&Te)===Te}neg(e){return ae(-e,this.ORDER)}eql(e,n){return e===n}sqr(e){return ae(e*e,this.ORDER)}add(e,n){return ae(e+n,this.ORDER)}sub(e,n){return ae(e-n,this.ORDER)}mul(e,n){return ae(e*n,this.ORDER)}pow(e,n){return e1(this,e,n)}div(e,n){return ae(e*wc(n,this.ORDER),this.ORDER)}sqrN(e){return e*e}addN(e,n){return e+n}subN(e,n){return e-n}mulN(e,n){return e*n}inv(e){return wc(e,this.ORDER)}sqrt(e){return this._sqrt||(this._sqrt=Xb(this.ORDER)),this._sqrt(this,e)}toBytes(e){return this.isLE?Dt(e,this.BYTES):Oh(e,this.BYTES)}fromBytes(e,n=!1){ye(e);const{_lengths:r,BYTES:s,isLE:o,ORDER:i,_mod:a}=this;if(r){if(!r.includes(e.length)||e.length>s)throw new Error("Field.fromBytes: expected "+r+" bytes, got "+e.length);const l=new Uint8Array(s);l.set(e,o?0:l.length-e.length),e=l}if(e.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+e.length);let c=o?Ht(e):jb(e);if(a&&(c=ae(c,i)),!n&&!this.isValid(c))throw new Error("invalid field element: outside of range 0..ORDER");return c}invertBatch(e){return Nh(this,e)}cmov(e,n,r){return r?n:e}}function zi(t,e={}){return new n1(t,e)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Os=BigInt(0),ri=BigInt(1);function Ec(t,e){const n=e.negate();return t?n:e}function Oo(t,e){const n=Nh(t.Fp,e.map(r=>r.Z));return e.map((r,s)=>t.fromAffine(r.toAffine(n[s])))}function zh(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function To(t,e){zh(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),s=2**t,o=Th(t),i=BigInt(t);return{windows:n,windowSize:r,mask:o,maxNumber:s,shiftBy:i}}function kc(t,e,n){const{windowSize:r,mask:s,maxNumber:o,shiftBy:i}=n;let a=Number(t&s),c=t>>i;a>r&&(a-=o,c+=ri);const l=e*r,f=l+Math.abs(a)-1,u=a===0,d=a<0,h=e%2!==0;return{nextN:c,offset:f,isZero:u,isNeg:d,isNegF:h,offsetF:l}}const Lo=new WeakMap,Fh=new WeakMap;function Ro(t){return Fh.get(t)||1}function Sc(t){if(t!==Os)throw new Error("invalid wNAF")}class r1{constructor(e,n){w(this,"BASE");w(this,"ZERO");w(this,"Fn");w(this,"bits");this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=n}_unsafeLadder(e,n,r=this.ZERO){let s=e;for(;n>Os;)n&ri&&(r=r.add(s)),s=s.double(),n>>=ri;return r}precomputeWindow(e,n){const{windows:r,windowSize:s}=To(n,this.bits),o=[];let i=e,a=i;for(let c=0;c<r;c++){a=i,o.push(a);for(let l=1;l<s;l++)a=a.add(i),o.push(a);i=a.double()}return o}wNAF(e,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let s=this.ZERO,o=this.BASE;const i=To(e,this.bits);for(let a=0;a<i.windows;a++){const{nextN:c,offset:l,isZero:f,isNeg:u,isNegF:d,offsetF:h}=kc(r,a,i);r=c,f?o=o.add(Ec(d,n[h])):s=s.add(Ec(u,n[l]))}return Sc(r),{p:s,f:o}}wNAFUnsafe(e,n,r,s=this.ZERO){const o=To(e,this.bits);for(let i=0;i<o.windows&&r!==Os;i++){const{nextN:a,offset:c,isZero:l,isNeg:f}=kc(r,i,o);if(r=a,!l){const u=n[c];s=s.add(f?u.negate():u)}}return Sc(r),s}getPrecomputes(e,n,r){let s=Lo.get(n);return s||(s=this.precomputeWindow(n,e),e!==1&&(typeof r=="function"&&(s=r(s)),Lo.set(n,s))),s}cached(e,n,r){const s=Ro(e);return this.wNAF(s,this.getPrecomputes(s,e,r),n)}unsafe(e,n,r,s){const o=Ro(e);return o===1?this._unsafeLadder(e,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,e,r),n,s)}createCache(e,n){zh(n,this.bits),Fh.set(e,n),Lo.delete(e)}hasCache(e){return Ro(e)!==1}}function Bc(t,e,n){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Qb(e),e}else return zi(t,{isLE:n})}function s1(t,e,n={},r){if(r===void 0&&(r=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const c of["p","n","h"]){const l=e[c];if(!(typeof l=="bigint"&&l>Os))throw new Error(`CURVE.${c} must be positive bigint`)}const s=Bc(e.p,n.Fp,r),o=Bc(e.n,n.Fn,r),a=["Gx","Gy","a","d"];for(const c of a)if(!s.isValid(e[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:o}}function o1(t,e){return function(r){const s=t(r);return{secretKey:s,publicKey:e(s)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Yt=BigInt(0),me=BigInt(1),Po=BigInt(2),i1=BigInt(8);function a1(t,e,n,r){const s=t.sqr(n),o=t.sqr(r),i=t.add(t.mul(e.a,s),o),a=t.add(t.ONE,t.mul(e.d,t.mul(s,o)));return t.eql(i,a)}function c1(t,e={}){const n=s1("edwards",t,e,e.FpFnLE),{Fp:r,Fn:s}=n;let o=n.CURVE;const{h:i}=o;Ui(e,{},{uvRatio:"function"});const a=Po<<BigInt(s.BYTES*8)-me,c=b=>r.create(b),l=e.uvRatio||((b,y)=>{try{return{isValid:!0,value:r.sqrt(r.div(b,y))}}catch{return{isValid:!1,value:Yt}}});if(!a1(r,o,o.Gx,o.Gy))throw new Error("bad curve params: generator point");function f(b,y,v=!1){const x=v?me:Yt;return ni("coordinate "+b,y,x,a),y}function u(b){if(!(b instanceof g))throw new Error("EdwardsPoint expected")}const d=vc((b,y)=>{const{X:v,Y:x,Z:k}=b,$=b.is0();y==null&&(y=$?i1:r.inv(k));const A=c(v*y),S=c(x*y),E=r.mul(k,y);if($)return{x:Yt,y:me};if(E!==me)throw new Error("invZ was invalid");return{x:A,y:S}}),h=vc(b=>{const{a:y,d:v}=o;if(b.is0())throw new Error("bad point: ZERO");const{X:x,Y:k,Z:$,T:A}=b,S=c(x*x),E=c(k*k),B=c($*$),I=c(B*B),C=c(S*y),T=c(B*c(C+E)),D=c(I+c(v*c(S*E)));if(T!==D)throw new Error("bad point: equation left != right (1)");const P=c(x*k),F=c($*A);if(P!==F)throw new Error("bad point: equation left != right (2)");return!0}),m=class m{constructor(y,v,x,k){w(this,"X");w(this,"Y");w(this,"Z");w(this,"T");this.X=f("x",y),this.Y=f("y",v),this.Z=f("z",x,!0),this.T=f("t",k),Object.freeze(this)}static CURVE(){return o}static fromAffine(y){if(y instanceof m)throw new Error("extended point not allowed");const{x:v,y:x}=y||{};return f("x",v),f("y",x),new m(v,x,me,c(v*x))}static fromBytes(y,v=!1){const x=r.BYTES,{a:k,d:$}=o;y=ti(ye(y,x,"point")),ei(v,"zip215");const A=ti(y),S=y[x-1];A[x-1]=S&-129;const E=Ht(A),B=v?a:r.ORDER;ni("point.y",E,Yt,B);const I=c(E*E),C=c(I-me),T=c($*I-k);let{isValid:D,value:P}=l(C,T);if(!D)throw new Error("bad point: invalid y coordinate");const F=(P&me)===me,G=(S&128)!==0;if(!v&&P===Yt&&G)throw new Error("bad point: x=0 and x_0=1");return G!==F&&(P=c(-P)),m.fromAffine({x:P,y:E})}static fromHex(y,v=!1){return m.fromBytes(Di(y),v)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,v=!0){return p.createCache(this,y),v||this.multiply(Po),this}assertValidity(){h(this)}equals(y){u(y);const{X:v,Y:x,Z:k}=this,{X:$,Y:A,Z:S}=y,E=c(v*S),B=c($*k),I=c(x*S),C=c(A*k);return E===B&&I===C}is0(){return this.equals(m.ZERO)}negate(){return new m(c(-this.X),this.Y,this.Z,c(-this.T))}double(){const{a:y}=o,{X:v,Y:x,Z:k}=this,$=c(v*v),A=c(x*x),S=c(Po*c(k*k)),E=c(y*$),B=v+x,I=c(c(B*B)-$-A),C=E+A,T=C-S,D=E-A,P=c(I*T),F=c(C*D),G=c(I*D),W=c(T*C);return new m(P,F,W,G)}add(y){u(y);const{a:v,d:x}=o,{X:k,Y:$,Z:A,T:S}=this,{X:E,Y:B,Z:I,T:C}=y,T=c(k*E),D=c($*B),P=c(S*x*C),F=c(A*I),G=c((k+$)*(E+B)-T-D),W=F-P,te=F+P,Ye=c(D-v*T),ht=c(G*W),Mn=c(te*Ye),cr=c(G*Ye),lr=c(W*te);return new m(ht,Mn,lr,cr)}subtract(y){return this.add(y.negate())}multiply(y){if(!s.isValidNot0(y))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:v,f:x}=p.cached(this,y,k=>Oo(m,k));return Oo(m,[v,x])[0]}multiplyUnsafe(y,v=m.ZERO){if(!s.isValid(y))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return y===Yt?m.ZERO:this.is0()||y===me?this:p.unsafe(this,y,x=>Oo(m,x),v)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return p.unsafe(this,o.n).is0()}toAffine(y){return d(this,y)}clearCofactor(){return i===me?this:this.multiplyUnsafe(i)}toBytes(){const{x:y,y:v}=this.toAffine(),x=r.toBytes(v);return x[x.length-1]|=y&me?128:0,x}toHex(){return no(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}};w(m,"BASE",new m(o.Gx,o.Gy,me,c(o.Gx*o.Gy))),w(m,"ZERO",new m(Yt,me,me,Yt)),w(m,"Fp",r),w(m,"Fn",s);let g=m;const p=new r1(g,s.BITS);return g.BASE.precompute(8),g}class xr{constructor(e){w(this,"ep");this.ep=e}static fromBytes(e){bc()}static fromHex(e){bc()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(e){return this.ep.toAffine(e)}toHex(){return no(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(e){return this.assertSame(e),this.init(this.ep.add(e.ep))}subtract(e){return this.assertSame(e),this.init(this.ep.subtract(e.ep))}multiply(e){return this.init(this.ep.multiply(e))}multiplyUnsafe(e){return this.init(this.ep.multiplyUnsafe(e))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(e,n){return this.init(this.ep.precompute(e,n))}}w(xr,"BASE"),w(xr,"ZERO"),w(xr,"Fp"),w(xr,"Fn");function l1(t,e,n={}){if(typeof e!="function")throw new Error('"hash" function param is required');Ui(n,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:r}=n,{BASE:s,Fp:o,Fn:i}=t,a=n.randomBytes||Ib,c=n.adjustScalarBytes||(S=>S),l=n.domain||((S,E,B)=>{if(ei(B,"phflag"),E.length||B)throw new Error("Contexts/pre-hash are not supported");return S});function f(S){return i.create(Ht(S))}function u(S){const E=v.secretKey;ye(S,v.secretKey,"secretKey");const B=ye(e(S),2*E,"hashedSecretKey"),I=c(B.slice(0,E)),C=B.slice(E,2*E),T=f(I);return{head:I,prefix:C,scalar:T}}function d(S){const{head:E,prefix:B,scalar:I}=u(S),C=s.multiply(I),T=C.toBytes();return{head:E,prefix:B,scalar:I,point:C,pointBytes:T}}function h(S){return d(S).pointBytes}function g(S=Uint8Array.of(),...E){const B=dc(...E);return f(e(l(B,ye(S,void 0,"context"),!!r)))}function p(S,E,B={}){S=ye(S,void 0,"message"),r&&(S=r(S));const{prefix:I,scalar:C,pointBytes:T}=d(E),D=g(B.context,I,S),P=s.multiply(D).toBytes(),F=g(B.context,P,T,S),G=i.create(D+F*C);if(!i.isValid(G))throw new Error("sign failed: invalid s");const W=dc(P,i.toBytes(G));return ye(W,v.signature,"result")}const m={zip215:!0};function b(S,E,B,I=m){const{context:C,zip215:T}=I,D=v.signature;S=ye(S,D,"signature"),E=ye(E,void 0,"message"),B=ye(B,v.publicKey,"publicKey"),T!==void 0&&ei(T,"zip215"),r&&(E=r(E));const P=D/2,F=S.subarray(0,P),G=Ht(S.subarray(P,D));let W,te,Ye;try{W=t.fromBytes(B,T),te=t.fromBytes(F,T),Ye=s.multiplyUnsafe(G)}catch{return!1}if(!T&&W.isSmallOrder())return!1;const ht=g(C,te.toBytes(),W.toBytes(),E);return te.add(W.multiplyUnsafe(ht)).subtract(Ye).clearCofactor().is0()}const y=o.BYTES,v={secretKey:y,publicKey:y,signature:2*y,seed:y};function x(S=a(v.seed)){return ye(S,v.seed,"seed")}function k(S){return to(S)&&S.length===i.BYTES}function $(S,E){try{return!!t.fromBytes(S,E)}catch{return!1}}const A={getExtendedPublicKey:d,randomSecretKey:x,isValidSecretKey:k,isValidPublicKey:$,toMontgomery(S){const{y:E}=t.fromBytes(S),B=v.publicKey,I=B===32;if(!I&&B!==57)throw new Error("only defined for 25519 and 448");const C=I?o.div(me+E,me-E):o.div(E-me,E+me);return o.toBytes(C)},toMontgomerySecret(S){const E=v.secretKey;ye(S,E);const B=e(S.subarray(0,E));return c(B).subarray(0,E)}};return Object.freeze({keygen:o1(x,h),getPublicKey:h,sign:p,verify:b,utils:A,Point:t,lengths:v})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u1=BigInt(0),kr=BigInt(1),Ac=BigInt(2),h1=BigInt(5),f1=BigInt(8),Cr=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Vh={p:Cr,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:f1,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function d1(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),s=BigInt(80),o=Cr,a=t*t%o*t%o,c=dt(a,Ac,o)*a%o,l=dt(c,kr,o)*t%o,f=dt(l,h1,o)*l%o,u=dt(f,e,o)*f%o,d=dt(u,n,o)*u%o,h=dt(d,r,o)*d%o,g=dt(h,s,o)*h%o,p=dt(g,s,o)*h%o,m=dt(p,e,o)*f%o;return{pow_p_5_8:dt(m,Ac,o)*t%o,b2:a}}function p1(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const si=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function jh(t,e){const n=Cr,r=ae(e*e*e,n),s=ae(r*r*e,n),o=d1(t*s).pow_p_5_8;let i=ae(t*r*o,n);const a=ae(e*i*i,n),c=i,l=ae(i*si,n),f=a===t,u=a===ae(-t,n),d=a===ae(-t*si,n);return f&&(i=c),(u||d)&&(i=l),kn(i,n)&&(i=ae(-i,n)),{isValid:f||u,value:i}}const Cn=c1(Vh,{uvRatio:jh}),Sn=Cn.Fp,g1=Cn.Fn;function m1(t){return l1(Cn,Fb,Object.assign({adjustScalarBytes:p1},t))}const y1=m1({}),Ic=si,b1=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),$c=t=>jh(kr,t),v1=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),w1=t=>Sn.create(Ht(t)&v1),Me=class Me extends xr{constructor(e){super(e)}static fromAffine(e){return new Me(Cn.fromAffine(e))}assertSame(e){if(!(e instanceof Me))throw new Error("RistrettoPoint expected")}init(e){return new Me(e)}static fromBytes(e){ye(e,32);const{a:n,d:r}=Vh,s=Cr,o=x=>Sn.create(x),i=w1(e);if(!Gb(Sn.toBytes(i),e)||kn(i,s))throw new Error("invalid ristretto255 encoding 1");const a=o(i*i),c=o(kr+n*a),l=o(kr-n*a),f=o(c*c),u=o(l*l),d=o(n*r*f-u),{isValid:h,value:g}=$c(o(d*u)),p=o(g*l),m=o(g*p*d);let b=o((i+i)*p);kn(b,s)&&(b=o(-b));const y=o(c*m),v=o(b*y);if(!h||kn(v,s)||y===u1)throw new Error("invalid ristretto255 encoding 2");return new Me(new Cn(b,y,kr,v))}static fromHex(e){return Me.fromBytes(Di(e))}toBytes(){let{X:e,Y:n,Z:r,T:s}=this.ep;const o=Cr,i=m=>Sn.create(m),a=i(i(r+n)*i(r-n)),c=i(e*n),l=i(c*c),{value:f}=$c(i(a*l)),u=i(f*a),d=i(f*c),h=i(u*d*s);let g;if(kn(s*h,o)){let m=i(n*Ic),b=i(e*Ic);e=m,n=b,g=i(u*b1)}else g=d;kn(e*h,o)&&(n=i(-n));let p=i((r-n)*g);return kn(p,o)&&(p=i(-p)),Sn.toBytes(p)}equals(e){this.assertSame(e);const{X:n,Y:r}=this.ep,{X:s,Y:o}=e.ep,i=l=>Sn.create(l),a=i(n*o)===i(r*s),c=i(r*o)===i(n*s);return a||c}is0(){return this.equals(Me.ZERO)}};w(Me,"BASE",new Me(Cn.BASE)),w(Me,"ZERO",new Me(Cn.ZERO)),w(Me,"Fp",Sn),w(Me,"Fn",g1);let oi=Me;const x1={Point:oi},E1=BigInt(0),mr=BigInt(1),k1=BigInt(2),S1=BigInt(7),B1=BigInt(256),A1=BigInt(113),Gh=[],qh=[],Wh=[];for(let t=0,e=mr,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],Gh.push(2*(5*r+n)),qh.push((t+1)*(t+2)/2%64);let s=E1;for(let o=0;o<7;o++)e=(e<<mr^(e>>S1)*A1)%B1,e&k1&&(s^=mr<<(mr<<BigInt(o))-mr);Wh.push(s)}const Kh=Bh(Wh,!0),I1=Kh[0],$1=Kh[1],Cc=(t,e,n)=>n>32?hb(t,e,n):lb(t,e,n),_c=(t,e,n)=>n>32?fb(t,e,n):ub(t,e,n);function C1(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let i=0;i<10;i++)n[i]=t[i]^t[i+10]^t[i+20]^t[i+30]^t[i+40];for(let i=0;i<10;i+=2){const a=(i+8)%10,c=(i+2)%10,l=n[c],f=n[c+1],u=Cc(l,f,1)^n[a],d=_c(l,f,1)^n[a+1];for(let h=0;h<50;h+=10)t[i+h]^=u,t[i+h+1]^=d}let s=t[2],o=t[3];for(let i=0;i<24;i++){const a=qh[i],c=Cc(s,o,a),l=_c(s,o,a),f=Gh[i];s=t[f],o=t[f+1],t[f]=c,t[f+1]=l}for(let i=0;i<50;i+=10){for(let a=0;a<10;a++)n[a]=t[i+a];for(let a=0;a<10;a++)t[i+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=I1[r],t[1]^=$1[r]}Cs(n)}const _1=BigInt(0),Yh=BigInt(3),cn=x1.Point;function Mo(t){if(typeof t=="string")return Mi(t);if(to(t))return t;throw new Error("Wrong data")}function Qe(t,e,...n){if(!to(e))throw new Error(`${t}: Uint8Array expected`);if(n.length&&!n.includes(e.length))throw new Error(`${t}: Uint8Array expected of length ${n}, not of length=${e.length}`)}function Ts(t,e){if(!Number.isSafeInteger(e)||e<0||e>4294967295)throw new Error(`${t}: wrong u32 integer: ${e}`);return e}function Ls(...t){for(const e of t)e.fill(0)}const Oc=Uint8Array.of(),Zh=y1.Point.Fn.ORDER,Rs=t=>ae(t,Zh),yr=166,ot={I:1,A:2,C:4,T:8,M:16,K:32};class Fi{constructor(e){w(this,"state",new Uint8Array(200));w(this,"state32");w(this,"pos",0);w(this,"posBegin",0);w(this,"curFlags",0);this.state.set([1,yr+2,1,0,1,96],0),this.state.set(Mi("STROBEv1.0.2"),6),this.state32=nb(this.state),this.keccakF1600(),this.metaAD(e,!1)}keccakF1600(){C1(this.state32)}runF(){this.state[this.pos]^=this.posBegin,this.state[this.pos+1]^=4,this.state[yr+1]^=128,this.keccakF1600(),this.pos=0,this.posBegin=0}absorb(e){for(let n=0;n<e.length;n++)this.state[this.pos++]^=e[n],this.pos===yr&&this.runF()}squeeze(e){const n=new Uint8Array(e);for(let r=0;r<n.length;r++)n[r]=this.state[this.pos],this.state[this.pos++]=0,this.pos===yr&&this.runF();return n}overwrite(e){for(let n=0;n<e.length;n++)this.state[this.pos++]=e[n],this.pos===yr&&this.runF()}beginOp(e,n){if(n){if(this.curFlags!==e)throw new Error(`Continued op with changed flags from ${this.curFlags.toString(2)} to ${e.toString(2)}`);return}if(e&ot.T)throw new Error("T flag is not supported");const r=this.posBegin;this.posBegin=this.pos+1,this.curFlags=e,this.absorb(new Uint8Array([r,e])),(e&(ot.C|ot.K))!==0&&this.pos!==0&&this.runF()}metaAD(e,n){this.beginOp(ot.M|ot.A,n),this.absorb(Mo(e))}AD(e,n){this.beginOp(ot.A,n),this.absorb(Mo(e))}PRF(e,n){return this.beginOp(ot.I|ot.A|ot.C,n),this.squeeze(e)}KEY(e,n){this.beginOp(ot.A|ot.C,n),this.overwrite(Mo(e))}clone(){const e=new Fi("0");return e.pos=this.pos,e.posBegin=this.posBegin,e.state.set(this.state),e.curFlags=this.curFlags,e}clean(){this.state.fill(0),this.pos=0,this.curFlags=0,this.posBegin=0}}class O1{constructor(e){w(this,"strobe");this.strobe=new Fi("Merlin v1.0"),this.appendMessage("dom-sep",e)}appendMessage(e,n){this.strobe.metaAD(e,!1),Ts("Merlin.appendMessage",n.length),this.strobe.metaAD(Dt(n.length,4),!0),this.strobe.AD(n,!1)}challengeBytes(e,n){return this.strobe.metaAD(e,!1),Ts("Merlin.challengeBytes",n),this.strobe.metaAD(Dt(n,4),!0),this.strobe.PRF(n,!1)}clean(){this.strobe.clean()}}class Ps extends O1{constructor(e){super(e)}label(e){this.appendMessage("",e)}bytes(e){return this.appendMessage("sign-bytes",e),this}protoName(e){this.appendMessage("proto-name",e)}commitPoint(e,n){this.appendMessage(e,n.toBytes())}challengeScalar(e){return Rs(Ht(this.challengeBytes(e,64)))}witnessScalar(e,n,r=[]){return Rs(Ht(this.witnessBytes(e,64,n,r)))}witnessBytes(e,n,r,s=[]){Ts("SigningContext.witnessBytes",n);const o=this.strobe.clone();for(const i of s)o.metaAD(e,!1),Ts("SigningContext.witnessBytes nonce length",i.length),o.metaAD(Dt(i.length,4),!0),o.KEY(i,!1);return Qe("random",r,32),o.metaAD("rng",!1),o.KEY(r,!1),o.metaAD(Dt(n,4),!1),o.PRF(n,!1)}}const T1=Th(256),Xh=t=>Dt(t<<Yh&T1,32),_r=t=>Ht(t)>>Yh;function ro(t){Qe("secretKey",t,64);const e=_r(t.subarray(0,32));return cn.BASE.multiply(e).toBytes()}function Jh(t){Qe("seed",t,32);const e=kb(t);e[0]&=248,e[31]&=63,e[31]|=64;const n=Xh(_r(e.subarray(0,32))),r=e.subarray(32,64),s=_s(n,r);return Ls(n,r,e),s}const Qh=Mi("substrate");function L1(t,e,n=Sh(32)){Qe("message",e),Qe("secretKey",t,64);const r=new Ps("SigningContext");r.label(Qh),r.bytes(e);const s=_r(t.subarray(0,32)),o=t.subarray(32,64),i=cn.fromBytes(ro(t));r.protoName("Schnorr-sig"),r.commitPoint("sign:pk",i);const a=r.witnessScalar("signing",n,[o]),c=cn.BASE.multiply(a);r.commitPoint("sign:R",c);const l=r.challengeScalar("sign:c"),f=Rs(l*s+a),u=_s(c.toBytes(),Dt(f,32));return u[63]|=128,r.clean(),u}function R1(t,e,n){if(Qe("message",t),Qe("signature",e,64),Qe("publicKey",n,32),!(e[63]&128))throw new Error("Schnorrkel marker missing");const r=Uint8Array.from(e.subarray(32,64));r[31]&=127;const s=cn.fromBytes(e.subarray(0,32)),o=Ht(r);ni("s",o,_1,Zh);const i=new Ps("SigningContext");i.label(Qh),i.bytes(t);const a=cn.fromBytes(n);if(a.equals(cn.ZERO))return!1;i.protoName("Schnorr-sig"),i.commitPoint("sign:pk",a),i.commitPoint("sign:R",s);const c=i.challengeScalar("sign:c"),l=cn.BASE.multiply(o),f=a.negate().multiply(c).add(l);return i.clean(),Ls(r),f.equals(s)}const Tc={secretSoft(t,e,n=Sh(32)){Qe("secretKey",t,64),Qe("chainCode",e,32);const r=_r(t.subarray(0,32)),s=t.subarray(32,64),o=cn.fromBytes(ro(t)),i=new Ps("SchnorrRistrettoHDKD");i.bytes(Oc),i.appendMessage("chain-code",e),i.commitPoint("public-key",o);const a=i.challengeScalar("HDKD-scalar"),c=i.challengeBytes("HDKD-chaincode",32),l=_s(Dt(r,32),s),f=i.witnessBytes("HDKD-nonce",32,n,[s,l]),u=Xh(Rs(r+a)),d=_s(u,f);return Ls(u,f,l,c),i.clean(),d},secretHard(t,e){Qe("secretKey",t,64),Qe("chainCode",e,32);const n=Dt(_r(t.subarray(0,32)),32),r=new Ps("SchnorrRistrettoHDKD");r.bytes(Oc),r.appendMessage("chain-code",e),r.appendMessage("secret-key",n);const s=r.challengeBytes("HDKD-hard",32),o=r.challengeBytes("HDKD-chaincode",32);r.clean();const i=Jh(s);return Ls(n,s,o),r.clean(),i}};var P1=t=>{const e=new Uint8Array(32);return e.set(Number.isNaN(+t)?K.enc(t):tt.enc(+t)),e},M1=/(\/{1,2})([^/]+)/g,H1=t=>{const e=[];for(const[n,r,s]of t.matchAll(M1))e.push([r==="//"?"hard":"soft",s]);return e},Bn=(t,e,n)=>{let r;if(typeof e=="string")try{e[1]==="x"&&(e=e.slice(2)),r=sb(e)}catch(o){throw new Error(`${t} must be hex string or Uint8Array, cause: ${o}`)}else if(kh(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const s=r.length;if(typeof n=="number"&&s!==n)throw new Error(`${t} of length ${n} expected, got ${s}`);return r};ee(32),ee(32);var D1=({seed:t,curve:e,derive:n})=>r=>n(Bn("seed",t,32),{getPublicKey:s=>e.getPublicKey(s),sign:(s,o)=>e.sign(s,o),verify:(s,o,i)=>e.verify(s,o,i)},H1(r).map(([s,o])=>[s,P1(o)])),U1={getPublicKey(t){return ro(Bn("privateKey",t,64))},sign(t,e){return L1(Bn("privateKey",e,64),Bn("message",t))},verify(t,e,n){return R1(Bn("message",e),Bn("signature",t,64),Bn("publicKey",n,32))}},N1=(t,e,n)=>{const r=n.reduce((o,[i,a])=>(i==="hard"?Tc.secretHard:Tc.secretSoft)(o,a),Jh(t));return{publicKey:ro(r),sign(o){return e.sign(o,r)}}},z1=t=>D1({seed:t,curve:U1,derive:N1});/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function F1(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Sr(t,e=""){if(!Number.isSafeInteger(t)||t<0){const n=e&&`"${e}" `;throw new Error(`${n}expected integer >= 0, got ${t}`)}}function Or(t,e,n=""){const r=F1(t),s=t==null?void 0:t.length,o=e!==void 0;if(!r||o&&s!==e){const i=n&&`"${n}" `,a=o?` of length ${e}`:"",c=r?`length=${s}`:`type=${typeof t}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return t}function ef(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash must wrapped by utils.createHasher");Sr(t.outputLen),Sr(t.blockLen)}function Ms(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function V1(t,e){Or(t,void 0,"digestInto() output");const n=e.outputLen;if(t.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function Rn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function ps(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function pt(t,e){return t<<32-e|t>>>e}function j1(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Lc(t,e=""){return typeof t=="string"?j1(t):Or(t,void 0,e)}function G1(t,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options must be object or undefined");return Object.assign(t,e)}function tf(t,e={}){const n=(s,o)=>t(o).update(s).digest(),r=t(void 0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=s=>t(s),Object.assign(n,e),Object.freeze(n)}const nf=t=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,t])});function q1(t,e,n){return t&e^~t&n}function W1(t,e,n){return t&e^t&n^e&n}class rf{constructor(e,n,r,s){w(this,"blockLen");w(this,"outputLen");w(this,"padOffset");w(this,"isLE");w(this,"buffer");w(this,"view");w(this,"finished",!1);w(this,"length",0);w(this,"pos",0);w(this,"destroyed",!1);this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=s,this.buffer=new Uint8Array(e),this.view=ps(this.buffer)}update(e){Ms(this),Or(e);const{view:n,buffer:r,blockLen:s}=this,o=e.length;for(let i=0;i<o;){const a=Math.min(s-this.pos,o-i);if(a===s){const c=ps(e);for(;s<=o-i;i+=s)this.process(c,i);continue}r.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ms(this),V1(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:s,isLE:o}=this;let{pos:i}=this;n[i++]=128,Rn(this.buffer.subarray(i)),this.padOffset>s-i&&(this.process(r,0),i=0);for(let u=i;u<s;u++)n[u]=0;r.setBigUint64(s-8,BigInt(this.length*8),o),this.process(r,0);const a=ps(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,f[u],o)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:s,finished:o,destroyed:i,pos:a}=this;return e.destroyed=i,e.finished=o,e.length=s,e.pos=a,s%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const Zt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ie=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Xr=BigInt(2**32-1),Rc=BigInt(32);function K1(t,e=!1){return e?{h:Number(t&Xr),l:Number(t>>Rc&Xr)}:{h:Number(t>>Rc&Xr)|0,l:Number(t&Xr)|0}}function Y1(t,e=!1){const n=t.length;let r=new Uint32Array(n),s=new Uint32Array(n);for(let o=0;o<n;o++){const{h:i,l:a}=K1(t[o],e);[r[o],s[o]]=[i,a]}return[r,s]}const Pc=(t,e,n)=>t>>>n,Mc=(t,e,n)=>t<<32-n|e>>>n,zn=(t,e,n)=>t>>>n|e<<32-n,Fn=(t,e,n)=>t<<32-n|e>>>n,Jr=(t,e,n)=>t<<64-n|e>>>n-32,Qr=(t,e,n)=>t>>>n-32|e<<64-n;function _t(t,e,n,r){const s=(e>>>0)+(r>>>0);return{h:t+n+(s/2**32|0)|0,l:s|0}}const Z1=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),X1=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,J1=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),Q1=(t,e,n,r,s)=>e+n+r+s+(t/2**32|0)|0,ev=(t,e,n,r,s)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(s>>>0),tv=(t,e,n,r,s,o)=>e+n+r+s+o+(t/2**32|0)|0,nv=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Xt=new Uint32Array(64);class rv extends rf{constructor(e){super(64,e,8,!1)}get(){const{A:e,B:n,C:r,D:s,E:o,F:i,G:a,H:c}=this;return[e,n,r,s,o,i,a,c]}set(e,n,r,s,o,i,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=i|0,this.G=a|0,this.H=c|0}process(e,n){for(let u=0;u<16;u++,n+=4)Xt[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){const d=Xt[u-15],h=Xt[u-2],g=pt(d,7)^pt(d,18)^d>>>3,p=pt(h,17)^pt(h,19)^h>>>10;Xt[u]=p+Xt[u-7]+g+Xt[u-16]|0}let{A:r,B:s,C:o,D:i,E:a,F:c,G:l,H:f}=this;for(let u=0;u<64;u++){const d=pt(a,6)^pt(a,11)^pt(a,25),h=f+d+q1(a,c,l)+nv[u]+Xt[u]|0,p=(pt(r,2)^pt(r,13)^pt(r,22))+W1(r,s,o)|0;f=l,l=c,c=a,a=i+h|0,i=o,o=s,s=r,r=h+p|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,s,o,i,a,c,l,f)}roundClean(){Rn(Xt)}destroy(){this.set(0,0,0,0,0,0,0,0),Rn(this.buffer)}}class sv extends rv{constructor(){super(32);w(this,"A",Zt[0]|0);w(this,"B",Zt[1]|0);w(this,"C",Zt[2]|0);w(this,"D",Zt[3]|0);w(this,"E",Zt[4]|0);w(this,"F",Zt[5]|0);w(this,"G",Zt[6]|0);w(this,"H",Zt[7]|0)}}const sf=Y1(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ov=sf[0],iv=sf[1],Jt=new Uint32Array(80),Qt=new Uint32Array(80);class av extends rf{constructor(e){super(128,e,16,!1)}get(){const{Ah:e,Al:n,Bh:r,Bl:s,Ch:o,Cl:i,Dh:a,Dl:c,Eh:l,El:f,Fh:u,Fl:d,Gh:h,Gl:g,Hh:p,Hl:m}=this;return[e,n,r,s,o,i,a,c,l,f,u,d,h,g,p,m]}set(e,n,r,s,o,i,a,c,l,f,u,d,h,g,p,m){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=s|0,this.Ch=o|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=f|0,this.Fh=u|0,this.Fl=d|0,this.Gh=h|0,this.Gl=g|0,this.Hh=p|0,this.Hl=m|0}process(e,n){for(let v=0;v<16;v++,n+=4)Jt[v]=e.getUint32(n),Qt[v]=e.getUint32(n+=4);for(let v=16;v<80;v++){const x=Jt[v-15]|0,k=Qt[v-15]|0,$=zn(x,k,1)^zn(x,k,8)^Pc(x,k,7),A=Fn(x,k,1)^Fn(x,k,8)^Mc(x,k,7),S=Jt[v-2]|0,E=Qt[v-2]|0,B=zn(S,E,19)^Jr(S,E,61)^Pc(S,E,6),I=Fn(S,E,19)^Qr(S,E,61)^Mc(S,E,6),C=J1(A,I,Qt[v-7],Qt[v-16]),T=Q1(C,$,B,Jt[v-7],Jt[v-16]);Jt[v]=T|0,Qt[v]=C|0}let{Ah:r,Al:s,Bh:o,Bl:i,Ch:a,Cl:c,Dh:l,Dl:f,Eh:u,El:d,Fh:h,Fl:g,Gh:p,Gl:m,Hh:b,Hl:y}=this;for(let v=0;v<80;v++){const x=zn(u,d,14)^zn(u,d,18)^Jr(u,d,41),k=Fn(u,d,14)^Fn(u,d,18)^Qr(u,d,41),$=u&h^~u&p,A=d&g^~d&m,S=ev(y,k,A,iv[v],Qt[v]),E=tv(S,b,x,$,ov[v],Jt[v]),B=S|0,I=zn(r,s,28)^Jr(r,s,34)^Jr(r,s,39),C=Fn(r,s,28)^Qr(r,s,34)^Qr(r,s,39),T=r&o^r&a^o&a,D=s&i^s&c^i&c;b=p|0,y=m|0,p=h|0,m=g|0,h=u|0,g=d|0,{h:u,l:d}=_t(l|0,f|0,E|0,B|0),l=a|0,f=c|0,a=o|0,c=i|0,o=r|0,i=s|0;const P=Z1(B,C,D);r=X1(P,E,I,T),s=P|0}({h:r,l:s}=_t(this.Ah|0,this.Al|0,r|0,s|0)),{h:o,l:i}=_t(this.Bh|0,this.Bl|0,o|0,i|0),{h:a,l:c}=_t(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:f}=_t(this.Dh|0,this.Dl|0,l|0,f|0),{h:u,l:d}=_t(this.Eh|0,this.El|0,u|0,d|0),{h,l:g}=_t(this.Fh|0,this.Fl|0,h|0,g|0),{h:p,l:m}=_t(this.Gh|0,this.Gl|0,p|0,m|0),{h:b,l:y}=_t(this.Hh|0,this.Hl|0,b|0,y|0),this.set(r,s,o,i,a,c,l,f,u,d,h,g,p,m,b,y)}roundClean(){Rn(Jt,Qt)}destroy(){Rn(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class cv extends av{constructor(){super(64);w(this,"Ah",Ie[0]|0);w(this,"Al",Ie[1]|0);w(this,"Bh",Ie[2]|0);w(this,"Bl",Ie[3]|0);w(this,"Ch",Ie[4]|0);w(this,"Cl",Ie[5]|0);w(this,"Dh",Ie[6]|0);w(this,"Dl",Ie[7]|0);w(this,"Eh",Ie[8]|0);w(this,"El",Ie[9]|0);w(this,"Fh",Ie[10]|0);w(this,"Fl",Ie[11]|0);w(this,"Gh",Ie[12]|0);w(this,"Gl",Ie[13]|0);w(this,"Hh",Ie[14]|0);w(this,"Hl",Ie[15]|0)}}const lv=tf(()=>new sv,nf(1)),uv=tf(()=>new cv,nf(3));class of{constructor(e,n){w(this,"oHash");w(this,"iHash");w(this,"blockLen");w(this,"outputLen");w(this,"finished",!1);w(this,"destroyed",!1);if(ef(e),Or(n,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(n.length>r?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Rn(s)}update(e){return Ms(this),this.iHash.update(e),this}digestInto(e){Ms(this),Or(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:s,destroyed:o,blockLen:i,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=i,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const af=(t,e,n)=>new of(t,e).update(n).digest();af.create=(t,e)=>new of(t,e);function hv(t,e,n,r){ef(t);const s=G1({dkLen:32,asyncTick:10},r),{c:o,dkLen:i,asyncTick:a}=s;if(Sr(o,"c"),Sr(i,"dkLen"),Sr(a,"asyncTick"),o<1)throw new Error("iterations (c) must be >= 1");const c=Lc(e,"password"),l=Lc(n,"salt"),f=new Uint8Array(i),u=af.create(t,c),d=u._cloneInto().update(l);return{c:o,dkLen:i,asyncTick:a,DK:f,PRF:u,PRFSalt:d}}function fv(t,e,n,r,s){return t.destroy(),e.destroy(),r&&r.destroy(),Rn(s),n}function dv(t,e,n,r){const{c:s,dkLen:o,DK:i,PRF:a,PRFSalt:c}=hv(t,e,n,r);let l;const f=new Uint8Array(4),u=ps(f),d=new Uint8Array(a.outputLen);for(let h=1,g=0;g<o;h++,g+=a.outputLen){const p=i.subarray(g,g+a.outputLen);u.setInt32(0,h,!1),(l=c._cloneInto(l)).update(f).digestInto(d),p.set(d.subarray(0,p.length));for(let m=1;m<s;m++){a._cloneInto(l).update(d).digestInto(d);for(let b=0;b<p.length;b++)p[b]^=d[b]}}return fv(a,c,i,l,d)}var pv="abandon|ability|able|about|above|absent|absorb|abstract|absurd|abuse|access|accident|account|accuse|achieve|acid|acoustic|acquire|across|act|action|actor|actress|actual|adapt|add|addict|address|adjust|admit|adult|advance|advice|aerobic|affair|afford|afraid|again|age|agent|agree|ahead|aim|air|airport|aisle|alarm|album|alcohol|alert|alien|all|alley|allow|almost|alone|alpha|already|also|alter|always|amateur|amazing|among|amount|amused|analyst|anchor|ancient|anger|angle|angry|animal|ankle|announce|annual|another|answer|antenna|antique|anxiety|any|apart|apology|appear|apple|approve|april|arch|arctic|area|arena|argue|arm|armed|armor|army|around|arrange|arrest|arrive|arrow|art|artefact|artist|artwork|ask|aspect|assault|asset|assist|assume|asthma|athlete|atom|attack|attend|attitude|attract|auction|audit|august|aunt|author|auto|autumn|average|avocado|avoid|awake|aware|away|awesome|awful|awkward|axis|baby|bachelor|bacon|badge|bag|balance|balcony|ball|bamboo|banana|banner|bar|barely|bargain|barrel|base|basic|basket|battle|beach|bean|beauty|because|become|beef|before|begin|behave|behind|believe|below|belt|bench|benefit|best|betray|better|between|beyond|bicycle|bid|bike|bind|biology|bird|birth|bitter|black|blade|blame|blanket|blast|bleak|bless|blind|blood|blossom|blouse|blue|blur|blush|board|boat|body|boil|bomb|bone|bonus|book|boost|border|boring|borrow|boss|bottom|bounce|box|boy|bracket|brain|brand|brass|brave|bread|breeze|brick|bridge|brief|bright|bring|brisk|broccoli|broken|bronze|broom|brother|brown|brush|bubble|buddy|budget|buffalo|build|bulb|bulk|bullet|bundle|bunker|burden|burger|burst|bus|business|busy|butter|buyer|buzz|cabbage|cabin|cable|cactus|cage|cake|call|calm|camera|camp|can|canal|cancel|candy|cannon|canoe|canvas|canyon|capable|capital|captain|car|carbon|card|cargo|carpet|carry|cart|case|cash|casino|castle|casual|cat|catalog|catch|category|cattle|caught|cause|caution|cave|ceiling|celery|cement|census|century|cereal|certain|chair|chalk|champion|change|chaos|chapter|charge|chase|chat|cheap|check|cheese|chef|cherry|chest|chicken|chief|child|chimney|choice|choose|chronic|chuckle|chunk|churn|cigar|cinnamon|circle|citizen|city|civil|claim|clap|clarify|claw|clay|clean|clerk|clever|click|client|cliff|climb|clinic|clip|clock|clog|close|cloth|cloud|clown|club|clump|cluster|clutch|coach|coast|coconut|code|coffee|coil|coin|collect|color|column|combine|come|comfort|comic|common|company|concert|conduct|confirm|congress|connect|consider|control|convince|cook|cool|copper|copy|coral|core|corn|correct|cost|cotton|couch|country|couple|course|cousin|cover|coyote|crack|cradle|craft|cram|crane|crash|crater|crawl|crazy|cream|credit|creek|crew|cricket|crime|crisp|critic|crop|cross|crouch|crowd|crucial|cruel|cruise|crumble|crunch|crush|cry|crystal|cube|culture|cup|cupboard|curious|current|curtain|curve|cushion|custom|cute|cycle|dad|damage|damp|dance|danger|daring|dash|daughter|dawn|day|deal|debate|debris|decade|december|decide|decline|decorate|decrease|deer|defense|define|defy|degree|delay|deliver|demand|demise|denial|dentist|deny|depart|depend|deposit|depth|deputy|derive|describe|desert|design|desk|despair|destroy|detail|detect|develop|device|devote|diagram|dial|diamond|diary|dice|diesel|diet|differ|digital|dignity|dilemma|dinner|dinosaur|direct|dirt|disagree|discover|disease|dish|dismiss|disorder|display|distance|divert|divide|divorce|dizzy|doctor|document|dog|doll|dolphin|domain|donate|donkey|donor|door|dose|double|dove|draft|dragon|drama|drastic|draw|dream|dress|drift|drill|drink|drip|drive|drop|drum|dry|duck|dumb|dune|during|dust|dutch|duty|dwarf|dynamic|eager|eagle|early|earn|earth|easily|east|easy|echo|ecology|economy|edge|edit|educate|effort|egg|eight|either|elbow|elder|electric|elegant|element|elephant|elevator|elite|else|embark|embody|embrace|emerge|emotion|employ|empower|empty|enable|enact|end|endless|endorse|enemy|energy|enforce|engage|engine|enhance|enjoy|enlist|enough|enrich|enroll|ensure|enter|entire|entry|envelope|episode|equal|equip|era|erase|erode|erosion|error|erupt|escape|essay|essence|estate|eternal|ethics|evidence|evil|evoke|evolve|exact|example|excess|exchange|excite|exclude|excuse|execute|exercise|exhaust|exhibit|exile|exist|exit|exotic|expand|expect|expire|explain|expose|express|extend|extra|eye|eyebrow|fabric|face|faculty|fade|faint|faith|fall|false|fame|family|famous|fan|fancy|fantasy|farm|fashion|fat|fatal|father|fatigue|fault|favorite|feature|february|federal|fee|feed|feel|female|fence|festival|fetch|fever|few|fiber|fiction|field|figure|file|film|filter|final|find|fine|finger|finish|fire|firm|first|fiscal|fish|fit|fitness|fix|flag|flame|flash|flat|flavor|flee|flight|flip|float|flock|floor|flower|fluid|flush|fly|foam|focus|fog|foil|fold|follow|food|foot|force|forest|forget|fork|fortune|forum|forward|fossil|foster|found|fox|fragile|frame|frequent|fresh|friend|fringe|frog|front|frost|frown|frozen|fruit|fuel|fun|funny|furnace|fury|future|gadget|gain|galaxy|gallery|game|gap|garage|garbage|garden|garlic|garment|gas|gasp|gate|gather|gauge|gaze|general|genius|genre|gentle|genuine|gesture|ghost|giant|gift|giggle|ginger|giraffe|girl|give|glad|glance|glare|glass|glide|glimpse|globe|gloom|glory|glove|glow|glue|goat|goddess|gold|good|goose|gorilla|gospel|gossip|govern|gown|grab|grace|grain|grant|grape|grass|gravity|great|green|grid|grief|grit|grocery|group|grow|grunt|guard|guess|guide|guilt|guitar|gun|gym|habit|hair|half|hammer|hamster|hand|happy|harbor|hard|harsh|harvest|hat|have|hawk|hazard|head|health|heart|heavy|hedgehog|height|hello|helmet|help|hen|hero|hidden|high|hill|hint|hip|hire|history|hobby|hockey|hold|hole|holiday|hollow|home|honey|hood|hope|horn|horror|horse|hospital|host|hotel|hour|hover|hub|huge|human|humble|humor|hundred|hungry|hunt|hurdle|hurry|hurt|husband|hybrid|ice|icon|idea|identify|idle|ignore|ill|illegal|illness|image|imitate|immense|immune|impact|impose|improve|impulse|inch|include|income|increase|index|indicate|indoor|industry|infant|inflict|inform|inhale|inherit|initial|inject|injury|inmate|inner|innocent|input|inquiry|insane|insect|inside|inspire|install|intact|interest|into|invest|invite|involve|iron|island|isolate|issue|item|ivory|jacket|jaguar|jar|jazz|jealous|jeans|jelly|jewel|job|join|joke|journey|joy|judge|juice|jump|jungle|junior|junk|just|kangaroo|keen|keep|ketchup|key|kick|kid|kidney|kind|kingdom|kiss|kit|kitchen|kite|kitten|kiwi|knee|knife|knock|know|lab|label|labor|ladder|lady|lake|lamp|language|laptop|large|later|latin|laugh|laundry|lava|law|lawn|lawsuit|layer|lazy|leader|leaf|learn|leave|lecture|left|leg|legal|legend|leisure|lemon|lend|length|lens|leopard|lesson|letter|level|liar|liberty|library|license|life|lift|light|like|limb|limit|link|lion|liquid|list|little|live|lizard|load|loan|lobster|local|lock|logic|lonely|long|loop|lottery|loud|lounge|love|loyal|lucky|luggage|lumber|lunar|lunch|luxury|lyrics|machine|mad|magic|magnet|maid|mail|main|major|make|mammal|man|manage|mandate|mango|mansion|manual|maple|marble|march|margin|marine|market|marriage|mask|mass|master|match|material|math|matrix|matter|maximum|maze|meadow|mean|measure|meat|mechanic|medal|media|melody|melt|member|memory|mention|menu|mercy|merge|merit|merry|mesh|message|metal|method|middle|midnight|milk|million|mimic|mind|minimum|minor|minute|miracle|mirror|misery|miss|mistake|mix|mixed|mixture|mobile|model|modify|mom|moment|monitor|monkey|monster|month|moon|moral|more|morning|mosquito|mother|motion|motor|mountain|mouse|move|movie|much|muffin|mule|multiply|muscle|museum|mushroom|music|must|mutual|myself|mystery|myth|naive|name|napkin|narrow|nasty|nation|nature|near|neck|need|negative|neglect|neither|nephew|nerve|nest|net|network|neutral|never|news|next|nice|night|noble|noise|nominee|noodle|normal|north|nose|notable|note|nothing|notice|novel|now|nuclear|number|nurse|nut|oak|obey|object|oblige|obscure|observe|obtain|obvious|occur|ocean|october|odor|off|offer|office|often|oil|okay|old|olive|olympic|omit|once|one|onion|online|only|open|opera|opinion|oppose|option|orange|orbit|orchard|order|ordinary|organ|orient|original|orphan|ostrich|other|outdoor|outer|output|outside|oval|oven|over|own|owner|oxygen|oyster|ozone|pact|paddle|page|pair|palace|palm|panda|panel|panic|panther|paper|parade|parent|park|parrot|party|pass|patch|path|patient|patrol|pattern|pause|pave|payment|peace|peanut|pear|peasant|pelican|pen|penalty|pencil|people|pepper|perfect|permit|person|pet|phone|photo|phrase|physical|piano|picnic|picture|piece|pig|pigeon|pill|pilot|pink|pioneer|pipe|pistol|pitch|pizza|place|planet|plastic|plate|play|please|pledge|pluck|plug|plunge|poem|poet|point|polar|pole|police|pond|pony|pool|popular|portion|position|possible|post|potato|pottery|poverty|powder|power|practice|praise|predict|prefer|prepare|present|pretty|prevent|price|pride|primary|print|priority|prison|private|prize|problem|process|produce|profit|program|project|promote|proof|property|prosper|protect|proud|provide|public|pudding|pull|pulp|pulse|pumpkin|punch|pupil|puppy|purchase|purity|purpose|purse|push|put|puzzle|pyramid|quality|quantum|quarter|question|quick|quit|quiz|quote|rabbit|raccoon|race|rack|radar|radio|rail|rain|raise|rally|ramp|ranch|random|range|rapid|rare|rate|rather|raven|raw|razor|ready|real|reason|rebel|rebuild|recall|receive|recipe|record|recycle|reduce|reflect|reform|refuse|region|regret|regular|reject|relax|release|relief|rely|remain|remember|remind|remove|render|renew|rent|reopen|repair|repeat|replace|report|require|rescue|resemble|resist|resource|response|result|retire|retreat|return|reunion|reveal|review|reward|rhythm|rib|ribbon|rice|rich|ride|ridge|rifle|right|rigid|ring|riot|ripple|risk|ritual|rival|river|road|roast|robot|robust|rocket|romance|roof|rookie|room|rose|rotate|rough|round|route|royal|rubber|rude|rug|rule|run|runway|rural|sad|saddle|sadness|safe|sail|salad|salmon|salon|salt|salute|same|sample|sand|satisfy|satoshi|sauce|sausage|save|say|scale|scan|scare|scatter|scene|scheme|school|science|scissors|scorpion|scout|scrap|screen|script|scrub|sea|search|season|seat|second|secret|section|security|seed|seek|segment|select|sell|seminar|senior|sense|sentence|series|service|session|settle|setup|seven|shadow|shaft|shallow|share|shed|shell|sheriff|shield|shift|shine|ship|shiver|shock|shoe|shoot|shop|short|shoulder|shove|shrimp|shrug|shuffle|shy|sibling|sick|side|siege|sight|sign|silent|silk|silly|silver|similar|simple|since|sing|siren|sister|situate|six|size|skate|sketch|ski|skill|skin|skirt|skull|slab|slam|sleep|slender|slice|slide|slight|slim|slogan|slot|slow|slush|small|smart|smile|smoke|smooth|snack|snake|snap|sniff|snow|soap|soccer|social|sock|soda|soft|solar|soldier|solid|solution|solve|someone|song|soon|sorry|sort|soul|sound|soup|source|south|space|spare|spatial|spawn|speak|special|speed|spell|spend|sphere|spice|spider|spike|spin|spirit|split|spoil|sponsor|spoon|sport|spot|spray|spread|spring|spy|square|squeeze|squirrel|stable|stadium|staff|stage|stairs|stamp|stand|start|state|stay|steak|steel|stem|step|stereo|stick|still|sting|stock|stomach|stone|stool|story|stove|strategy|street|strike|strong|struggle|student|stuff|stumble|style|subject|submit|subway|success|such|sudden|suffer|sugar|suggest|suit|summer|sun|sunny|sunset|super|supply|supreme|sure|surface|surge|surprise|surround|survey|suspect|sustain|swallow|swamp|swap|swarm|swear|sweet|swift|swim|swing|switch|sword|symbol|symptom|syrup|system|table|tackle|tag|tail|talent|talk|tank|tape|target|task|taste|tattoo|taxi|teach|team|tell|ten|tenant|tennis|tent|term|test|text|thank|that|theme|then|theory|there|they|thing|this|thought|three|thrive|throw|thumb|thunder|ticket|tide|tiger|tilt|timber|time|tiny|tip|tired|tissue|title|toast|tobacco|today|toddler|toe|together|toilet|token|tomato|tomorrow|tone|tongue|tonight|tool|tooth|top|topic|topple|torch|tornado|tortoise|toss|total|tourist|toward|tower|town|toy|track|trade|traffic|tragic|train|transfer|trap|trash|travel|tray|treat|tree|trend|trial|tribe|trick|trigger|trim|trip|trophy|trouble|truck|true|truly|trumpet|trust|truth|try|tube|tuition|tumble|tuna|tunnel|turkey|turn|turtle|twelve|twenty|twice|twin|twist|two|type|typical|ugly|umbrella|unable|unaware|uncle|uncover|under|undo|unfair|unfold|unhappy|uniform|unique|unit|universe|unknown|unlock|until|unusual|unveil|update|upgrade|uphold|upon|upper|upset|urban|urge|usage|use|used|useful|useless|usual|utility|vacant|vacuum|vague|valid|valley|valve|van|vanish|vapor|various|vast|vault|vehicle|velvet|vendor|venture|venue|verb|verify|version|very|vessel|veteran|viable|vibrant|vicious|victory|video|view|village|vintage|violin|virtual|virus|visa|visit|visual|vital|vivid|vocal|voice|void|volcano|volume|vote|voyage|wage|wagon|wait|walk|wall|walnut|want|warfare|warm|warrior|wash|wasp|waste|water|wave|way|wealth|weapon|wear|weasel|weather|web|wedding|weekend|weird|welcome|west|wet|whale|what|wheat|wheel|when|where|whip|whisper|wide|width|wife|wild|will|win|window|wine|wing|wink|winner|winter|wire|wisdom|wise|wish|witness|wolf|woman|wonder|wood|wool|word|work|world|worry|worth|wrap|wreck|wrestle|wrist|write|wrong|yard|year|yellow|you|young|youth|zebra|zero|zone|zoo",Hc="Invalid mnemonic",gv="Invalid entropy",mv="Invalid mnemonic checksum",yv="Invalid wordlist",bv=t=>{const e=t.split("|");if(e.length!==2048)throw new Error(yv);return e},vv=t=>lv(t)[0].toString(2).padStart(8,"0").slice(0,t.length/4),wv=(t,e=pv)=>{var c;const n=t.normalize("NFKD").split(" ");if(n.length%3!==0||n.length<12||n.length>24)throw new Error(Hc);const r=bv(e),s=n.map(l=>{const f=r.indexOf(l);if(f===-1)throw new Error(Hc);return f.toString(2).padStart(11,"0")}).join(""),o=s.length-n.length/3,i=(c=s.slice(0,o).match(/(.{1,8})/g))==null?void 0:c.map(l=>Number.parseInt(l,2));if(!i||i.length<16||i.length>32||i.length%4!==0)throw new Error(gv);const a=Uint8Array.from(i);if(vv(a)!==s.slice(o))throw new Error(mv);return a},xv="bottom drive obey lake curtain smoke basket hold race lonely fit walk";ee(32),ee(32);var Ev=t=>new TextEncoder().encode(`mnemonic${t.normalize("NFKD")}`),kv=(t,e="")=>dv(uv,t,Ev(e),{c:2048,dkLen:64}).slice(0,32);const Sv=kv(wv(xv)),cf=z1(Sv),es=cf("//Alice"),ts=cf("//Bob"),lf={signer:Ti(es.publicKey,"Sr25519",es.sign),address:gn().dec(es.publicKey),publicKey:es.publicKey},uf={signer:Ti(ts.publicKey,"Sr25519",ts.sign),address:gn().dec(ts.publicKey),publicKey:ts.publicKey};function ns(){const t=new URLSearchParams(window.location.search);return t.get("devMode")==="true"||t.has("player")}function Bv(){return new URLSearchParams(window.location.search).get("player")==="bob"?"bob":"alice"}function hf(t){return t==="alice"?lf:uf}function Av(t){return t==="alice"?uf:lf}function Iv(t){return Av(t).address}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function $v(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ii(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Vi(t,...e){if(!$v(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Dc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Cv(t,e){Vi(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Hs(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ai(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const ff=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function df(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Lt=ff?t=>t:t=>df(t);function _v(t){for(let e=0;e<t.length;e++)t[e]=df(t[e]);return t}const Vn=ff?t=>t:_v;function Ov(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Br(t){return typeof t=="string"&&(t=Ov(t)),Vi(t),t}class Tv{}function Lv(t){const e=(r,s)=>t(s).update(Br(r)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}const Rv=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),rs=BigInt(2**32-1),Uc=BigInt(32);function Pv(t,e=!1){return e?{h:Number(t&rs),l:Number(t>>Uc&rs)}:{h:Number(t>>Uc&rs)|0,l:Number(t&rs)|0}}const pf=(t,e,n)=>t>>>n|e<<32-n,gf=(t,e,n)=>t<<32-n|e>>>n,Mv=(t,e,n)=>t<<64-n|e>>>n-32,Hv=(t,e,n)=>t>>>n-32|e<<64-n,Dv=(t,e)=>e,Uv=(t,e)=>t;function mf(t,e,n,r){const s=(e>>>0)+(r>>>0);return{h:t+n+(s/2**32|0)|0,l:s|0}}const yf=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),bf=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,de=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),R=new Uint32Array(32);function en(t,e,n,r,s,o){const i=s[o],a=s[o+1];let c=R[2*t],l=R[2*t+1],f=R[2*e],u=R[2*e+1],d=R[2*n],h=R[2*n+1],g=R[2*r],p=R[2*r+1],m=yf(c,f,i);l=bf(m,l,u,a),c=m|0,{Dh:p,Dl:g}={Dh:p^l,Dl:g^c},{Dh:p,Dl:g}={Dh:Dv(p,g),Dl:Uv(p)},{h,l:d}=mf(h,d,p,g),{Bh:u,Bl:f}={Bh:u^h,Bl:f^d},{Bh:u,Bl:f}={Bh:pf(u,f,24),Bl:gf(u,f,24)},R[2*t]=c,R[2*t+1]=l,R[2*e]=f,R[2*e+1]=u,R[2*n]=d,R[2*n+1]=h,R[2*r]=g,R[2*r+1]=p}function tn(t,e,n,r,s,o){const i=s[o],a=s[o+1];let c=R[2*t],l=R[2*t+1],f=R[2*e],u=R[2*e+1],d=R[2*n],h=R[2*n+1],g=R[2*r],p=R[2*r+1],m=yf(c,f,i);l=bf(m,l,u,a),c=m|0,{Dh:p,Dl:g}={Dh:p^l,Dl:g^c},{Dh:p,Dl:g}={Dh:pf(p,g,16),Dl:gf(p,g,16)},{h,l:d}=mf(h,d,p,g),{Bh:u,Bl:f}={Bh:u^h,Bl:f^d},{Bh:u,Bl:f}={Bh:Mv(u,f,63),Bl:Hv(u,f,63)},R[2*t]=c,R[2*t+1]=l,R[2*e]=f,R[2*e+1]=u,R[2*n]=d,R[2*n+1]=h,R[2*r]=g,R[2*r+1]=p}function Nv(t,e={},n,r,s){if(ii(n),t<0||t>n)throw new Error("outputLen bigger than keyLen");const{key:o,salt:i,personalization:a}=e;if(o!==void 0&&(o.length<1||o.length>n))throw new Error("key length must be undefined or 1.."+n);if(i!==void 0&&i.length!==r)throw new Error("salt must be undefined or "+r);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class zv extends Tv{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,ii(e),ii(n),this.blockLen=e,this.outputLen=n,this.buffer=new Uint8Array(e),this.buffer32=Hs(this.buffer)}update(e){Dc(this),e=Br(e),Vi(e);const{blockLen:n,buffer:r,buffer32:s}=this,o=e.length,i=e.byteOffset,a=e.buffer;for(let c=0;c<o;){this.pos===n&&(Vn(s),this.compress(s,0,!1),Vn(s),this.pos=0);const l=Math.min(n-this.pos,o-c),f=i+c;if(l===n&&!(f%4)&&c+l<o){const u=new Uint32Array(a,f,Math.floor((o-c)/4));Vn(u);for(let d=0;c+n<o;d+=s.length,c+=n)this.length+=n,this.compress(u,d,!1);Vn(u);continue}r.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Dc(this),Cv(e,this);const{pos:n,buffer32:r}=this;this.finished=!0,ai(this.buffer.subarray(n)),Vn(r),this.compress(r,0,!0),Vn(r);const s=Hs(e);this.get().forEach((o,i)=>s[i]=Lt(o))}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){const{buffer:n,length:r,finished:s,destroyed:o,outputLen:i,pos:a}=this;return e||(e=new this.constructor({dkLen:i})),e.set(...this.get()),e.buffer.set(n),e.destroyed=o,e.finished=s,e.length=r,e.pos=a,e.outputLen=i,e}clone(){return this._cloneInto()}}class Fv extends zv{constructor(e={}){const n=e.dkLen===void 0?64:e.dkLen;super(128,n),this.v0l=de[0]|0,this.v0h=de[1]|0,this.v1l=de[2]|0,this.v1h=de[3]|0,this.v2l=de[4]|0,this.v2h=de[5]|0,this.v3l=de[6]|0,this.v3h=de[7]|0,this.v4l=de[8]|0,this.v4h=de[9]|0,this.v5l=de[10]|0,this.v5h=de[11]|0,this.v6l=de[12]|0,this.v6h=de[13]|0,this.v7l=de[14]|0,this.v7h=de[15]|0,Nv(n,e,64,16,16);let{key:r,personalization:s,salt:o}=e,i=0;if(r!==void 0&&(r=Br(r),i=r.length),this.v0l^=this.outputLen|i<<8|65536|1<<24,o!==void 0){o=Br(o);const a=Hs(o);this.v4l^=Lt(a[0]),this.v4h^=Lt(a[1]),this.v5l^=Lt(a[2]),this.v5h^=Lt(a[3])}if(s!==void 0){s=Br(s);const a=Hs(s);this.v6l^=Lt(a[0]),this.v6h^=Lt(a[1]),this.v7l^=Lt(a[2]),this.v7h^=Lt(a[3])}if(r!==void 0){const a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:e,v0h:n,v1l:r,v1h:s,v2l:o,v2h:i,v3l:a,v3h:c,v4l:l,v4h:f,v5l:u,v5h:d,v6l:h,v6h:g,v7l:p,v7h:m}=this;return[e,n,r,s,o,i,a,c,l,f,u,d,h,g,p,m]}set(e,n,r,s,o,i,a,c,l,f,u,d,h,g,p,m){this.v0l=e|0,this.v0h=n|0,this.v1l=r|0,this.v1h=s|0,this.v2l=o|0,this.v2h=i|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=f|0,this.v5l=u|0,this.v5h=d|0,this.v6l=h|0,this.v6h=g|0,this.v7l=p|0,this.v7h=m|0}compress(e,n,r){this.get().forEach((c,l)=>R[l]=c),R.set(de,16);let{h:s,l:o}=Pv(BigInt(this.length));R[24]=de[8]^o,R[25]=de[9]^s,r&&(R[28]=~R[28],R[29]=~R[29]);let i=0;const a=Rv;for(let c=0;c<12;c++)en(0,4,8,12,e,n+2*a[i++]),tn(0,4,8,12,e,n+2*a[i++]),en(1,5,9,13,e,n+2*a[i++]),tn(1,5,9,13,e,n+2*a[i++]),en(2,6,10,14,e,n+2*a[i++]),tn(2,6,10,14,e,n+2*a[i++]),en(3,7,11,15,e,n+2*a[i++]),tn(3,7,11,15,e,n+2*a[i++]),en(0,5,10,15,e,n+2*a[i++]),tn(0,5,10,15,e,n+2*a[i++]),en(1,6,11,12,e,n+2*a[i++]),tn(1,6,11,12,e,n+2*a[i++]),en(2,7,8,13,e,n+2*a[i++]),tn(2,7,8,13,e,n+2*a[i++]),en(3,4,9,14,e,n+2*a[i++]),tn(3,4,9,14,e,n+2*a[i++]);this.v0l^=R[0]^R[16],this.v0h^=R[1]^R[17],this.v1l^=R[2]^R[18],this.v1h^=R[3]^R[19],this.v2l^=R[4]^R[20],this.v2h^=R[5]^R[21],this.v3l^=R[6]^R[22],this.v3h^=R[7]^R[23],this.v4l^=R[8]^R[24],this.v4h^=R[9]^R[25],this.v5l^=R[10]^R[26],this.v5h^=R[11]^R[27],this.v6l^=R[12]^R[28],this.v6h^=R[13]^R[29],this.v7l^=R[14]^R[30],this.v7h^=R[15]^R[31],ai(R)}destroy(){this.destroyed=!0,ai(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Vv=Lv(t=>new Fv(t)),jv=Vv;function vf(t){const e=new Uint8Array(33);return e.set(t.salt,0),e[32]=t.isOccupied?1:0,e}function ji(t){return jv(t,{dkLen:32})}function ci(t,e){const n=new Uint8Array(64);return n.set(t,0),n.set(e,32),ji(n)}function wf(t){if(t.length!==100)throw new Error(`Expected 100 cells, got ${t.length}`);const n=t.map(o=>vf(o)).map(o=>ji(o)),r=[n];let s=n;for(;s.length>1;){const o=[];for(let i=0;i<s.length;i+=2){const a=s[i],c=i+1<s.length?s[i+1]:a;o.push(ci(a,c))}r.push(o),s=o}return{root:s[0],layers:r}}function xf(t,e){const n=[];let r=e;for(let s=0;s<t.layers.length-1;s++){const o=t.layers[s],i=r%2===0?r+1:r-1,a=i<o.length?o[i]:o[r];n.push(a),r=Math.floor(r/2)}return n}function Gv(t,e,n,r){let s=r,o=n;for(const i of e)o%2===0?s=ci(s,i):s=ci(i,s),o=Math.floor(o/2);return qv(s,t)}function qv(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Ef(){const t=new Uint8Array(32);return crypto.getRandomValues(t),t}function kf(t){const e=[];for(let n=0;n<100;n++)e.push({salt:Ef(),isOccupied:t.has(n)});return e}function li(t,e){return e*10+t}function Wv(t){return ji(vf(t))}const Kv=Object.freeze(Object.defineProperty({__proto__:null,buildMerkleTree:wf,coordToIndex:li,createChainCells:kf,generateProof:xf,generateSalt:Ef,getCellLeafHash:Wv,verifyProof:Gv},Symbol.toStringTag,{value:"Module"}));async function nn(t,e,n="tx"){const r=Date.now();console.log(`[${n}] Submitting transaction... (t=0ms)`);const s=t.signSubmitAndWatch(e,{mortality:{mortal:!0,period:256}}),o=await qe(s.pipe(ir(a=>console.log(`[${n}] Event: ${a.type}${a.found!==void 0?` found=${a.found}`:""}${a.block?` block=${a.block.number}`:""} (t=${Date.now()-r}ms)`)),vt(a=>a.type==="txBestBlocksState"&&a.found===!0))),i=o.block;return console.log(`[${n}] Included in best block #${i==null?void 0:i.number} (t=${Date.now()-r}ms)`),o}function Yv(t,e,n){return t.events.filter(r=>{var s;return r.type===e&&((s=r.value)==null?void 0:s.type)===n}).map(r=>r.value.value)}class Gi{constructor(e){w(this,"api");this.api=e}static async create(e){const n=e.getUnsafeApi();return new Gi(n)}async createGame(e,n){try{const r=this.api.tx.Battleship.create_game({pot_amount:n}),s=await nn(r,e,"create_game");if(!s.ok)return console.error("create_game failed:",s.dispatchError),{ok:!1};console.log("create_game events:",s.events);const o=Yv(s,"Battleship","GameCreated");return console.log("GameCreated events found:",o),o.length>0?{ok:!0,gameId:o[0].game_id}:{ok:!0}}catch(r){return console.error("create_game error:",r),{ok:!1}}}async joinGame(e,n){try{const r=this.api.tx.Battleship.join_game({game_id:n});return{ok:(await nn(r,e,"join_game")).ok}}catch(r){return console.error("join_game error:",r),{ok:!1}}}async commitGrid(e,n,r){try{const s=this.api.tx.Battleship.commit_grid({game_id:n,grid_root:Xe.fromBytes(r)});return{ok:(await nn(s,e,"commit_grid")).ok}}catch(s){return console.error("commit_grid error:",s),{ok:!1}}}async attack(e,n,r,s){try{const o=this.api.tx.Battleship.attack({game_id:n,coordinate:{x:r,y:s}});return{ok:(await nn(o,e,"attack")).ok}}catch(o){return console.error("attack error:",o),{ok:!1}}}async revealCell(e,n,r,s){try{console.log("reveal_cell params:",{gameId:n,cell:{salt:Array.from(r.salt).slice(0,8),isOccupied:r.isOccupied},proofLength:s.length});const o=this.api.tx.Battleship.reveal_cell({game_id:n,reveal:{cell:{salt:Xe.fromBytes(r.salt),is_occupied:r.isOccupied},proof:s.map(a=>Xe.fromBytes(a))}}),i=await nn(o,e,"reveal_cell");return i.ok||console.error("reveal_cell dispatch error:",i.dispatchError),{ok:i.ok}}catch(o){return console.error("reveal_cell error:",o),{ok:!1}}}async revealWinnerGrid(e,n,r){try{const s=this.api.tx.Battleship.reveal_winner_grid({game_id:n,full_grid:r.map(i=>({salt:Xe.fromBytes(i.salt),is_occupied:i.isOccupied}))});return{ok:(await nn(s,e,"reveal_winner_grid")).ok}}catch(s){return console.error("reveal_winner_grid error:",s),{ok:!1}}}async surrender(e,n){try{const r=this.api.tx.Battleship.surrender({game_id:n}),s=await nn(r,e,"surrender");return s.ok||console.error("surrender dispatch error:",JSON.stringify(s.dispatchError,null,2)),{ok:s.ok}}catch(r){return console.error("surrender error:",r),{ok:!1}}}async claimTimeoutWin(e,n){try{const r=this.api.tx.Battleship.claim_timeout_win({game_id:n});return{ok:(await nn(r,e,"claim_timeout_win")).ok}}catch(r){return console.error("claim_timeout_win error:",r),{ok:!1}}}async getGame(e){try{return await this.api.query.Battleship.Games.getValue(e,{at:"best"})}catch(n){return console.error("getGame error:",n),null}}async getPlayerData(e,n){try{return await this.api.query.Battleship.PlayerDataStorage.getValue(e,n,{at:"best"})}catch(r){return console.error("getPlayerData error:",r),null}}async getPlayerGame(e){try{return await this.api.query.Battleship.PlayerGame.getValue(e,{at:"best"})}catch(n){return console.error("getPlayerGame error:",n),null}}async findWaitingGames(){try{const e=await this.api.query.Battleship.Games.getEntries({at:"best"}),n=[];for(const r of e){const s=r.value;s&&s.phase&&s.phase.type==="WaitingForOpponent"&&n.push(r.keyArgs[0])}return n}catch(e){return console.error("findWaitingGames error:",e),[]}}subscribeToEvents(e,n){return console.log("Event subscription setup for game:",e,n),()=>{console.log("Event subscription cleanup for game:",e)}}}class Nc{constructor(e,n){w(this,"player");w(this,"account");w(this,"ourBoard");w(this,"opponentBoard");w(this,"gameId",null);w(this,"battleshipClient",null);w(this,"ourCells",[]);w(this,"merkleTree",null);w(this,"phase","menu");w(this,"isOurTurn",!1);w(this,"pendingAttack",null);w(this,"ourHits",0);w(this,"opponentHits",0);w(this,"winner",null);w(this,"message","");w(this,"onStateChangeCallback",null);w(this,"onMessageCallback",null);w(this,"onGameEndCallback",null);w(this,"pollInterval",null);w(this,"lastLoggedPhase",null);w(this,"lastOpponentDataHash","");w(this,"currentShipIndex",0);w(this,"placementOrientation","horizontal");w(this,"isAttacking",!1);w(this,"isRevealing",!1);w(this,"isPolling",!1);w(this,"isClaimingTimeout",!1);this.player=e,this.account=n??hf(e),this.ourBoard=new Yi,this.opponentBoard=new Yi}async initialize(){const e=await $s();this.battleshipClient=await Gi.create(e),this.setMessage(`Connected as ${this.player.toUpperCase()}`)}getState(){return{phase:this.phase,gameId:this.gameId,player:this.player,isOurTurn:this.isOurTurn,pendingAttack:this.pendingAttack,message:this.message,ourHits:this.ourHits,opponentHits:this.opponentHits,winner:this.winner}}onStateChange(e){this.onStateChangeCallback=e}onMessageChange(e){this.onMessageCallback=e}onGameEnd(e){this.onGameEndCallback=e}notifyStateChange(){var e;(e=this.onStateChangeCallback)==null||e.call(this,this.getState())}setMessage(e){var n;this.message=e,(n=this.onMessageCallback)==null||n.call(this,e),this.notifyStateChange()}setPhase(e){this.phase=e,this.notifyStateChange()}getOurBoard(){return this.ourBoard}getOpponentBoard(){return this.opponentBoard}getCurrentShipIndex(){return this.currentShipIndex}getPlacementOrientation(){return this.placementOrientation}toggleOrientation(){this.placementOrientation=this.placementOrientation==="horizontal"?"vertical":"horizontal",this.notifyStateChange()}getCurrentShip(){const e=[{id:"carrier",name:"Carrier",size:5},{id:"battleship",name:"Battleship",size:4},{id:"cruiser",name:"Cruiser",size:3},{id:"submarine",name:"Submarine",size:3},{id:"destroyer",name:"Destroyer",size:2}];return this.currentShipIndex>=e.length?null:e[this.currentShipIndex]}canPlaceCurrentShip(e){const n=this.getCurrentShip();return n?this.ourBoard.canPlace(n,e,this.placementOrientation):!1}placeShip(e){const n=this.getCurrentShip();return n&&this.ourBoard.placeShip(n,e,this.placementOrientation)?(this.currentShipIndex++,this.notifyStateChange(),!0):!1}placeShipsRandomly(){this.ourBoard.placeShipsRandomly(),this.currentShipIndex=5,this.notifyStateChange()}canStartBattle(){return this.ourBoard.allShipsPlaced()}canAttack(){return this.phase==="battle"&&this.isOurTurn&&this.pendingAttack===null&&!this.isAttacking&&!this.isRevealing}async checkAndResumeGame(){if(!this.battleshipClient)return!1;this.setMessage("Checking for existing game...");const e=await this.battleshipClient.getPlayerGame(this.account.address);return console.log(`[${this.player}] getPlayerGame result:`,e,typeof e),e!=null?(this.gameId=e,this.setMessage(`Resuming game #${this.gameId}...`),await this.pollGameState(),this.startPolling(),!0):(console.log(`[${this.player}] No existing game found, will create new one`),!1)}async createGame(e){if(!this.battleshipClient)return!1;if(await this.checkAndResumeGame())return!0;this.setPhase("creating"),this.setMessage("Creating game..."),console.log(`[${this.player}] Creating new game with pot ${e}...`);const n=await this.battleshipClient.createGame(this.account.signer,e);if(console.log(`[${this.player}] Create game result:`,n),n.ok){if(n.gameId!==void 0)this.gameId=n.gameId;else{console.log(`[${this.player}] GameId not in events, querying...`);const r=await this.battleshipClient.getPlayerGame(this.account.address);r!=null&&(this.gameId=r,console.log(`[${this.player}] Found gameId from query:`,this.gameId))}if(this.gameId!==null)return this.setPhase("waiting_opponent"),this.setMessage(`Game #${this.gameId} created. Waiting for opponent...`),this.startPolling(),!0}return this.setPhase("menu"),this.setMessage("Failed to create game - check console for details"),!1}async joinGame(){if(!this.battleshipClient)return!1;if(await this.checkAndResumeGame())return!0;this.setMessage("Looking for games...");const e=await this.battleshipClient.findWaitingGames();if(e.length===0)return this.setMessage("No games available to join"),!1;const n=e[0];return this.setMessage(`Joining game #${n}...`),(await this.battleshipClient.joinGame(this.account.signer,n)).ok?(this.gameId=n,this.setPhase("setup"),this.setMessage("Joined! Place your ships."),this.startPolling(),!0):(this.setMessage("Failed to join game"),!1)}async joinExistingGame(e){return this.battleshipClient?await this.checkAndResumeGame()?!0:(this.setMessage(`Joining game #${e}...`),(await this.battleshipClient.joinGame(this.account.signer,e)).ok?(this.gameId=e,this.setPhase("setup"),this.setMessage("Joined! Place your ships."),this.startPolling(),!0):(this.setMessage("Failed to join game"),!1)):!1}async commitGrid(){if(!this.battleshipClient||this.gameId===null||!this.ourBoard.allShipsPlaced())return!1;this.setMessage("Committing grid...");const e=new Set;for(const r of this.ourBoard.getShips()){const s=_n(r);for(const o of s)e.add(li(o.x,o.y))}return this.ourCells=kf(e),this.merkleTree=wf(this.ourCells),console.log(`[${this.player}] Merkle root:`,Array.from(this.merkleTree.root).map(r=>r.toString(16).padStart(2,"0")).join("")),console.log(`[${this.player}] Occupied indices:`,Array.from(e)),(await this.battleshipClient.commitGrid(this.account.signer,this.gameId,this.merkleTree.root)).ok?(this.setPhase("waiting_commit"),this.setMessage("Grid committed. Waiting for opponent..."),await this.pollGameState(),!0):(this.setMessage("Failed to commit grid"),!1)}async attack(e){if(!this.battleshipClient||this.gameId===null||!this.isOurTurn||this.pendingAttack!==null||this.isAttacking)return!1;this.isAttacking=!0,console.log(`[${this.player}] Attacking ${String.fromCharCode(65+e.x)}${e.y+1}...`),this.setMessage(`Attacking ${String.fromCharCode(65+e.x)}${e.y+1}...`);try{const n=await this.battleshipClient.attack(this.account.signer,this.gameId,e.x,e.y);return console.log(`[${this.player}] Attack result:`,n),n.ok?(this.pendingAttack=e,this.setMessage("Attack sent. Waiting for opponent to reveal..."),this.notifyStateChange(),!0):(this.setMessage("Attack failed"),!1)}finally{this.isAttacking=!1}}async handlePendingAttack(e){if(!this.battleshipClient||this.gameId===null||this.isRevealing)return;if(!this.merkleTree){console.error(`[${this.player}] Cannot reveal - no merkle tree! Did you resume a game without placing ships?`),this.setMessage("ERROR: Cannot reveal - local state lost. Please surrender.");return}this.isRevealing=!0;const n=li(e.x,e.y),r=this.ourCells[n],s=xf(this.merkleTree,n);console.log(`[${this.player}] Revealing cell ${String.fromCharCode(65+e.x)}${e.y+1} (index ${n})...`),console.log(`[${this.player}] Cell:`,{isOccupied:r.isOccupied,saltPrefix:Array.from(r.salt.slice(0,4))}),console.log(`[${this.player}] Proof length:`,s.length);const{verifyProof:o,getCellLeafHash:i}=await Rf(async()=>{const{verifyProof:l,getCellLeafHash:f}=await Promise.resolve().then(()=>Kv);return{verifyProof:l,getCellLeafHash:f}},void 0),a=i(r),c=o(this.merkleTree.root,s,n,a);console.log(`[${this.player}] Local proof verification:`,c),this.setMessage(`Revealing cell ${String.fromCharCode(65+e.x)}${e.y+1}...`);try{const l=await this.battleshipClient.revealCell(this.account.signer,this.gameId,r,s);console.log(`[${this.player}] Reveal result:`,l),l.ok?(r.isOccupied&&this.ourBoard.receiveAttack(e),this.setMessage("Cell revealed.")):this.setMessage("Failed to reveal cell")}finally{this.isRevealing=!1,this.pendingAttack=null}}async surrender(){var n;if(!this.battleshipClient||this.gameId===null)return console.error(`[${this.player}] Cannot surrender - no client or gameId`),!1;console.log(`[${this.player}] Sending surrender for game #${this.gameId}...`),this.setMessage("Surrendering...");const e=await this.battleshipClient.surrender(this.account.signer,this.gameId);return console.log(`[${this.player}] Surrender result:`,e),e.ok?(this.winner=this.player==="alice"?"bob":"alice",this.gameId=null,this.setPhase("finished"),this.setMessage("You surrendered."),this.stopPolling(),(n=this.onGameEndCallback)==null||n.call(this,this.winner,"surrender"),!0):(this.setMessage("Surrender failed"),!1)}startPolling(){this.pollInterval||(this.pollInterval=window.setInterval(async()=>{if(!this.isPolling){this.isPolling=!0;try{await this.pollGameState()}finally{this.isPolling=!1}}},1e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async pollGameState(){var n;if(!this.battleshipClient||this.gameId===null)return;const e=await this.battleshipClient.getGame(this.gameId);if(!e){console.log(`[${this.player}] Game #${this.gameId} no longer exists`),this.phase!=="finished"&&this.phase!=="menu"&&(this.winner=this.player,this.setPhase("finished"),this.setMessage("Game ended - opponent may have left."),this.stopPolling(),(n=this.onGameEndCallback)==null||n.call(this,this.player,"opponent_left"));return}await this.processGameState(e)}async processGameState(e){var i,a,c,l,f,u,d,h,g;const n=e.phase,r=JSON.stringify(n);r!==this.lastLoggedPhase&&(console.log(`[${this.player}] Phase changed: ${n==null?void 0:n.type}`,n==null?void 0:n.value),this.lastLoggedPhase=r);const s=720,o=e.last_action_block;if(o&&(this.phase==="battle"||this.phase==="waiting_commit"||this.phase==="waiting_opponent")&&await this.checkAndClaimTimeout(o,s,n),n.type==="WaitingForOpponent"){this.phase!=="waiting_opponent"&&(this.setPhase("waiting_opponent"),this.setMessage(`Game #${this.gameId} - Waiting for opponent...`));return}if(n.type==="Setup"){const p=((i=n.value)==null?void 0:i.player1_ready)??!1,m=((a=n.value)==null?void 0:a.player2_ready)??!1;console.log(`[${this.player}] Setup phase - p1Ready: ${p}, p2Ready: ${m}`),this.phase!=="setup"&&this.phase!=="waiting_commit"&&(this.setPhase("setup"),this.setMessage("Place your ships.")),(this.player==="alice"&&p||this.player==="bob"&&m)&&this.phase!=="waiting_commit"&&(this.setPhase("waiting_commit"),this.setMessage("Waiting for opponent to commit grid..."));return}if(n.type==="Playing"){this.phase!=="battle"&&this.setPhase("battle"),await this.updateOpponentBoardFromChain();const p=(c=n.value)==null?void 0:c.current_turn,m=(l=n.value)==null?void 0:l.pending_attack,b=this.player==="alice",y=(p==null?void 0:p.type)==="Player1";if(this.isOurTurn=b===y,console.log(`[${this.player}] current_turn: ${p==null?void 0:p.type}, pendingAttack:`,m,`isOurTurn: ${this.isOurTurn}`),m){const v={x:m.x,y:m.y};this.pendingAttack=v,!this.isOurTurn&&!this.isRevealing?(console.log(`[${this.player}] Need to reveal cell at`,v),await this.handlePendingAttack(v)):this.isOurTurn&&this.setMessage("Waiting for opponent to reveal...")}else this.isOurTurn||(this.pendingAttack=null),this.isAttacking||(this.pendingAttack!==null?this.setMessage("Waiting for opponent to reveal..."):this.isOurTurn?this.setMessage("Your turn - click enemy waters to attack!"):this.setMessage("Opponent's turn..."));this.notifyStateChange();return}if(n.type==="PendingWinnerReveal"){const p=(f=n.value)==null?void 0:f.winner,m=this.player==="alice";(p==null?void 0:p.type)==="Player1"&&m||(p==null?void 0:p.type)==="Player2"&&!m?(this.setPhase("revealing"),this.setMessage("You won! Revealing your grid..."),await this.revealWinnerGrid()):this.setMessage("Opponent sunk all ships. Waiting for verification...");return}if(n.type==="Finished"){const p=(u=n.value)==null?void 0:u.winner,m=((h=(d=n.value)==null?void 0:d.reason)==null?void 0:h.type)||"unknown",b=this.player==="alice",y=(p==null?void 0:p.type)==="Player1"&&b||(p==null?void 0:p.type)==="Player2"&&!b;this.winner=y?this.player:this.player==="alice"?"bob":"alice",this.setPhase("finished"),m==="Surrender"?this.setMessage(y?"Opponent surrendered! You win!":"You surrendered."):m==="Timeout"?this.setMessage(y?"Opponent timed out! You win!":"You timed out."):this.setMessage(y?"Victory!":"Defeat!"),this.stopPolling(),(g=this.onGameEndCallback)==null||g.call(this,this.winner,m.toLowerCase());return}}async checkAndClaimTimeout(e,n,r){var o,i;if(!this.battleshipClient||this.gameId===null||this.isClaimingTimeout)return;let s=!1;if(r.type==="WaitingForOpponent")s=!0;else if(r.type==="Setup"){const a=this.player==="alice",c=((o=r.value)==null?void 0:o.player1_ready)??!1,l=((i=r.value)==null?void 0:i.player2_ready)??!1;s=a&&c&&!l||!a&&l&&!c}else r.type==="Playing"&&(s=!this.isOurTurn);if(s)try{const l=await(await $s()).getUnsafeApi().query.System.Number.getValue({at:"best"}),f=e+n;if(l>=f){console.log(`[${this.player}] Opponent timed out! Block ${l} >= ${f}`),this.isClaimingTimeout=!0,this.setMessage("Opponent timed out! Claiming win...");const u=await this.battleshipClient.claimTimeoutWin(this.account.signer,this.gameId);console.log(`[${this.player}] Claim timeout result:`,u),this.isClaimingTimeout=!1}}catch(a){console.error(`[${this.player}] Error checking timeout:`,a),this.isClaimingTimeout=!1}}async updateOpponentBoardFromChain(){if(!this.battleshipClient||this.gameId===null)return;const e=Iv(this.player),n=await this.battleshipClient.getPlayerData(this.gameId,e);if(!n)return;const r=JSON.stringify(n);if(r===this.lastOpponentDataHash)return;this.lastOpponentDataHash=r,console.log(`[${this.player}] Opponent data:`,n);const s=n.hit_cells||[],o=new Set(s.map(a=>`${a.x},${a.y}`)),i=n.revealed;if(!(!i||!Array.isArray(i))){for(let a=0;a<100&&a<i.length;a++)if(i[a]===1){const c=a%10,l=Math.floor(a/10),f=o.has(`${c},${l}`);this.opponentBoard.markAttackResult({x:c,y:l},f)}}}async revealWinnerGrid(){if(!this.battleshipClient||this.gameId===null)return;(await this.battleshipClient.revealWinnerGrid(this.account.signer,this.gameId,this.ourCells)).ok?this.setMessage("Grid revealed successfully!"):this.setMessage("Failed to reveal grid")}destroy(){this.stopPolling(),eb()}reset(){this.ourBoard.reset(),this.opponentBoard.reset(),this.ourCells=[],this.merkleTree=null,this.gameId=null,this.currentShipIndex=0,this.placementOrientation="horizontal",this.isOurTurn=!1,this.pendingAttack=null,this.ourHits=0,this.opponentHits=0,this.winner=null,this.lastLoggedPhase=null,this.lastOpponentDataHash="",this.setPhase("menu"),this.setMessage(""),this.stopPolling()}}class Zv{constructor(){w(this,"time",0)}update(e){this.time+=e*.001}render(e,n,r){const s=e.createLinearGradient(0,0,n*.5,r);s.addColorStop(0,"#0a2463"),s.addColorStop(.3,"#1e5799"),s.addColorStop(.6,"#2989d8"),s.addColorStop(1,"#1e3c72"),e.fillStyle=s,e.fillRect(0,0,n,r),this.drawWaveLayers(e,n,r),this.drawCaustics(e,n,r),this.drawShimmer(e,n,r)}drawWaveLayers(e,n,r){const s=[{yBase:.15,amplitude:4,frequency:.008,speed:.6,alpha:.08},{yBase:.3,amplitude:6,frequency:.012,speed:.8,alpha:.1},{yBase:.5,amplitude:5,frequency:.015,speed:1,alpha:.12},{yBase:.7,amplitude:4,frequency:.02,speed:1.2,alpha:.1},{yBase:.85,amplitude:3,frequency:.025,speed:1.4,alpha:.08}];for(const o of s)this.drawWaveLayer(e,n,r,o)}drawWaveLayer(e,n,r,s){const o=r*s.yBase;e.beginPath(),e.moveTo(0,r),e.lineTo(0,o);for(let a=0;a<=n;a+=3){const c=Math.sin(a*s.frequency+this.time*s.speed),l=Math.sin(a*s.frequency*.6+this.time*s.speed*.8+1.5),f=Math.sin(a*s.frequency*1.4+this.time*s.speed*1.2+3),u=o+c*s.amplitude+l*s.amplitude*.5+f*s.amplitude*.3;e.lineTo(a,u)}e.lineTo(n,r),e.closePath();const i=e.createLinearGradient(0,o-20,0,o+50);i.addColorStop(0,`rgba(255, 255, 255, ${s.alpha})`),i.addColorStop(.5,`rgba(200, 230, 255, ${s.alpha*.5})`),i.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=i,e.fill()}drawCaustics(e,n,r){e.save();const s=60,o=Math.ceil(n/s)+1,i=Math.ceil(r/s)+1;for(let a=0;a<i;a++)for(let c=0;c<o;c++){const l=c*s,f=a*s,u=Math.sin(this.time*.5+c*.8+a*.3)*10,d=Math.cos(this.time*.4+c*.5+a*.7)*8,h=l+u,g=f+d,p=.03+.02*Math.sin(this.time*.8+c*1.2+a*.9)*Math.cos(this.time*.6+c*.7+a*1.1);if(p>.02){e.fillStyle=`rgba(150, 200, 255, ${p})`,e.beginPath();const m=6;for(let b=0;b<=m;b++){const y=b/m*Math.PI*2,v=15+5*Math.sin(y*3+this.time)+3*Math.cos(y*5-this.time*.7),x=h+Math.cos(y)*v,k=g+Math.sin(y)*v*.6;b===0?e.moveTo(x,k):e.lineTo(x,k)}e.closePath(),e.fill()}}e.restore()}drawShimmer(e,n,r){e.save();for(let o=0;o<40;o++){const i=o*7654.321,a=i*.31%1*n,c=i*.57%1*r,l=1.5+i%2,f=.15+.15*Math.sin(this.time*l+i);if(f>.1){e.fillStyle=`rgba(255, 255, 255, ${f})`,e.beginPath();const u=1.5+Math.sin(this.time*2+i)*.5;e.moveTo(a,c-u*2),e.lineTo(a+u*.5,c-u*.5),e.lineTo(a+u*2,c),e.lineTo(a+u*.5,c+u*.5),e.lineTo(a,c+u*2),e.lineTo(a-u*.5,c+u*.5),e.lineTo(a-u*2,c),e.lineTo(a-u*.5,c-u*.5),e.closePath(),e.fill()}}e.restore()}}function ln(t,e){const n=Fc+(t-e)*(at/2),r=Vc+(t+e)*(ce/2);return{x:n,y:r}}function Sf(t,e){const n=t-Fc,r=e-Vc,s=(n/(at/2)+r/(ce/2))/2,o=(r/(ce/2)-n/(at/2))/2,i=Math.floor(s),a=Math.floor(o);return i>=0&&i<le&&a>=0&&a<le?{x:i,y:a}:null}function Xv(t,e){const n=ln(t,e);return[{x:n.x,y:n.y},{x:n.x+at/2,y:n.y+ce/2},{x:n.x,y:n.y+ce},{x:n.x-at/2,y:n.y+ce/2}]}function Ho(t,e,n){const r=Xv(e,n);t.beginPath(),t.moveTo(r[0].x,r[0].y),t.lineTo(r[1].x,r[1].y),t.lineTo(r[2].x,r[2].y),t.lineTo(r[3].x,r[3].y),t.closePath()}class Jv{render(e,n,r,s=null){this.drawGrid(e),this.drawCells(e,n,r),this.drawLabels(e),s&&this.drawHover(e,s)}drawGrid(e){e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=1;for(let n=0;n<le;n++)for(let r=0;r<le;r++)Ho(e,r,n),e.stroke()}drawCells(e,n,r){for(let s=0;s<le;s++)for(let o=0;o<le;o++){const i=n[s][o];i.state==="hit"?this.drawHit(e,o,s):i.state==="miss"&&this.drawMiss(e,o,s)}}drawHit(e,n,r){const s=ln(n,r),o=s.x,i=s.y+ce/2;Ho(e,n,r),e.fillStyle="rgba(200, 50, 50, 0.6)",e.fill();const a=ce*.4;e.strokeStyle="#ff3333",e.lineWidth=3,e.lineCap="round",e.beginPath(),e.moveTo(o-a,i-a*.5),e.lineTo(o+a,i+a*.5),e.stroke(),e.beginPath(),e.moveTo(o+a,i-a*.5),e.lineTo(o-a,i+a*.5),e.stroke()}drawMiss(e,n,r){const s=ln(n,r),o=s.x,i=s.y+ce/2;e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.ellipse(o,i,at*.2,ce*.2,0,0,Math.PI*2),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=2,e.beginPath(),e.ellipse(o,i,at*.3,ce*.3,0,0,Math.PI*2),e.stroke()}drawHover(e,n){Ho(e,n.x,n.y),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.6)",e.lineWidth=2,e.stroke()}drawLabels(e){e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="bold 12px sans-serif",e.textAlign="center",e.textBaseline="middle";for(let n=0;n<le;n++){const r=ln(n,-1);e.fillText(String.fromCharCode(65+n),r.x,r.y+ce/2)}for(let n=0;n<le;n++){const r=ln(-1,n);e.fillText(String(n+1),r.x,r.y+ce/2)}}screenToGrid(e,n){return Sf(e,n)}}const Qv={carrier:{hull:"#5a6578",hullDark:"#3d4555",hullLight:"#7a8598",deck:"#4a5568",accent:"#cc3333"},battleship:{hull:"#6b6b7a",hullDark:"#4a4a55",hullLight:"#8a8a9a",deck:"#5a5a6a",accent:"#ddcc44"},cruiser:{hull:"#5a6a7a",hullDark:"#404a55",hullLight:"#7a8a9a",deck:"#4a5a6a",accent:"#44bb66"},submarine:{hull:"#3a4a3a",hullDark:"#2a352a",hullLight:"#4a5f4a",deck:"#3a4a3a",accent:"#ee6666"},destroyer:{hull:"#6a6055",hullDark:"#4a4540",hullLight:"#8a8070",deck:"#5a5550",accent:"#66aadd"}},ew={hull:"#2a2a2a",hullDark:"#1a1a1a",hullLight:"#3a3a3a",deck:"#353535",accent:"#444444"};class tw{renderPlacedShips(e,n,r=!1){const s=[...n].sort((o,i)=>o.position.x+o.position.y-(i.position.x+i.position.y));for(const o of s)r&&!gs(o)||this.renderShip(e,o)}renderShip(e,n){const r=gs(n),s=r?ew:Qv[n.definition.id],o=_n(n);this.drawCellHighlights(e,o,s,r);const i=this.getTileCenter(o[0]),a=this.getTileCenter(o[o.length-1]),c=a.x-i.x,l=a.y-i.y,f=Math.sqrt(c*c+l*l),u=f>0?c/f:1,d=f>0?l/f:0,h=-d,g=u,p=f+20,m=12+n.definition.size*2,b=(i.x+a.x)/2,y=(i.y+a.y)/2;this.drawShipHull(e,b,y,u,d,h,g,p,m,s),this.drawShipDetails(e,b,y,u,d,h,g,p,m,s,n.definition.id,r);for(let v=0;v<o.length;v++)n.hits.has(v)&&this.drawDamage(e,o[v])}getTileCenter(e){const n=ln(e.x,e.y);return{x:n.x,y:n.y+ce/2}}drawCellHighlights(e,n,r,s){e.save();for(const o of n){const i=ln(o.x,o.y);e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(i.x+at/2,i.y+ce/2),e.lineTo(i.x,i.y+ce),e.lineTo(i.x-at/2,i.y+ce/2),e.closePath(),e.fillStyle=s?"rgba(60, 30, 30, 0.4)":`${r.hull}66`,e.fill(),e.strokeStyle=s?"rgba(100, 50, 50, 0.5)":`${r.hullLight}88`,e.lineWidth=1,e.stroke()}e.restore()}drawShipHull(e,n,r,s,o,i,a,c,l,f){const u=c/2,d=l/2,h=.3,g=5,p=n-s*u,m=r-o*u,b=n+s*u,y=r+o*u;e.fillStyle="rgba(0,20,40,0.3)",e.beginPath(),e.moveTo(p+i*d,m+a*d+g),e.lineTo(p-i*d,m-a*d+g),e.quadraticCurveTo(b-i*d*h,y-a*d*h+g,b,y+g),e.quadraticCurveTo(b+i*d*h,y+a*d*h+g,p+i*d,m+a*d+g),e.fill(),e.fillStyle=f.hullDark,e.beginPath(),e.moveTo(p-i*d,m-a*d),e.lineTo(p-i*d,m-a*d+g),e.quadraticCurveTo(b-i*d*h,y-a*d*h+g,b,y+g),e.lineTo(b,y),e.quadraticCurveTo(b-i*d*h,y-a*d*h,p-i*d,m-a*d),e.fill(),e.fillStyle=f.hull,e.beginPath(),e.moveTo(p+i*d,m+a*d),e.lineTo(p-i*d,m-a*d),e.quadraticCurveTo(b-i*d*h,y-a*d*h,b,y),e.quadraticCurveTo(b+i*d*h,y+a*d*h,p+i*d,m+a*d),e.fill(),e.fillStyle=f.deck,e.beginPath();const v=.7,x=u*.8,k={x:n-s*x,y:r-o*x},$={x:n+s*x*.6,y:r+o*x*.6};e.moveTo(k.x+i*d*v,k.y+a*d*v),e.lineTo(k.x-i*d*v,k.y-a*d*v),e.quadraticCurveTo($.x,$.y,k.x+i*d*v,k.y+a*d*v),e.fill(),e.strokeStyle=f.hullLight,e.lineWidth=1.5,e.beginPath(),e.moveTo(p+i*d,m+a*d),e.quadraticCurveTo(b+i*d*h,y+a*d*h,b,y),e.stroke()}drawShipDetails(e,n,r,s,o,i,a,c,l,f,u,d){const h=c/2,g=n-s*h*.1,p=r-o*h*.1;if(e.fillStyle=f.hullDark,e.beginPath(),e.ellipse(g,p-6,5,3,0,0,Math.PI*2),e.fill(),e.fillRect(g-4,p-12,8,7),e.fillStyle=f.hull,e.fillRect(g-5,p-14,10,3),!d){if(e.strokeStyle=f.accent,e.lineWidth=1.5,e.beginPath(),e.moveTo(g,p-14),e.lineTo(g,p-20),e.stroke(),u==="battleship"||u==="cruiser"||u==="destroyer"){const m=n+s*h*.4,b=r+o*h*.4;this.drawTurretAt(e,m,b,s,o,f,u==="battleship")}if(u==="battleship"){const m=n-s*h*.45,b=r-o*h*.45;this.drawTurretAt(e,m,b,s,o,f,!0)}u==="submarine"&&(e.fillStyle=f.hullDark,e.beginPath(),e.ellipse(g,p-2,4,2.5,0,0,Math.PI*2),e.fill())}}drawTurretAt(e,n,r,s,o,i,a){const c=a?4:3;e.fillStyle=i.hullDark,e.beginPath(),e.ellipse(n,r-1,c,c*.5,0,0,Math.PI*2),e.fill(),e.fillStyle=i.hull,e.beginPath(),e.ellipse(n,r-2.5,c-.5,(c-.5)*.5,0,0,Math.PI*2),e.fill(),e.fillStyle=i.accent;const l=a?10:7;e.save(),e.translate(n,r-2);const f=Math.atan2(o,s);e.rotate(f),e.fillRect(0,-1,l,2),a&&e.fillRect(0,-2.5,l-1,1.5),e.restore()}drawDamage(e,n){const r=this.getTileCenter(n),s=e.createRadialGradient(r.x,r.y-5,0,r.x,r.y-5,14);s.addColorStop(0,"rgba(255, 220, 80, 0.95)"),s.addColorStop(.3,"rgba(255, 120, 30, 0.85)"),s.addColorStop(.6,"rgba(200, 60, 20, 0.6)"),s.addColorStop(1,"rgba(80, 30, 20, 0)"),e.fillStyle=s,e.beginPath(),e.arc(r.x,r.y-5,14,0,Math.PI*2),e.fill(),e.fillStyle="rgba(40, 40, 40, 0.7)",e.beginPath(),e.arc(r.x-3,r.y-16,6,0,Math.PI*2),e.arc(r.x+2,r.y-24,5,0,Math.PI*2),e.fill()}renderPreview(e,n,r,s,o){e.save(),e.globalAlpha=.6;for(let i=0;i<n.size;i++){const a=s==="horizontal"?r.x+i:r.x,c=s==="vertical"?r.y+i:r.y,l=ln(a,c);e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(l.x+at/2,l.y+ce/2),e.lineTo(l.x,l.y+ce),e.lineTo(l.x-at/2,l.y+ce/2),e.closePath(),e.fillStyle=o?"rgba(100, 200, 100, 0.5)":"rgba(200, 100, 100, 0.5)",e.fill(),e.strokeStyle=o?"rgba(100, 255, 100, 0.8)":"rgba(255, 100, 100, 0.8)",e.lineWidth=2,e.stroke()}e.restore()}}class nw{constructor(){w(this,"waterEffect");w(this,"gridRenderer");w(this,"shipRenderer");this.waterEffect=new Zv,this.gridRenderer=new Jv,this.shipRenderer=new tw}update(e){this.waterEffect.update(e)}renderPlayerBoard(e,n,r,s){const o=e.canvas.width,i=e.canvas.height;e.clearRect(0,0,o,i),this.waterEffect.render(e,o,i),this.gridRenderer.render(e,n.getGrid(),!0,r),this.shipRenderer.renderPlacedShips(e,n.getShips()),s&&this.shipRenderer.renderPreview(e,s.definition,s.position,s.orientation,s.valid)}renderEnemyBoard(e,n,r,s){const o=e.canvas.width,i=e.canvas.height;e.clearRect(0,0,o,i),this.waterEffect.render(e,o,i),this.gridRenderer.render(e,n.getGrid(),!1,s?r:null),this.shipRenderer.renderPlacedShips(e,n.getShips(),!0)}screenToGrid(e,n){return Sf(e,n)}}class zc{constructor(e,n){w(this,"renderer");w(this,"hoverPos",null);w(this,"onClickCallback",null);w(this,"onHoverCallback",null);w(this,"onKeyCallback",null);this.renderer=n,this.setupListeners(e)}setupListeners(e){e.addEventListener("mousemove",n=>{var a,c,l;const r=e.getBoundingClientRect(),s=n.clientX-r.left,o=n.clientY-r.top,i=this.renderer.screenToGrid(s,o);((i==null?void 0:i.x)!==((a=this.hoverPos)==null?void 0:a.x)||(i==null?void 0:i.y)!==((c=this.hoverPos)==null?void 0:c.y))&&(this.hoverPos=i,(l=this.onHoverCallback)==null||l.call(this,i))}),e.addEventListener("mouseleave",()=>{var n;this.hoverPos=null,(n=this.onHoverCallback)==null||n.call(this,null)}),e.addEventListener("click",n=>{const r=e.getBoundingClientRect(),s=n.clientX-r.left,o=n.clientY-r.top,i=this.renderer.screenToGrid(s,o);i&&this.onClickCallback&&this.onClickCallback(i)}),document.addEventListener("keydown",n=>{var r;(r=this.onKeyCallback)==null||r.call(this,n.key)})}onClick(e){this.onClickCallback=e}onHover(e){this.onHoverCallback=e}onKey(e){this.onKeyCallback=e}getHoverPos(){return this.hoverPos}}const rw=12,Do=10n**BigInt(rw),br=10n**9n,sw={"polkadot-js":"Polkadot.js",talisman:"Talisman","subwallet-js":"SubWallet",enkrypt:"Enkrypt","fearless-wallet":"Fearless"};class we{constructor(){w(this,"extension",null);w(this,"accounts",[]);w(this,"selectedAccount",null);w(this,"unsubscribe",null);w(this,"accountChangeCallback",null)}detectWallets(){if(typeof window>"u")return[];const e=window.injectedWeb3;return e?Object.keys(e).map(n=>({name:n,displayName:sw[n]||n})):[]}async connect(e){try{const n=window.injectedWeb3,r=n==null?void 0:n[e];if(!r)throw new Error(`Wallet ${e} not found`);const s=await r.enable("Battleship Game"),o=a=>({address:a.address,name:a.name,polkadotSigner:this.createSignerProxy(a.address,s.signer)}),i=await s.accounts.get();return this.accounts=i.map(o),this.extension={name:e,getAccounts:()=>this.accounts,subscribe:a=>s.accounts.subscribe(c=>{this.accounts=c.map(o),a(this.accounts)}),disconnect:()=>{}},this.unsubscribe=this.extension.subscribe(a=>{this.accounts=a,this.selectedAccount&&(a.some(l=>{var f;return l.address===((f=this.selectedAccount)==null?void 0:f.address)})||(this.selectedAccount=a[0]||null)),this.accountChangeCallback&&this.accountChangeCallback(this.getAccounts())}),!0}catch(n){return console.error("Failed to connect wallet:",n),!1}}createSignerProxy(e,n){return{publicKey:new Uint8Array(32),signTx:async(r,s,o,i)=>{const a=await n.signPayload({address:e,method:r,signedExtensions:s,version:o,blockNumber:i});return this.hexToBytes(a.signature)},signBytes:async r=>{const s=await n.signRaw({address:e,data:this.bytesToHex(r),type:"bytes"});return this.hexToBytes(s.signature)}}}hexToBytes(e){const n=e.startsWith("0x")?e.slice(2):e,r=new Uint8Array(n.length/2);for(let s=0;s<r.length;s++)r[s]=parseInt(n.substr(s*2,2),16);return r}bytesToHex(e){return"0x"+Array.from(e).map(n=>n.toString(16).padStart(2,"0")).join("")}getAccounts(){return this.accounts.map(e=>({address:e.address,name:e.name||"Account",signer:e.polkadotSigner}))}selectAccount(e){const n=this.accounts.find(r=>r.address===e);return n?(this.selectedAccount=n,!0):!1}getSelectedAccount(){return this.selectedAccount?{address:this.selectedAccount.address,name:this.selectedAccount.name||"Account",signer:this.selectedAccount.polkadotSigner}:null}async getBalance(e){try{return(await(await $s()).getUnsafeApi().query.System.Account.getValue(e,{at:"best"})).data.free}catch(n){return console.error("Failed to get balance:",n),0n}}onAccountChange(e){this.accountChangeCallback=e}disconnect(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.extension&&(this.extension.disconnect(),this.extension=null),this.accounts=[],this.selectedAccount=null,this.accountChangeCallback=null}isConnected(){return this.extension!==null}getConnectedWalletName(){var e;return((e=this.extension)==null?void 0:e.name)||null}static formatBalance(e){if(e===0n)return"0.000";const n=e/Do,s=(e%Do).toString().padStart(12,"0").slice(0,3);return`${n}.${s}`}static parseBalance(e){const n=e.trim();if(!n||n==="")return 0n;if(!/^\d*\.?\d*$/.test(n))throw new Error("Invalid number format");const[r="0",s="0"]=n.split("."),o=s.padEnd(12,"0").slice(0,12),i=r===""?0n:BigInt(r),a=o==="000000000000"?0n:BigInt(o);return i*Do+a}static validateStakeAmount(e,n){const r=br,s=br,o=br/10n;if(e<r)return{valid:!1,error:"Minimum stake is 0.001 UNIT"};const i=e+s+o;return i>n?{valid:!1,error:`Insufficient balance. Need at least ${we.formatBalance(i)} UNIT`}:{valid:!0}}static getAvailableBalance(e){const n=br,r=br/10n,s=n+r;return e<=s?0n:e-s}}let Uo=null;function ow(){return Uo||(Uo=new we),Uo}async function iw(){const e=(await $s()).getUnsafeApi(),n=[],r=await e.query.System.Number.getValue({at:"best"}),s=await e.query.Battleship.Games.getEntries({at:"best"});for(const{keyArgs:o,value:i}of s){const a=o[0],c=i;c.phase.type==="WaitingForOpponent"&&n.push({gameId:a,creator:c.player1.toString(),potAmount:c.pot_amount,blockNumber:r})}return n.sort((o,i)=>Number(i.gameId-o.gameId))}class aw{constructor(){w(this,"game",null);w(this,"renderer",null);w(this,"playerCanvas",null);w(this,"enemyCanvas",null);w(this,"playerCtx",null);w(this,"enemyCtx",null);w(this,"playerInput",null);w(this,"enemyInput",null);w(this,"playerHover",null);w(this,"enemyHover",null);w(this,"lastTime",0);w(this,"walletManager");w(this,"currentAccount",null);w(this,"currentBalance",0n);w(this,"selectedPotAmount",0n);w(this,"lobbyRefreshInterval",null);w(this,"devModePlayer","alice");this.walletManager=ow(),this.init()}init(){ns()?this.setupDevMode():this.setupWalletConnect()}showScreen(e){var n,r;if(document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active")),(n=document.getElementById("game"))==null||n.classList.remove("active"),e==="game"){const s=document.getElementById("game");s&&(s.style.display="block",s.classList.add("active"))}else document.getElementById("game").style.display="none",(r=document.getElementById(e))==null||r.classList.add("active")}setupDevMode(){var n;this.devModePlayer=Bv();const e=document.getElementById("dev-mode-toggle");e&&(e.checked=!0),this.toggleDevModeUI(!0),this.selectDevPlayer(this.devModePlayer),e==null||e.addEventListener("change",()=>{e.checked||(window.location.search="")}),document.querySelectorAll("#dev-mode-section .card").forEach(r=>{r.addEventListener("click",()=>{const s=r.dataset.player;this.selectDevPlayer(s)})}),(n=document.getElementById("wallet-continue-btn"))==null||n.addEventListener("click",()=>{this.onAccountReady()})}toggleDevModeUI(e){const n=document.getElementById("dev-mode-section"),r=document.getElementById("wallet-section"),s=document.getElementById("account-section");n&&(n.style.display=e?"block":"none"),r&&(r.style.display=e?"none":"block"),s&&(s.style.display="none")}selectDevPlayer(e){var r;this.devModePlayer=e;const n=hf(e);this.currentAccount=n,document.querySelectorAll("#dev-mode-section .card").forEach(s=>{s.classList.toggle("selected",s.dataset.player===e)}),this.updateSelectedAccountDisplay(n.address,"Dev Account"),(r=document.getElementById("wallet-continue-btn"))==null||r.removeAttribute("disabled"),this.loadDevBalance(n.address)}async loadDevBalance(e){try{this.currentBalance=await this.walletManager.getBalance(e);const n=document.getElementById("selected-balance");n&&(n.textContent=we.formatBalance(this.currentBalance)+" UNIT")}catch(n){console.error("Failed to load dev balance:",n)}}setupWalletConnect(){var n;const e=document.getElementById("dev-mode-toggle");e==null||e.addEventListener("change",()=>{e.checked?window.location.search="?devMode=true":this.toggleDevModeUI(!1)}),this.loadWallets(),(n=document.getElementById("wallet-continue-btn"))==null||n.addEventListener("click",()=>{this.onAccountReady()})}loadWallets(){const e=document.getElementById("wallet-list"),n=document.getElementById("no-wallets-message");if(!e)return;const r=this.walletManager.detectWallets();if(r.length===0){n&&(n.style.display="block");return}n&&(n.style.display="none"),r.forEach(s=>{const o=document.createElement("div");o.className="card",o.innerHTML=`
        <div class="card-icon">${this.getWalletIcon(s.name)}</div>
        <div class="card-title">${s.displayName}</div>
      `,o.addEventListener("click",()=>this.connectWallet(s)),e.appendChild(o)})}getWalletIcon(e){return{"polkadot-js":"",talisman:"","subwallet-js":"",enkrypt:""}[e]||""}async connectWallet(e){if(!await this.walletManager.connect(e.name)){alert("Failed to connect to wallet. Please try again.");return}document.querySelectorAll("#wallet-list .card").forEach(r=>{var s;r.classList.toggle("selected",((s=r.querySelector(".card-title"))==null?void 0:s.textContent)===e.displayName)}),this.showAccountSelection()}async showAccountSelection(){const e=document.getElementById("account-section"),n=document.getElementById("account-list");if(!e||!n)return;e.style.display="block",n.innerHTML="";const r=this.walletManager.getAccounts();for(const s of r){const o=await this.walletManager.getBalance(s.address),i=we.formatBalance(o),a=document.createElement("div");a.className="card",a.innerHTML=`
        <div class="card-title">${s.name}</div>
        <div class="card-subtitle">${this.truncateAddress(s.address)}</div>
        <div class="card-balance">${i} UNIT</div>
      `,a.addEventListener("click",()=>this.selectWalletAccount(s,o)),n.appendChild(a)}}selectWalletAccount(e,n){var r;this.walletManager.selectAccount(e.address),this.currentAccount={address:e.address,signer:e.signer},this.currentBalance=n,document.querySelectorAll("#account-list .card").forEach(s=>{var i;const o=(i=s.querySelector(".card-subtitle"))==null?void 0:i.textContent;s.classList.toggle("selected",o===this.truncateAddress(e.address))}),this.updateSelectedAccountDisplay(e.address,we.formatBalance(n)+" UNIT"),(r=document.getElementById("wallet-continue-btn"))==null||r.removeAttribute("disabled")}updateSelectedAccountDisplay(e,n){const r=document.getElementById("selected-account-info"),s=document.getElementById("selected-address"),o=document.getElementById("selected-balance");r&&(r.style.display="flex"),s&&(s.textContent=this.truncateAddress(e)),o&&(o.textContent=n)}async onAccountReady(){this.showScreen("game-lobby"),this.setupLobby(),await this.refreshGamesList(),this.startLobbyRefresh()}setupLobby(){var r,s,o;if(!this.currentAccount)return;const e=document.getElementById("lobby-address"),n=document.getElementById("lobby-balance");e&&(e.textContent=this.truncateAddress(this.currentAccount.address)),n&&(n.textContent=we.formatBalance(this.currentBalance)+" UNIT"),(r=document.getElementById("create-game-btn"))==null||r.addEventListener("click",()=>{this.showFundModal()}),(s=document.getElementById("refresh-lobby-btn"))==null||s.addEventListener("click",()=>{this.refreshGamesList()}),(o=document.getElementById("disconnect-btn"))==null||o.addEventListener("click",()=>{this.disconnect()}),this.setupFundModal()}startLobbyRefresh(){this.stopLobbyRefresh(),this.lobbyRefreshInterval=window.setInterval(()=>{this.refreshGamesList()},5e3)}stopLobbyRefresh(){this.lobbyRefreshInterval&&(clearInterval(this.lobbyRefreshInterval),this.lobbyRefreshInterval=null)}async refreshGamesList(){const e=document.getElementById("games-list"),n=document.getElementById("no-games-message");if(e)try{const s=(await iw()).filter(o=>{var i;return o.creator!==((i=this.currentAccount)==null?void 0:i.address)});if(e.querySelectorAll(".game-card").forEach(o=>o.remove()),s.length===0){n&&(n.style.display="block");return}n&&(n.style.display="none"),s.forEach(o=>{const i=this.createGameCard(o);e.appendChild(i)})}catch(r){console.error("Failed to refresh games list:",r)}}createGameCard(e){const n=document.createElement("div");n.className="game-card";const r=we.formatBalance(e.potAmount),s=we.formatBalance(e.potAmount*2n);n.innerHTML=`
      <div class="game-id">Game #${e.gameId}</div>
      <div class="game-host">Host: ${this.truncateAddress(e.creator)}</div>
      <div class="game-stake">Stake: ${r} UNIT</div>
      <div class="game-prize">Winner receives: ${s} UNIT</div>
      <button class="btn btn-success">Join Game</button>
    `;const o=n.querySelector("button");return o==null||o.addEventListener("click",()=>this.joinGame(e)),n}setupFundModal(){const e=document.getElementById("fund-modal-overlay"),n=document.getElementById("cancel-fund-btn"),r=document.getElementById("confirm-fund-btn"),s=document.getElementById("pot-amount-input"),o=document.getElementById("pot-amount-error");e==null||e.addEventListener("click",()=>this.closeFundModal()),n==null||n.addEventListener("click",()=>this.closeFundModal()),s==null||s.addEventListener("input",()=>{try{const i=we.parseBalance(s.value),a=we.validateStakeAmount(i,this.currentBalance);if(!a.valid)throw new Error(a.error);this.selectedPotAmount=i,this.updateStakeSummary(i),o&&(o.classList.remove("visible"),o.textContent=""),r==null||r.removeAttribute("disabled")}catch(i){const a=i instanceof Error?i.message:"Invalid input";o&&(o.classList.add("visible"),o.textContent=a),r==null||r.setAttribute("disabled","true")}}),r==null||r.addEventListener("click",()=>this.createGameWithStake())}showFundModal(){const e=document.getElementById("fund-modal"),n=document.getElementById("pot-amount-input"),r=document.getElementById("modal-total-balance"),s=document.getElementById("modal-available-balance"),o=document.getElementById("confirm-fund-btn"),i=document.getElementById("pot-amount-error");r&&(r.textContent=we.formatBalance(this.currentBalance)+" UNIT");const a=we.getAvailableBalance(this.currentBalance);s&&(s.textContent=we.formatBalance(a)+" UNIT"),n&&(n.value=""),i&&(i.classList.remove("visible"),i.textContent=""),o==null||o.setAttribute("disabled","true"),this.updateStakeSummary(0n),e==null||e.classList.add("active")}closeFundModal(){const e=document.getElementById("fund-modal");e==null||e.classList.remove("active"),this.selectedPotAmount=0n}updateStakeSummary(e){const n=we.formatBalance(e),r=we.formatBalance(e*2n),s=document.getElementById("stake-display"),o=document.getElementById("opponent-stake-display"),i=document.getElementById("prize-display");s&&(s.textContent=n+" UNIT"),o&&(o.textContent=n+" UNIT"),i&&(i.textContent=r+" UNIT")}async createGameWithStake(){if(!this.currentAccount||this.selectedPotAmount<=0n)return;this.closeFundModal(),this.stopLobbyRefresh();const e=ns()?this.devModePlayer:"player";this.game=new Nc(e,this.currentAccount),await this.game.initialize(),this.game.onStateChange(()=>this.updateUI()),this.game.onMessageChange(r=>this.setStatus(r)),this.game.onGameEnd((r,s)=>this.handleGameEnd(r,s)),await this.game.createGame(this.selectedPotAmount)?this.startGame():(alert("Failed to create game. Please try again."),this.startLobbyRefresh())}async joinGame(e){if(!this.currentAccount)return;if(this.currentBalance<e.potAmount){alert("Insufficient balance to join this game");return}this.stopLobbyRefresh();const n=ns()?this.devModePlayer:"player";this.game=new Nc(n,this.currentAccount),await this.game.initialize(),this.game.onStateChange(()=>this.updateUI()),this.game.onMessageChange(s=>this.setStatus(s)),this.game.onGameEnd((s,o)=>this.handleGameEnd(s,o)),await this.game.joinExistingGame(e.gameId)?this.startGame():(alert("Failed to join game. It may have been cancelled or already started."),this.startLobbyRefresh())}startGame(){this.showScreen("game"),this.renderer=new nw,this.playerCanvas=document.getElementById("player-board"),this.enemyCanvas=document.getElementById("enemy-board"),this.playerCanvas&&this.enemyCanvas&&(this.playerCtx=this.playerCanvas.getContext("2d"),this.enemyCtx=this.enemyCanvas.getContext("2d"),this.playerInput=new zc(this.playerCanvas,this.renderer),this.enemyInput=new zc(this.enemyCanvas,this.renderer),this.setupInputHandlers(),this.setupButtons()),this.gameLoop(0)}setupInputHandlers(){!this.playerInput||!this.enemyInput||!this.game||(this.playerInput.onHover(e=>{this.playerHover=e}),this.playerInput.onClick(e=>{if(!this.game)return;this.game.getState().phase==="setup"&&(this.game.placeShip(e),this.updateButtons())}),this.enemyInput.onHover(e=>{this.enemyHover=e}),this.enemyInput.onClick(async e=>{this.game&&this.game.canAttack()&&await this.game.attack(e)}),this.playerInput.onKey(e=>{if(!this.game)return;const n=this.game.getState();(e==="r"||e==="R")&&n.phase==="setup"&&this.game.toggleOrientation()}))}setupButtons(){const e=document.getElementById("rotate-btn"),n=document.getElementById("random-btn"),r=document.getElementById("commit-btn"),s=document.getElementById("surrender-btn");e==null||e.addEventListener("click",()=>{if(!this.game)return;this.game.getState().phase==="setup"&&this.game.toggleOrientation()}),n==null||n.addEventListener("click",()=>{if(!this.game)return;this.game.getState().phase==="setup"&&(this.game.placeShipsRandomly(),this.updateButtons())}),r==null||r.addEventListener("click",async()=>{this.game&&this.game.canStartBattle()&&(await this.game.commitGrid(),this.updateButtons())}),s==null||s.addEventListener("click",async()=>{if(!this.game)return;const o=this.game.getState();(o.phase==="setup"||o.phase==="waiting_commit"||o.phase==="battle")&&await this.game.surrender()})}updateUI(){this.updateButtons(),this.updateInstructions()}updateButtons(){if(!this.game)return;const e=document.getElementById("rotate-btn"),n=document.getElementById("random-btn"),r=document.getElementById("commit-btn"),s=document.getElementById("surrender-btn"),o=this.game.getState();if(e&&(e.disabled=o.phase!=="setup"),n&&(n.disabled=o.phase!=="setup"),r&&(r.disabled=o.phase!=="setup"||!this.game.canStartBattle()),s){const i=o.phase==="setup"||o.phase==="waiting_commit"||o.phase==="battle";s.disabled=!i}}updateInstructions(){if(!this.game)return;const e=document.getElementById("instructions");if(!e)return;const n=this.game.getState();switch(n.phase){case"menu":e.textContent="Click 'Join Local Game' to start.";break;case"creating":e.textContent="Creating game...";break;case"waiting_opponent":e.textContent="Waiting for opponent to join...";break;case"setup":e.textContent="Place your ships on your board. Press R to rotate.";break;case"waiting_commit":e.textContent="Waiting for opponent to commit grid...";break;case"battle":e.textContent=n.isOurTurn?"Your turn - click enemy waters to attack!":"Opponent's turn...";break;case"revealing":e.textContent="Revealing your grid for verification...";break;case"finished":e.textContent=n.winner===n.player?"Victory! You won the battle!":"Defeat! Better luck next time.";break}}setStatus(e){const n=document.getElementById("status");n&&(n.textContent=e)}handleGameEnd(e,n){console.log(`Game ended: winner=${e}, reason=${n}`),setTimeout(()=>{this.returnToLobby()},3e3)}returnToLobby(){this.game&&(this.game.reset(),this.game=null),this.playerHover=null,this.enemyHover=null,this.showScreen("game-lobby"),this.refreshGamesList(),this.startLobbyRefresh(),this.refreshBalance()}async refreshBalance(){if(this.currentAccount)try{this.currentBalance=await this.walletManager.getBalance(this.currentAccount.address);const e=document.getElementById("lobby-balance");e&&(e.textContent=we.formatBalance(this.currentBalance)+" UNIT")}catch(e){console.error("Failed to refresh balance:",e)}}disconnect(){this.stopLobbyRefresh(),this.walletManager.disconnect(),this.currentAccount=null,this.currentBalance=0n,ns()?window.location.search="":window.location.reload()}gameLoop(e){const n=e-this.lastTime;this.lastTime=e,this.renderer&&this.renderer.update(n),this.render(),requestAnimationFrame(r=>this.gameLoop(r))}render(){if(!this.game||!this.renderer||!this.playerCtx||!this.enemyCtx)return;const e=this.game.getState();let n=null;if(e.phase==="setup"&&this.playerHover){const s=this.game.getCurrentShip();s&&(n={definition:s,position:this.playerHover,orientation:this.game.getPlacementOrientation(),valid:this.game.canPlaceCurrentShip(this.playerHover)})}this.renderer.renderPlayerBoard(this.playerCtx,this.game.getOurBoard(),e.phase==="setup"?this.playerHover:null,n);const r=this.game.canAttack();this.renderer.renderEnemyBoard(this.enemyCtx,this.game.getOpponentBoard(),this.enemyHover,r)}truncateAddress(e){return`${e.slice(0,6)}...${e.slice(-4)}`}}new aw;
