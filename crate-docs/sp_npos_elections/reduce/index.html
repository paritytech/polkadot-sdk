<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Rust implementation of the Phragmén reduce algorithm. This can be used by any off chain application to reduce cycles from the edge assignment, which will result in smaller size."><title>sp_npos_elections::reduce - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-cb6f1f67f1bcd037.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="sp_npos_elections" data-themes="" data-resource-suffix="" data-rustdoc-version="1.73.0 (cc66ad468 2023-10-03)" data-channel="1.73.0" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-1596385f77d47ef2.css" data-theme-dark-css="dark-0a43001d3fc2282c.css" data-theme-ayu-css="ayu-fd19013d6ce078bf.css" ><script src="../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-1596385f77d47ef2.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-0a43001d3fc2282c.css"><link rel="stylesheet" href="../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"><script async defer src="https://apisa.parity.io/latest.js"></script><noscript><img src="https://apisa.parity.io/latest.js" alt="" referrerpolicy="no-referrer-when-downgrade" /></noscript></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../sp_npos_elections/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../sp_npos_elections/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module reduce</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">sp_npos_elections</a>::<wbr><a class="mod" href="#">reduce</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/sp_npos_elections/reduce.rs.html#18-923">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Rust implementation of the Phragmén reduce algorithm. This can be used by any off chain
application to reduce cycles from the edge assignment, which will result in smaller size.</p>
<h4 id="notions"><a href="#notions">Notions</a></h4>
<ul>
<li><code>m</code>: size of the committee to elect.</li>
<li><code>k</code>: maximum allowed votes (16 as of this writing).</li>
<li><code>nv ∈ E</code> means that nominator <code>n ∈ N</code> supports the election of candidate <code>v ∈ V</code>.</li>
<li>A valid solution consists of a tuple <code>(S, W)</code> , where <code>S ⊆ V</code> is a committee of m validators,
and <code>W : E → R ≥ 0</code> is an edge weight vector which describes how the budget of each nominator
n is fractionally assigned to n ’s elected neighbors.</li>
<li><code>E_w := { e ∈ E : w_e &gt; 0 }</code>.</li>
</ul>
<h4 id="algorithm-overview"><a href="#algorithm-overview">Algorithm overview</a></h4>
<blockquote>
<p>We consider the input edge weight vector <code>w</code> as a directed flow over <code>E_w</code> , where the flow in
each edge is directed from the nominator to the validator. We build <code>w′</code> from <code>w</code> by removing
<strong>circulations</strong> to cancel out the flow over as many edges as possible, while preserving flow
demands over all vertices and without reverting the flow direction over any edge. As long as
there is a cycle, we can remove an additional circulation and eliminate at least one new edge
from <code>E_w′</code> . This shows that the algorithm always progresses and will eventually finish with
an acyclic edge support. We keep a data structure that represents a forest of rooted trees,
which is initialized as a collection of singletons – one per vertex – and to which edges in
<code>E_w</code> are added one by one, causing the trees to merge. Whenever a new edge creates a cycle,
we detect it and destroy it by removing a circulation. We also run a pre-computation which is
designed to detect and remove cycles of length four exclusively. This pre-computation is
optional, and if we skip it then the running time becomes <code>O (|E_w| ⋅ m), so the pre-computation makes sense only if </code>m &gt;&gt; k<code>and</code>|E_w| &gt;&gt; m^2`.</p>
</blockquote>
<h4 id="resources"><a href="#resources">Resources:</a></h4>
<ol>
<li><a href="https://hackmd.io/JOn9x98iS0e0DPWQ87zGWg?view">https://hackmd.io/JOn9x98iS0e0DPWQ87zGWg?view</a></li>
</ol>
</div></details><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.reduce.html" title="fn sp_npos_elections::reduce::reduce">reduce</a></div><div class="desc docblock-short">Reduce the given <a href="https://doc.rust-lang.org/1.73.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec"><code>Vec&lt;StakedAssignment&lt;IdentifierT&gt;&gt;</code></a>. This removes redundant edges without
changing the overall backing of any of the elected candidates.</div></li></ul></section></div></main></body></html>