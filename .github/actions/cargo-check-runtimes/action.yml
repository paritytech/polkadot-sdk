name: 'cargo check runtimes'
description: 'Runs `cargo check` for every directory in provided root.'
inputs:
  root:
    description: "Root directory. Expected to contain several cargo packages inside."
    required: true
runs:
  using: "composite"
  steps:
    - name: Check
      shell: bash
      run: |
        mkdir -p ~/.forklift
        cp .forklift/config.toml ~/.forklift/config.toml
        cd ${{ inputs.root }}

        # Run cargo check in parallel
        find . -mindepth 1 -maxdepth 1 -type d | xargs -P 4 -I {} bash -c '
          echo "_____Running cargo check for {} ______";
          SKIP_WASM_BUILD=1 forklift cargo check --locked -p "{}";
        '

