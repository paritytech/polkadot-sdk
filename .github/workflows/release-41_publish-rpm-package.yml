name: Release - Publish polkadot RPM package

# This workflow publishes the polkadot RPM package by calling a reusable workflow.
on:
  workflow_dispatch:
    inputs:
      tag:
        description: Current final release tag in the format polkadot-stableYYMM or polkadot-stable-YYMM-X
        default: polkadot-stable2412
        required: true
        type: string
      distribution:
        description: Distribution where to publish rpm package (release, staging)
        default: release
        required: true
        type: string

  workflow_call:
    inputs:
      tag:
        description: Current final release tag in the format polkadot-stableYYMM or polkadot-stable-YYMM-X
        required: true
        type: string
      distribution:
        description: Distribution where to publish rpm package (release, staging)
        default: release
        required: true
        type: string

jobs:
  check-synchronization:
    uses: paritytech-release/sync-workflows/.github/workflows/check-synchronization.yml@main
    secrets:
      fork_writer_app_key: ${{ secrets.UPSTREAM_CONTENT_SYNC_APP_KEY }}
  call-publish-workflow:
    needs: [check-synchronization]
    if: needs.check-synchronization.outputs.checks_passed == 'true'
    uses: ./.github/workflows/release-reusable-publish-packages.yml
    with:
      tag: ${{ inputs.tag }}
      distribution: ${{ inputs.distribution }}
      package_type: 'rpm'
      aws_repo_base_path: ${{ inputs.distribution == 'release' && 's3://releases-package-repos' || 's3://staging-package-repos' }}
      cloudfront_distribution_id: "E36FKEYWDXAZYJ"
    secrets: inherit
