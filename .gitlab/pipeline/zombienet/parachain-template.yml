# common settings for all zombienet jobs
.zombienet-parachain-template-common:
  before_script:
    # add `./artifacts` to the PATH
    - export PATH=./artifacts:$PATH
  stage: zombienet
  needs:
    - job: build-linux-stable # polkadot binaries
      artifacts: true
    - job: build-parachain-template-node # parachain-template-node
      artifacts: true
  extends:
    - .docker-env
    - .zombienet-refs
  variables:
    ZOMBIE_PROVIDER: "native"
    RUST_LOG: "info,zombienet_orchestrator=debug"
    FF_DISABLE_UMASK_FOR_DOCKER_EXECUTOR: 1
    RUN_IN_CONTAINER: "1"
  artifacts:
    name: "${CI_JOB_NAME}_${CI_COMMIT_REF_NAME}"
    when: always
    expire_in: 2 days
    paths:
      - ./zombienet-logs
  after_script:
    - mkdir -p ./zombienet-logs
    - cp /tmp/zombie*/logs/* ./zombienet-logs/
  retry: 2
  timeout: 15m
  tags:
    - linux-docker

zombienet-parachain-template-smoke:
  extends:
    - .zombienet-parachain-template-common
  script:
    - cargo test -p parachain-template-zombienet --test smoke
